!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t=t||self).firebase)}(this,function(Sd){"use strict";try{(function(){Sd=Sd&&Object.prototype.hasOwnProperty.call(Sd,"default")?Sd.default:Sd;var t,p,e,r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function n(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function y(t,s,u,a){return new(u=u||Promise)(function(n,e){function r(t){try{o(a.next(t))}catch(t){e(t)}}function i(t){try{o(a.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof u?e:new u(function(t){t(e)})).then(r,i)}o((a=a.apply(t,s||[])).next())})}function v(n,r){var i,o,s,t,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,o=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){u.label=e[1];break}if(6===e[0]&&u.label<s[1]){u.label=s[1],s=e;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(e);break}s[2]&&u.ops.pop(),u.trys.pop();continue}e=r.call(n,u)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function d(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function s(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}(e=p=p||{})[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT";function i(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=a[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,s(["["+i+"]  "+t.name+":"],n))}}var o={debug:p.DEBUG,verbose:p.VERBOSE,info:p.INFO,warn:p.WARN,error:p.ERROR,silent:p.SILENT},u=p.INFO,a=((t={})[p.DEBUG]="log",t[p.VERBOSE]="log",t[p.INFO]="info",t[p.WARN]="warn",t[p.ERROR]="error",t),h=(Object.defineProperty(c.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in p))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),c.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?o[t]:t},Object.defineProperty(c.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),c.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,p.DEBUG],t)),this._logHandler.apply(this,s([this,p.DEBUG],t))},c.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,p.VERBOSE],t)),this._logHandler.apply(this,s([this,p.VERBOSE],t))},c.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,p.INFO],t)),this._logHandler.apply(this,s([this,p.INFO],t))},c.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,p.WARN],t)),this._logHandler.apply(this,s([this,p.WARN],t))},c.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,p.ERROR],t)),this._logHandler.apply(this,s([this,p.ERROR],t))},c);function c(t){this.name=t,this._logLevel=u,this._logHandler=i,this._userLogHandler=null}function g(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var f,m=(n(l,f=Error),l);function l(t,e){var n=f.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,l.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,w.prototype.create),n}var w=(b.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r,i=e[0]||{},o=this.service+"/"+t,s=this.errors[t],u=s?(r=i,s.replace(I,function(t,e){var n=r[e];return null!=n?String(n):"<"+e+"?>"})):"Error",a=this.serviceName+": "+u+" ("+o+").",h=new m(o,a),c=0,f=Object.keys(i);c<f.length;c++){var l=f[c];"_"!==l.slice(-1)&&(l in h&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),h[l]=i[l])}return h},b);function b(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var I=/\{\$([^}]+)}/g;function E(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var T,_="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},A=A||{},N=_||self;function S(){}function D(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function x(t){var e=D(t);return"array"==e||"object"==e&&"number"==typeof t.length}function P(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var O="closure_uid_"+(1e9*Math.random()>>>0),k=0;function L(t,e,n){return t.call.apply(t.bind,arguments)}function R(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function C(t,e,n){return(C=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?L:R).apply(null,arguments)}function V(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var U=Date.now||function(){return+new Date};function M(t,e){function n(){}n.prototype=e.prototype,t.M=e.prototype,t.prototype=new n,t.prototype.constructor=t}function j(){this.j=this.j,this.i=this.i}j.prototype.j=!1,j.prototype.da=function(){if(!this.j&&(this.j=!0,this.C(),0))t=this,Object.prototype.hasOwnProperty.call(t,O)&&t[O]||(t[O]=++k);var t},j.prototype.C=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var F=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},q=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function B(t){return Array.prototype.concat.apply([],arguments)}function z(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function G(t){return/^[\s\xa0]*$/.test(t)}var Q,H=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function W(t,e){return-1!=t.indexOf(e)}function $(t,e){return t<e?-1:e<t?1:0}t:{var K=N.navigator;if(K){var X=K.userAgent;if(X){Q=X;break t}}Q=""}function Y(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function J(t){var e={};for(var n in t)e[n]=t[n];return e}var Z="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function tt(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<Z.length;o++)n=Z[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function et(t){return et[" "](t),t}et[" "]=S;var nt,rt,it=W(Q,"Opera"),ot=W(Q,"Trident")||W(Q,"MSIE"),st=W(Q,"Edge"),ut=st||ot,at=W(Q,"Gecko")&&!(W(Q.toLowerCase(),"webkit")&&!W(Q,"Edge"))&&!(W(Q,"Trident")||W(Q,"MSIE"))&&!W(Q,"Edge"),ht=W(Q.toLowerCase(),"webkit")&&!W(Q,"Edge");function ct(){var t=N.document;return t?t.documentMode:void 0}t:{var ft="",lt=(rt=Q,at?/rv:([^\);]+)(\)|;)/.exec(rt):st?/Edge\/([\d\.]+)/.exec(rt):ot?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(rt):ht?/WebKit\/(\S+)/.exec(rt):it?/(?:Version)[ \/]?(\S+)/.exec(rt):void 0);if(lt&&(ft=lt?lt[1]:""),ot){var pt=ct();if(null!=pt&&pt>parseFloat(ft)){nt=String(pt);break t}}nt=ft}var dt,yt={};function vt(u){return t=u,e=function(){for(var t=0,e=H(String(nt)).split("."),n=H(String(u)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=$(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||$(0==o[2].length,0==s[2].length)||$(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t},n=yt,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t);var t,e,n}if(N.document&&ot){var gt=ct();dt=gt||(parseInt(nt,10)||void 0)}else dt=void 0;var mt=dt,wt=!ot||9<=Number(mt),bt=ot&&!vt("9"),It=function(){if(!N.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{N.addEventListener("test",S,e),N.removeEventListener("test",S,e)}catch(t){}return t}();function Et(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function Tt(t,e){if(Et.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(at){t:{try{et(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:_t[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}Et.prototype.b=function(){this.defaultPrevented=!0},M(Tt,Et);var _t={2:"touch",3:"pen",4:"mouse"};Tt.prototype.b=function(){Tt.M.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,bt)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var At="closure_listenable_"+(1e6*Math.random()|0),Nt=0;function St(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.aa=i,this.key=++Nt,this.V=this.X=!1}function Dt(t){t.V=!0,t.listener=null,t.proxy=null,t.src=null,t.aa=null}function xt(t){this.src=t,this.a={},this.b=0}function Pt(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=F(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(Dt(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function Ot(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.V&&o.listener==e&&o.capture==!!n&&o.aa==r)return i}return-1}xt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=Ot(t,e,r,i);return-1<s?(e=t[s],n||(e.X=!1)):((e=new St(e,this.src,o,!!r,i)).X=n,t.push(e)),e};var kt="closure_lm_"+(1e6*Math.random()|0),Lt={};function Rt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}r=Bt(r);return e&&e[At]?e.sa(n,r,P(i)?!!i.capture:!!i,o):Ct(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Rt(t,e[o],n,r,i);return null}return n=Bt(n),t&&t[At]?t.ra(e,n,P(r)?!!r.capture:!!r,i):Ct(t,e,n,!1,r,i)}function Ct(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=P(i)?!!i.capture:!!i;if(s&&!wt)return null;var u,a,h=Ft(t);if(h||(t[kt]=h=new xt(t)),(n=h.add(e,n,r,s,o)).proxy)return n;if(u=jt,r=a=wt?function(t){return u.call(a.src,a.listener,t)}:function(t){if(!(t=u.call(a.src,a.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)It||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Ut(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Vt(t){if("number"!=typeof t&&t&&!t.V){var e=t.src;if(e&&e[At])Pt(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ut(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ft(e))?(Pt(n,t),0==n.b&&(n.src=null,e[kt]=null)):Dt(t)}}}function Ut(t){return t in Lt?Lt[t]:Lt[t]="on"+t}function Mt(t,e){var n=t.listener,r=t.aa||t.src;return t.X&&Vt(t),n.call(r,e)}function jt(t,e){if(t.V)return!0;if(wt)return Mt(t,new Tt(e,this));if(!e)t:{e=["window","event"];for(var n=N,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Mt(t,e=new Tt(e,this))}function Ft(t){return(t=t[kt])instanceof xt?t:null}var qt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Bt(e){return"function"==D(e)?e:(e[qt]||(e[qt]=function(t){return e.handleEvent(t)}),e[qt])}function zt(){j.call(this),this.c=new xt(this),(this.J=this).A=null}function Gt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.V&&s.capture==n){var u=s.listener,a=s.aa||s.src;s.X&&Pt(t.c,s),i=!1!==u.call(a,r)&&i}}return i&&!r.defaultPrevented}M(zt,j),zt.prototype[At]=!0,(T=zt.prototype).addEventListener=function(t,e,n,r){Rt(this,t,e,n,r)},T.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=P(i)?!!i.capture:!!i,r=Bt(r),e&&e[At]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=Ot(s=e.a[n],r,i,o))&&(Dt(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&Ft(e))&&(n=e.a[n.toString()],e=-1,n&&(e=Ot(n,r,i,o)),(r=-1<e?n[e]:null)&&Vt(r))}(this,t,e,n,r)},T.dispatchEvent=function(t){var e,n=this.A;if(n)for(e=[];n;n=n.A)e.push(n);n=this.J;var r=t.type||t;if("string"==typeof t)t=new Et(t,n);else if(t instanceof Et)t.target=t.target||n;else{var i=t;tt(t=new Et(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var s=t.a=e[o];i=Gt(s,r,!0,t)&&i}if(i=Gt(s=t.a=n,r,!0,t)&&i,i=Gt(s,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=Gt(s=t.a=e[o],r,!1,t)&&i;return i},T.C=function(){if(zt.M.C.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Dt(n[r]);delete e.a[t],e.b--}}this.A=null},T.ra=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},T.sa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Qt=N.JSON.stringify;function Ht(){this.b=this.a=null}var Wt,$t=(Kt.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},new Kt(function(){return new Xt},function(t){t.reset()},100));function Kt(t,e,n){this.f=n,this.c=t,this.g=e,this.b=0,this.a=null}function Xt(){this.next=this.b=this.a=null}function Yt(t){N.setTimeout(function(){throw t},0)}function Jt(t,e){var n;Wt||(n=N.Promise.resolve(void 0),Wt=function(){n.then(ee)}),Zt||(Wt(),Zt=!0),te.add(t,e)}Ht.prototype.add=function(t,e){var n=$t.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Xt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var Zt=!(Xt.prototype.reset=function(){this.next=this.b=this.a=null}),te=new Ht;function ee(){for(var t;r=n=void 0,r=null,(n=te).a&&(r=n.a,n.a=n.a.next,n.a||(n.b=null),r.next=null),t=r;){try{t.a.call(t.b)}catch(t){Yt(t)}var e=$t;e.g(t),e.b<e.f&&(e.b++,t.next=e.a,e.a=t)}var n,r;Zt=!1}function ne(t,e){zt.call(this),this.b=t||1,this.a=e||N,this.f=C(this.Ua,this),this.g=U()}function re(t){t.Z=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function ie(t,e,n){if("function"==D(t))n&&(t=C(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=C(t.handleEvent,t)}return 2147483647<Number(e)?-1:N.setTimeout(t,e||0)}function oe(t,e,n){j.call(this),this.f=null!=n?C(t,n):t,this.c=e,this.b=C(this.Pa,this),this.a=[]}function se(t){t.T=ie(t.b,t.c),t.f.apply(null,t.a)}function ue(t){j.call(this),this.b=t,this.a={}}M(ne,zt),(T=ne.prototype).Z=!1,T.L=null,T.Ua=function(){if(this.Z){var t=U()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.Z&&(re(this),this.start()))}},T.start=function(){this.Z=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=U())},T.C=function(){ne.M.C.call(this),re(this),delete this.a},M(oe,j),(T=oe.prototype).ba=!1,T.T=null,T.Ia=function(t){this.a=arguments,this.T?this.ba=!0:se(this)},T.C=function(){oe.M.C.call(this),this.T&&(N.clearTimeout(this.T),this.T=null,this.ba=!1,this.a=[])},T.Pa=function(){this.T=null,this.ba&&(this.ba=!1,se(this))},M(ue,j);var ae=[];function he(t,e,n,r){Array.isArray(n)||(n&&(ae[0]=n.toString()),n=ae);for(var i=0;i<n.length;i++){var o=Rt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function ce(t){Y(t.a,function(t,e){this.a.hasOwnProperty(e)&&Vt(t)},t),t.a={}}function fe(){}ue.prototype.C=function(){ue.M.C.call(this),ce(this)},ue.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var le=null;function pe(){return le=le||new zt}function de(t){Et.call(this,"serverreachability",t)}function ye(t){var e=pe();e.dispatchEvent(new de(e))}function ve(t){Et.call(this,"statevent",t)}function ge(t){var e=pe();e.dispatchEvent(new ve(e))}function me(t){Et.call(this,"timingevent",t)}function we(t,e){if("function"!=D(t))throw Error("Fn must not be null and must be a function");return N.setTimeout(function(){t()},e)}M(de,Et),M(ve,Et),M(me,Et);var be={NO_ERROR:0,Va:1,bb:2,ab:3,Ya:4,$a:5,cb:6,za:7,TIMEOUT:8,gb:9},Ie={Xa:"complete",kb:"success",Aa:"error",za:"abort",ib:"ready",jb:"readystatechange",TIMEOUT:"timeout",eb:"incrementaldata",hb:"progress",Za:"downloadprogress",lb:"uploadprogress"};function Ee(){}function Te(t){var e;return(e=t.a)||(e=t.a={}),e}function _e(){}Ee.prototype.a=null;var Ae,Ne={OPEN:"a",Wa:"b",Aa:"c",fb:"d"};function Se(){Et.call(this,"d")}function De(){Et.call(this,"c")}function xe(){}function Pe(t,e,n){this.g=t,this.W=e,this.U=n||1,this.G=new ue(this),this.N=Oe,t=ut?125:void 0,this.O=new ne(t),this.m=null,this.b=!1,this.j=this.A=this.f=this.B=this.s=this.P=this.h=null,this.i=[],this.a=null,this.w=0,this.c=this.v=null,this.H=-1,this.l=!1,this.J=0,this.D=null,this.o=this.R=this.F=!1}M(Se,Et),M(De,Et),M(xe,Ee),Ae=new xe;var Oe=45e3,ke={},Le={};function Re(t,e,n){t.B=1,t.f=nn(Xe(e)),t.j=n,t.F=!0,Ce(t,null)}function Ce(t,e){t.s=U(),Me(t),t.A=Xe(t.f);var n=t.A,r=t.U;Array.isArray(r)||(r=[String(r)]),vn(n.b,"t",r),t.w=0,t.a=ur(t.g,t.g.w?e:null),0<t.J&&(t.D=new oe(C(t.ya,t,t.a),t.J)),he(t.G,t.a,"readystatechange",t.Sa),e=t.m?J(t.m):{},t.j?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.$(t.A,t.v,t.j,e)):(t.v="GET",t.a.$(t.A,t.v,null,e)),ye(1)}function Ve(t,e,n){for(var r=!0;!t.l&&t.w<n.length;){var i=Ue(t,n);if(i==Le){4==e&&(t.c=4,ge(14),r=!1);break}if(i==ke){t.c=4,ge(15),r=!1;break}ze(t,i)}4==e&&0==n.length&&(t.c=1,ge(16),r=!1),t.b=t.b&&r,r||(Be(t),qe(t))}function Ue(t,e){var n=t.w,r=e.indexOf("\n",n);return-1==r?Le:(n=Number(e.substring(n,r)),isNaN(n)?ke:(r+=1)+n>e.length?Le:(e=e.substr(r,n),t.w=r+n,e))}function Me(t){t.P=U()+t.N,je(t,t.N)}function je(t,e){if(null!=t.h)throw Error("WatchDog timer not null");t.h=we(C(t.Qa,t),e)}function Fe(t){t.h&&(N.clearTimeout(t.h),t.h=null)}function qe(t){0==t.g.u||t.l||nr(t.g,t)}function Be(t){Fe(t);var e=t.D;e&&"function"==typeof e.da&&e.da(),t.D=null,re(t.O),ce(t.G),t.a&&(e=t.a,t.a=null,e.abort(),e.da())}function ze(t,e){try{var n=t.g;if(0!=n.u&&(n.a==t||Tn(n.b,t)))if(n.A=t.H,!t.o&&Tn(n.b,t)&&3==n.u){try{var r=n.ja.a.parse(e)}catch(t){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.i){if(n.a){if(!(n.a.s+3e3<t.s))break t;er(n),n.a.cancel(),n.a=null}tr(n),ge(18)}}else n.ia=i[1],0<n.ia-n.G&&i[2]<37500&&n.U&&0==n.m&&!n.l&&(n.l=we(C(n.Na,n),6e3));if(En(n.b)<=1&&n.O){try{n.O()}catch(t){}n.O=void 0}}else ir(n,11)}else if(!t.o&&n.a!=t||er(n),!G(e))for(e=r=n.ja.a.parse(e),r=0;r<e.length;r++)if(i=e[r],n.G=i[0],i=i[1],2==n.u)if("c"==i[0]){n.B=i[1],n.R=i[2];var o=i[3];null!=o&&(n.oa=o);var s=i[5];null!=s&&"number"==typeof s&&0<s&&(n.D=1.5*s);var u=n,a=t.a;if(a){var h=a.a?a.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var c=u.b;!c.a&&(W(h,"spdy")||W(h,"quic")||W(h,"h2"))&&(c.f=c.g,c.a=new Set,c.b&&(_n(c,c.b),c.b=null))}if(u.s){var f=a.a?a.a.getResponseHeader("X-HTTP-Session-Id"):null;f&&(u.ha=f,en(u.v,u.s,f))}}n.u=3,n.c&&n.c.na();var l=t;if((u=n).ea=sr(u,u.w?u.R:null,u.P),l.o){An(u.b,l);var p=l,d=u.D;d&&p.setTimeout(d),p.h&&(Fe(p),Me(p)),u.a=l}else Zn(u);0<n.f.length&&Kn(n)}else"stop"!=i[0]&&"close"!=i[0]||ir(n,7);else 3==n.u&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?ir(n,7):Hn(n):"noop"!=i[0]&&n.c&&n.c.ma(i),n.m=0);ye(4)}catch(t){}}function Ge(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(x(t)||"string"==typeof t)q(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.I&&"function"==typeof t.I)n=void 0;else if(x(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.I&&"function"==typeof t.I)return t.I();if("string"==typeof t)return t.split("");if(x(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Qe(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Qe)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function He(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];We(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)We(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function We(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(T=Pe.prototype).setTimeout=function(t){this.N=t},T.Sa=function(t){t=t.target;var e=this.D;e&&3==Bn(t)?e.Ia():this.ya(t)},T.ya=function(t){try{if(t==this.a)t:{var e=Bn(this.a),n=this.a.qa(),r=this.a.S();if(!(e<3||3==e&&!ut&&!this.a.Y())){this.l||4!=e||7==n||ye(8==n||r<=0?3:2),Fe(this);var i=this.a.S();this.H=i;var o=this.a.Y();if(this.b=200==i){if(this.R&&!this.o){e:{if(this.a){var s,u=this.a;if((s=u.a?u.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!G(s)){var a=s;break e}}a=null}if(!a){this.b=!1,this.c=3,ge(12),Be(this),qe(this);break t}this.o=!0,ze(this,a)}this.F?(Ve(this,e,o),ut&&this.b&&3==e&&(he(this.G,this.O,"tick",this.Ra),this.O.start())):ze(this,o),4==e&&Be(this),this.b&&!this.l&&(4==e?nr(this.g,this):(this.b=!1,Me(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,ge(12)):(this.c=0,ge(13)),Be(this),qe(this)}}}catch(t){}},T.Ra=function(){if(this.a){var t=Bn(this.a),e=this.a.Y();this.w<e.length&&(Fe(this),Ve(this,t,e),this.b&&4!=t&&Me(this))}},T.cancel=function(){this.l=!0,Be(this)},T.Qa=function(){this.h=null;var t=U();0<=t-this.P?(2!=this.B&&(ye(3),ge(17)),Be(this),this.c=2,qe(this)):je(this,this.P-t)},(T=Qe.prototype).I=function(){He(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},T.K=function(){return He(this),this.a.concat()},T.get=function(t,e){return We(this.b,t)?this.b[t]:e},T.set=function(t,e){We(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},T.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var $e=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ke(t,e){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof Ke){this.a=void 0!==e?e:t.a,Ye(this,t.f),this.j=t.j,Je(this,t.c),Ze(this,t.h),this.g=t.g,e=t.b;var n=new ln;n.c=e.c,e.a&&(n.a=new Qe(e.a),n.b=e.b),tn(this,n),this.i=t.i}else t&&(n=String(t).match($e))?(this.a=!!e,Ye(this,n[1]||"",!0),this.j=rn(n[2]||""),Je(this,n[3]||"",!0),Ze(this,n[4]),this.g=rn(n[5]||"",!0),tn(this,n[6]||"",!0),this.i=rn(n[7]||"")):(this.a=!!e,this.b=new ln(null,this.a))}function Xe(t){return new Ke(t)}function Ye(t,e,n){t.f=n?rn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function Je(t,e,n){t.c=n?rn(e,!0):e}function Ze(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.h=e}else t.h=null}function tn(t,e,n){var r,i;e instanceof ln?(t.b=e,r=t.b,(i=t.a)&&!r.f&&(pn(r),r.c=null,r.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(dn(this,e),vn(this,n,t))},r)),r.f=i):(n||(e=on(e,cn)),t.b=new ln(e,t.a))}function en(t,e,n){t.b.set(e,n)}function nn(t){return en(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^U()).toString(36)),t}function rn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function on(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,sn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function sn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ke.prototype.toString=function(){var t=[],e=this.f;e&&t.push(on(e,un,!0),":");var n=this.c;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(on(e,un,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(on(n,"/"==n.charAt(0)?hn:an,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",on(n,fn)),t.join("")};var un=/[#\/\?@]/g,an=/[#\?:]/g,hn=/[#\?]/g,cn=/[#\?@]/g,fn=/#/g;function ln(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function pn(n){n.a||(n.a=new Qe,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function dn(t,e){pn(t),e=gn(t,e),We(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,We((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&He(t)))}function yn(t,e){return pn(t),e=gn(t,e),We(t.a.b,e)}function vn(t,e,n){dn(t,e),0<n.length&&(t.c=null,t.a.set(gn(t,e),z(n)),t.b+=n.length)}function gn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function mn(t,e){this.b=t,this.a=e}function wn(t){this.g=t||bn,t=N.PerformanceNavigationTiming?0<(t=N.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(N.ca&&N.ca.ua&&N.ca.ua()&&N.ca.ua().mb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}(T=ln.prototype).add=function(t,e){pn(this),this.c=null,t=gn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},T.forEach=function(n,r){pn(this),this.a.forEach(function(t,e){q(t,function(t){n.call(r,t,e,this)},this)},this)},T.K=function(){pn(this);for(var t=this.a.I(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},T.I=function(t){pn(this);var e=[];if("string"==typeof t)yn(this,t)&&(e=B(e,this.a.get(gn(this,t))));else{t=this.a.I();for(var n=0;n<t.length;n++)e=B(e,t[n])}return e},T.set=function(t,e){return pn(this),this.c=null,yn(this,t=gn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},T.get=function(t,e){return t&&0<(t=this.I(t)).length?String(t[0]):e},T.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.I(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.c=t.join("&")};var bn=10;function In(t){return t.b||t.a&&t.a.size>=t.f}function En(t){return t.b?1:t.a?t.a.size:0}function Tn(t,e){return t.b?t.b==e:t.a&&t.a.has(e)}function _n(t,e){t.a?t.a.add(e):t.b=e}function An(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function Nn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.i);if(null==t.a||0===t.a.size)return z(t.c);var r=t.c;try{for(var i=E(t.a.values()),o=i.next();!o.done;o=i.next()){var s=o.value;r=r.concat(s.i)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function Sn(){}function Dn(){this.a=new Sn}function xn(t,r,e){var i=e||"";try{Ge(t,function(t,e){var n=t;P(t)&&(n=Qt(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}function Pn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}wn.prototype.cancel=function(){var e,t;if(this.c=Nn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=E(this.a.values()),r=n.next();!r.done;r=n.next()){r.value.cancel()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.a.clear()}},Sn.prototype.stringify=function(t){return N.JSON.stringify(t,void 0)},Sn.prototype.parse=function(t){return N.JSON.parse(t,void 0)};var On=N.JSON.parse;function kn(t){zt.call(this),this.headers=new Qe,this.G=t||null,this.b=!1,this.s=this.a=null,this.D="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.H=Ln,this.B=this.F=!1}M(kn,zt);var Ln="",Rn=/^https?$/i,Cn=["POST","PUT"];function Vn(t){return"content-type"==t.toLowerCase()}function Un(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Mn(t),Fn(t)}function Mn(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function jn(t){if(t.b&&void 0!==A&&(!t.s[1]||4!=Bn(t)||2!=t.S()))if(t.l&&4==Bn(t))ie(t.va,0,t);else if(t.dispatchEvent("readystatechange"),4==Bn(t)){t.b=!1;try{var e,n=t.S();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.D).match($e)[1]||null;if(!o&&N.self&&N.self.location){var s=N.self.location.protocol;o=s.substr(0,s.length-1)}i=!Rn.test(o?o.toLowerCase():"")}e=i}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var u=2<Bn(t)?t.a.statusText:""}catch(t){u=""}t.f=u+" ["+t.S()+"]",Mn(t)}}finally{Fn(t)}}}function Fn(t,e){if(t.a){qn(t);var n=t.a,r=t.s[0]?S:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function qn(t){t.a&&t.B&&(t.a.ontimeout=null),t.m&&(N.clearTimeout(t.m),t.m=null)}function Bn(t){return t.a?t.a.readyState:0}function zn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var i;r||(i="",Y(n,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),n=i,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):en(t,e,n))}function Gn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Qn(t){this.f=[],this.R=this.ea=this.v=this.P=this.a=this.ha=this.s=this.N=this.h=this.F=this.j=null,this.Fa=this.H=0,this.Ca=Gn("failFast",!1,t),this.U=this.l=this.i=this.g=this.c=null,this.W=!0,this.A=this.ia=this.G=-1,this.J=this.m=this.o=0,this.Ba=Gn("baseRetryDelayMs",5e3,t),this.Ga=Gn("retryDelaySeedMs",1e4,t),this.Da=Gn("forwardChannelMaxRetries",2,t),this.ga=Gn("forwardChannelRequestTimeoutMs",2e4,t),this.Ea=t&&t.nb||void 0,this.D=void 0,this.w=t&&t.supportsCrossDomainXhr||!1,this.B="",this.b=new wn(t&&t.concurrentRequestLimit),this.ja=new Dn,this.fa=t&&t.fastHandshake||!1,t&&t.forceLongPolling&&(this.W=!1),this.O=void 0}function Hn(t){if(Wn(t),3==t.u){var e=t.H++,n=Xe(t.v);en(n,"SID",t.B),en(n,"RID",e),en(n,"TYPE","terminate"),Yn(t,n),(e=new Pe(t,e,void 0)).B=2,e.f=nn(Xe(n)),n=!1,N.navigator&&N.navigator.sendBeacon&&(n=N.navigator.sendBeacon(e.f.toString(),"")),!n&&N.Image&&((new Image).src=e.f,n=!0),n||(e.a=ur(e.g,null),e.a.$(e.f)),e.s=U(),Me(e)}or(t)}function Wn(t){t.a&&(t.a.cancel(),t.a=null),t.i&&(N.clearTimeout(t.i),t.i=null),er(t),t.b.cancel(),t.g&&("number"==typeof t.g&&N.clearTimeout(t.g),t.g=null)}function $n(t,e){t.f.push(new mn(t.Fa++,e)),3==t.u&&Kn(t)}function Kn(t){In(t.b)||t.g||(t.g=!0,Jt(t.xa,t),t.o=0)}function Xn(t,e){var n;n=e?e.W:t.H++;var r=Xe(t.v);en(r,"SID",t.B),en(r,"RID",n),en(r,"AID",t.G),Yn(t,r),t.h&&t.j&&zn(r,t.h,t.j),n=new Pe(t,n,t.o+1),null===t.h&&(n.m=t.j),e&&(t.f=e.i.concat(t.f)),e=Jn(t,n,1e3),n.setTimeout(Math.round(.5*t.ga)+Math.round(.5*t.ga*Math.random())),_n(t.b,n),Re(n,r,e)}function Yn(t,n){t.c&&Ge({},function(t,e){en(n,e,t)})}function Jn(t,e,n){n=Math.min(t.f.length,n);var r=t.c?C(t.c.Ha,t.c,t):null;t:for(var i=t.f,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var u=!0,a=0;a<n;a++){var h=i[a].b,c=i[a].a;if((h-=o)<0)o=Math.max(0,i[a].b-100),u=!1;else try{xn(c,s,"req"+h+"_")}catch(t){r&&r(c)}}if(u){r=s.join("&");break t}}return t=t.f.splice(0,n),e.i=t,r}function Zn(t){t.a||t.i||(t.J=1,Jt(t.wa,t),t.m=0)}function tr(t){return!(t.a||t.i||3<=t.m)&&(t.J++,t.i=we(C(t.wa,t),rr(t,t.m)),t.m++,1)}function er(t){null!=t.l&&(N.clearTimeout(t.l),t.l=null)}function nr(t,e){var n=null;if(t.a==e){er(t),t.a=null;var r=2}else{if(!Tn(t.b,e))return;n=e.i,An(t.b,e),r=1}if(t.A=e.H,0!=t.u)if(e.b)if(1==r){n=e.j?e.j.length:0,e=U()-e.s;var i=t.o;(r=pe()).dispatchEvent(new me(r)),Kn(t)}else Zn(t);else if(3==(i=e.c)||0==i&&0<t.A||!(1==r&&function(t,e){if(!(En(t.b)>=t.b.f-(t.g?1:0))){if(t.g)return t.f=e.i.concat(t.f),1;if(!(1==t.u||2==t.u||t.o>=(t.Ca?0:t.Da)))return t.g=we(C(t.xa,t,e),rr(t,t.o)),t.o++,1}}(t,e)||2==r&&tr(t)))switch(n&&0<n.length&&(e=t.b,e.c=e.c.concat(n)),i){case 1:ir(t,5);break;case 4:ir(t,10);break;case 3:ir(t,6);break;default:ir(t,2)}}function rr(t,e){var n=t.Ba+Math.floor(Math.random()*t.Ga);return t.c||(n*=2),n*e}function ir(t,e){if(2==e){var n=null;t.c&&(n=null);var r=C(t.Ta,t);n||(n=new Ke("//www.google.com/images/cleardot.gif"),N.location&&"http"==N.location.protocol||Ye(n,"https"),nn(n)),function(t,e){var n=new fe;if(N.Image){var r=new Image;r.onload=V(Pn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=V(Pn,n,r,"TestLoadImage: error",!1,e),r.onabort=V(Pn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=V(Pn,n,r,"TestLoadImage: timeout",!1,e),N.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else ge(2);t.u=0,t.c&&t.c.la(e),or(t),Wn(t)}function or(t){t.u=0,t.A=-1,t.c&&(0==Nn(t.b).length&&0==t.f.length||(t.b.c.length=0,z(t.f),t.f.length=0),t.c.ka())}function sr(t,e,n){var r,i,o,s,u,a,h=(r=n)instanceof Ke?Xe(r):new Ke(r,void 0);if(""!=h.c)e&&Je(h,e+"."+h.c),Ze(h,h.h);else{var c=N.location;i=c.protocol,o=e?e+"."+c.hostname:c.hostname,s=+c.port,u=n,a=new Ke(null,void 0),i&&Ye(a,i),o&&Je(a,o),s&&Ze(a,s),u&&(a.g=u),h=a}return t.N&&Y(t.N,function(t,e){en(h,e,t)}),e=t.s,n=t.ha,e&&n&&en(h,e,n),en(h,"VER",t.oa),Yn(t,h),h}function ur(t,e){if(e&&!t.w)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new kn(t.Ea)).F=t.w,e}function ar(){}function hr(){if(ot&&!(10<=Number(mt)))throw Error("Environmental error: no available transport.")}function cr(t,e){zt.call(this),this.a=new Qn(e),this.l=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.j=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.pa&&(t?t["X-WebChannel-Client-Profile"]=e.pa:t={"X-WebChannel-Client-Profile":e.pa}),this.a.F=t,(t=e&&e.httpHeadersOverwriteParam)&&!G(t)&&(this.a.h=t),this.h=e&&e.supportsCrossDomainXhr||!1,this.g=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!G(e)&&(this.a.s=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new pr(this)}function fr(t){Se.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function lr(){De.call(this),this.status=1}function pr(t){this.a=t}(T=kn.prototype).$=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);e=e?e.toUpperCase():"GET",this.D=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.G?Te(this.G):Te(Ae),this.a.onreadystatechange=C(this.va,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void Un(this,t)}t=n||"";var i,o=new Qe(this.headers);r&&Ge(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=Vn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(o.K()),n=N.FormData&&t instanceof N.FormData,0<=F(Cn,e)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.H&&(this.a.responseType=this.H),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{qn(this),0<this.o&&((this.B=(i=this.a,ot&&vt(9)&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.a.timeout=this.o,this.a.ontimeout=C(this.ta,this)):this.m=ie(this.ta,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Un(this,t)}},T.ta=function(){void 0!==A&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},T.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Fn(this))},T.C=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Fn(this,!0)),kn.M.C.call(this)},T.va=function(){this.j||(this.w||this.l||this.g?jn(this):this.Oa())},T.Oa=function(){jn(this)},T.S=function(){try{return 2<Bn(this)?this.a.status:-1}catch(t){return-1}},T.Y=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},T.Ja=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),On(e)}},T.qa=function(){return this.h},T.Ma=function(){return"string"==typeof this.f?this.f:String(this.f)},(T=Qn.prototype).oa=8,T.u=1,T.xa=function(t){if(this.g)if(this.g=null,1==this.u){if(!t){this.H=Math.floor(1e5*Math.random()),t=this.H++;var e,n=new Pe(this,t,void 0),r=this.j;if(this.F&&(r?tt(r=J(r),this.F):r=this.F),null===this.h&&(n.m=r),this.fa)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if("__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o=o.length:o=void 0,void 0===o)break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Jn(this,n,e),en(i=Xe(this.v),"RID",t),en(i,"CVER",22),this.s&&en(i,"X-HTTP-Session-Id",this.s),Yn(this,i),this.h&&r&&zn(i,this.h,r),_n(this.b,n),this.fa?(en(i,"$req",e),en(i,"SID","null"),n.R=!0,Re(n,i,null)):Re(n,i,e),this.u=2}}else 3==this.u&&(t?Xn(this,t):0==this.f.length||In(this.b)||Xn(this))},T.wa=function(){this.i=null,this.a=new Pe(this,"rpc",this.J),null===this.h&&(this.a.m=this.j),this.a.J=0;var t=Xe(this.ea);en(t,"RID","rpc"),en(t,"SID",this.B),en(t,"CI",this.U?"0":"1"),en(t,"AID",this.G),Yn(this,t),en(t,"TYPE","xmlhttp"),this.h&&this.j&&zn(t,this.h,this.j),this.D&&this.a.setTimeout(this.D);var e=this.a,n=this.R;e.B=1,e.f=nn(Xe(t)),e.j=null,e.F=!0,Ce(e,n)},T.Na=function(){null!=this.l&&(this.l=null,this.a.cancel(),this.a=null,tr(this),ge(19))},T.Ta=function(t){ge(t?2:1)},(T=ar.prototype).na=function(){},T.ma=function(){},T.la=function(){},T.ka=function(){},T.Ha=function(){},hr.prototype.a=function(t,e){return new cr(t,e)},M(cr,zt),(T=cr.prototype).addEventListener=function(t,e,n,r){cr.M.addEventListener.call(this,t,e,n,r)},T.removeEventListener=function(t,e,n,r){cr.M.removeEventListener.call(this,t,e,n,r)},T.Ka=function(){this.a.c=this.f,this.h&&(this.a.w=!0);var t=this.a,e=this.l,n=this.b||void 0;ge(0),t.P=e,t.N=n||{},t.U=t.W,t.v=sr(t,null,t.P),Kn(t)},T.close=function(){Hn(this.a)},T.La=function(t){if("string"==typeof t){var e={};e.__data__=t,$n(this.a,e)}else this.g?((e={}).__data__=Qt(t),$n(this.a,e)):$n(this.a,t)},T.C=function(){this.a.c=null,delete this.f,Hn(this.a),delete this.a,cr.M.C.call(this)},M(fr,Se),M(lr,De),M(pr,ar),pr.prototype.na=function(){this.a.dispatchEvent("a")},pr.prototype.ma=function(t){this.a.dispatchEvent(new fr(t))},pr.prototype.la=function(t){this.a.dispatchEvent(new lr)},pr.prototype.ka=function(){this.a.dispatchEvent("b")},hr.prototype.createWebChannel=hr.prototype.a,cr.prototype.send=cr.prototype.La,cr.prototype.open=cr.prototype.Ka,cr.prototype.close=cr.prototype.close,be.NO_ERROR=0,be.TIMEOUT=8,be.HTTP_ERROR=6,Ie.COMPLETE="complete",(_e.EventType=Ne).OPEN="a",Ne.CLOSE="b",Ne.ERROR="c",Ne.MESSAGE="d",zt.prototype.listen=zt.prototype.ra,kn.prototype.listenOnce=kn.prototype.sa,kn.prototype.getLastError=kn.prototype.Ma,kn.prototype.getLastErrorCode=kn.prototype.qa,kn.prototype.getStatus=kn.prototype.S,kn.prototype.getResponseJson=kn.prototype.Ja,kn.prototype.getResponseText=kn.prototype.Y,kn.prototype.send=kn.prototype.$;var dr={createWebChannelTransport:function(){return new hr},ErrorCode:be,EventType:Ie,WebChannel:_e,XhrIo:kn},yr=dr.createWebChannelTransport,vr=dr.ErrorCode,gr=dr.EventType,mr=dr.WebChannel,wr=dr.XhrIo,br=(Ir.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},Ir.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},Ir.prototype.setServiceProps=function(t){return this.serviceProps=t,this},Ir);function Ir(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var Er=Sd.SDK_VERSION,Tr=new h("@firebase/firestore");function _r(){return Tr.logLevel}function Ar(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Tr.logLevel<=p.DEBUG){var r=e.map(Sr);Tr.debug.apply(Tr,d(["Firestore ("+Er+"): "+t],r))}}function Nr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Tr.logLevel<=p.ERROR){var r=e.map(Sr);Tr.error.apply(Tr,d(["Firestore ("+Er+"): "+t],r))}}function Sr(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function Dr(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE ("+Er+") INTERNAL ASSERTION FAILED: "+t;throw Nr(e),new Error(e)}function xr(t){t||Dr()}function Pr(t){return t}function Or(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var kr=(Lr.t=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=Or(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},Lr);function Lr(){}function Rr(t,e){return t<e?-1:e<t?1:0}function Cr(t,n,r){return t.length===n.length&&t.every(function(t,e){return r(t,n[e])})}function Vr(t){return t+"\0"}function Ur(t,e,n,r,i){this.s=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i}var Mr=(Object.defineProperty(jr.prototype,"i",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),jr.prototype.isEqual=function(t){return t instanceof jr&&t.projectId===this.projectId&&t.database===this.database},jr.prototype.o=function(t){return Rr(this.projectId,t.projectId)||Rr(this.database,t.database)},jr);function jr(t,e){this.projectId=t,this.database=e||"(default)"}function Fr(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function qr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Br(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var zr,Gr,Qr,Hr=(hi.prototype.get=function(t){var e=this.h(t),n=this.l[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];if(this.u(s,t))return u}},hi.prototype.has=function(t){return void 0!==this.get(t)},hi.prototype.set=function(t,e){var n=this.h(t),r=this.l[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.u(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.l[n]=[[t,e]]},hi.prototype.delete=function(t){var e=this.h(t),n=this.l[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.u(n[r][0],t))return 1===n.length?delete this.l[e]:n.splice(r,1),!0;return!1},hi.prototype.forEach=function(u){qr(this.l,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],s=i[1];u(o,s)}})},hi.prototype._=function(){return Br(this.l)},hi),Wr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},$r=(n(ai,Qr=Error),ai),Kr=(ui.now=function(){return ui.fromMillis(Date.now())},ui.fromDate=function(t){return ui.fromMillis(t.getTime())},ui.fromMillis=function(t){var e=Math.floor(t/1e3);return new ui(e,1e6*(t-1e3*e))},ui.prototype.toDate=function(){return new Date(this.toMillis())},ui.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},ui.prototype.T=function(t){return this.seconds===t.seconds?Rr(this.nanoseconds,t.nanoseconds):Rr(this.seconds,t.seconds)},ui.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},ui.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},ui.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},ui),Xr=(si.I=function(t){return new si(t)},si.min=function(){return new si(new Kr(0,0))},si.prototype.o=function(t){return this.timestamp.T(t.timestamp)},si.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},si.prototype.m=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},si.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},si.prototype.A=function(){return this.timestamp},si),Yr=(Object.defineProperty(oi.prototype,"length",{get:function(){return this.R},enumerable:!1,configurable:!0}),oi.prototype.isEqual=function(t){return 0===oi.P(this,t)},oi.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof oi?t.forEach(function(t){e.push(t)}):e.push(t),this.V(e)},oi.prototype.limit=function(){return this.offset+this.length},oi.prototype.g=function(t){return t=void 0===t?1:t,this.V(this.segments,this.offset+t,this.length-t)},oi.prototype.p=function(){return this.V(this.segments,this.offset,this.length-1)},oi.prototype.v=function(){return this.segments[this.offset]},oi.prototype.S=function(){return this.get(this.length-1)},oi.prototype.get=function(t){return this.segments[this.offset+t]},oi.prototype._=function(){return 0===this.length},oi.prototype.D=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},oi.prototype.C=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},oi.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},oi.prototype.F=function(){return this.segments.slice(this.offset,this.limit())},oi.P=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},oi),Jr=(n(ii,Gr=Yr),ii.prototype.V=function(t,e,n){return new ii(t,e,n)},ii.prototype.N=function(){return this.F().join("/")},ii.prototype.toString=function(){return this.N()},ii.$=function(t){if(0<=t.indexOf("//"))throw new $r(Wr.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new ii(t.split("/").filter(function(t){return 0<t.length}))},ii.k=function(){return new ii([])},ii),Zr=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ti=(n(ri,zr=Yr),ri.prototype.V=function(t,e,n){return new ri(t,e,n)},ri.M=function(t){return Zr.test(t)},ri.prototype.N=function(){return this.F().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),ri.M(t)||(t="`"+t+"`"),t}).join(".")},ri.prototype.toString=function(){return this.N()},ri.prototype.O=function(){return 1===this.length&&"__name__"===this.get(0)},ri.L=function(){return new ri(["__name__"])},ri.B=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new $r(Wr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new $r(Wr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[r+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new $r(Wr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=u,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new $r(Wr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new ri(e)},ri.k=function(){return new ri([])},ri),ei=(ni.q=function(t){return new ni(Jr.$(t).g(5))},ni.prototype.U=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},ni.prototype.isEqual=function(t){return null!==t&&0===Jr.P(this.path,t.path)},ni.prototype.toString=function(){return this.path.toString()},ni.P=function(t,e){return Jr.P(t.path,e.path)},ni.W=function(t){return t.length%2==0},ni.j=function(t){return new ni(new Jr(t.slice()))},ni);function ni(t){this.path=t}function ri(){return null!==zr&&zr.apply(this,arguments)||this}function ii(){return null!==Gr&&Gr.apply(this,arguments)||this}function oi(t,e,n){void 0===e?e=0:e>t.length&&Dr(),void 0===n?n=t.length-e:n>t.length-e&&Dr(),this.segments=t,this.offset=e,this.R=n}function si(t){this.timestamp=t}function ui(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new $r(Wr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new $r(Wr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new $r(Wr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new $r(Wr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function ai(t,e){var n=this;return(n=Qr.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function hi(t,e){this.h=t,this.u=e,this.l={}}function ci(t){return null==t}function fi(t){return-0===t&&1/t==-1/0}function li(t){return"number"==typeof t&&Number.isInteger(t)&&!fi(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}function pi(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.K=null}function di(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new pi(t,e,n,r,i,o,s)}function yi(t){var e=Pr(t);if(null===e.K){var n=e.path.N();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(function(t){return(e=t).field.N()+e.op.toString()+Eo(e.value);var e}).join(","),n+="|ob:",n+=e.orderBy.map(function(t){return(e=t).field.N()+e.dir;var e}).join(","),ci(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=Fu(e.startAt)),e.endAt&&(n+="|ub:",n+=Fu(e.endAt)),e.K=n}return e.K}function vi(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(r=t.orderBy[n],i=e.orderBy[n],r.dir!==i.dir||!r.field.isEqual(i.field))return!1;var r,i,o,s;if(t.filters.length!==e.filters.length)return!1;for(var u=0;u<t.filters.length;u++)if(o=t.filters[u],s=e.filters[u],!(o instanceof Eu&&s instanceof Eu&&o.op===s.op&&o.field.isEqual(s.field)&&mo(o.value,s.value)))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Bu(t.startAt,e.startAt)&&Bu(t.endAt,e.endAt)}function gi(t){return ei.W(t.path)&&null===t.collectionGroup&&0===t.filters.length}var mi=(wi.fromBase64String=function(t){return new wi(atob(t))},wi.fromUint8Array=function(t){return new wi(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},wi.prototype.toBase64=function(){return t=this.G,btoa(t);var t},wi.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.G)},wi.prototype.H=function(){return 2*this.G.length},wi.prototype.o=function(t){return Rr(this.G,t.G)},wi.prototype.isEqual=function(t){return this.G===t.G},wi);function wi(t){this.G=t}mi.Y=new mi("");function bi(t){this.count=t}var Ii,Ei,Ti=(_i.prototype.Z=function(t){return new _i(this.target,this.targetId,this.J,t,this.X,this.lastLimboFreeSnapshotVersion,this.resumeToken)},_i.prototype.tt=function(t,e){return new _i(this.target,this.targetId,this.J,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},_i.prototype.et=function(t){return new _i(this.target,this.targetId,this.J,this.sequenceNumber,this.X,t,this.resumeToken)},_i);function _i(t,e,n,r,i,o,s){void 0===i&&(i=Xr.min()),void 0===o&&(o=Xr.min()),void 0===s&&(s=mi.Y),this.target=t,this.targetId=e,this.J=n,this.sequenceNumber=r,this.X=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function Ai(t){switch(t){case Wr.OK:return Dr();case Wr.CANCELLED:case Wr.UNKNOWN:case Wr.DEADLINE_EXCEEDED:case Wr.RESOURCE_EXHAUSTED:case Wr.INTERNAL:case Wr.UNAVAILABLE:case Wr.UNAUTHENTICATED:return;case Wr.INVALID_ARGUMENT:case Wr.NOT_FOUND:case Wr.ALREADY_EXISTS:case Wr.PERMISSION_DENIED:case Wr.FAILED_PRECONDITION:case Wr.ABORTED:case Wr.OUT_OF_RANGE:case Wr.UNIMPLEMENTED:case Wr.DATA_LOSS:return 1;default:return Dr()}}function Ni(t){if(void 0===t)return Nr("GRPC error has no .code"),Wr.UNKNOWN;switch(t){case Ii.OK:return Wr.OK;case Ii.CANCELLED:return Wr.CANCELLED;case Ii.UNKNOWN:return Wr.UNKNOWN;case Ii.DEADLINE_EXCEEDED:return Wr.DEADLINE_EXCEEDED;case Ii.RESOURCE_EXHAUSTED:return Wr.RESOURCE_EXHAUSTED;case Ii.INTERNAL:return Wr.INTERNAL;case Ii.UNAVAILABLE:return Wr.UNAVAILABLE;case Ii.UNAUTHENTICATED:return Wr.UNAUTHENTICATED;case Ii.INVALID_ARGUMENT:return Wr.INVALID_ARGUMENT;case Ii.NOT_FOUND:return Wr.NOT_FOUND;case Ii.ALREADY_EXISTS:return Wr.ALREADY_EXISTS;case Ii.PERMISSION_DENIED:return Wr.PERMISSION_DENIED;case Ii.FAILED_PRECONDITION:return Wr.FAILED_PRECONDITION;case Ii.ABORTED:return Wr.ABORTED;case Ii.OUT_OF_RANGE:return Wr.OUT_OF_RANGE;case Ii.UNIMPLEMENTED:return Wr.UNIMPLEMENTED;case Ii.DATA_LOSS:return Wr.DATA_LOSS;default:return Dr()}}(Ei=Ii=Ii||{})[Ei.OK=0]="OK",Ei[Ei.CANCELLED=1]="CANCELLED",Ei[Ei.UNKNOWN=2]="UNKNOWN",Ei[Ei.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ei[Ei.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ei[Ei.NOT_FOUND=5]="NOT_FOUND",Ei[Ei.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ei[Ei.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ei[Ei.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ei[Ei.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ei[Ei.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ei[Ei.ABORTED=10]="ABORTED",Ei[Ei.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ei[Ei.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ei[Ei.INTERNAL=13]="INTERNAL",Ei[Ei.UNAVAILABLE=14]="UNAVAILABLE",Ei[Ei.DATA_LOSS=15]="DATA_LOSS";var Si=(ki.prototype.nt=function(t,e){return new ki(this.P,this.root.nt(t,e,this.P).copy(null,null,xi.st,null,null))},ki.prototype.remove=function(t){return new ki(this.P,this.root.remove(t,this.P).copy(null,null,xi.st,null,null))},ki.prototype.get=function(t){for(var e=this.root;!e._();){var n=this.P(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},ki.prototype.indexOf=function(t){for(var e=0,n=this.root;!n._();){var r=this.P(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},ki.prototype._=function(){return this.root._()},Object.defineProperty(ki.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),ki.prototype.it=function(){return this.root.it()},ki.prototype.rt=function(){return this.root.rt()},ki.prototype.ot=function(t){return this.root.ot(t)},ki.prototype.forEach=function(n){this.ot(function(t,e){return n(t,e),!1})},ki.prototype.toString=function(){var n=[];return this.ot(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},ki.prototype.ht=function(t){return this.root.ht(t)},ki.prototype.at=function(){return new Di(this.root,null,this.P,!1)},ki.prototype.ut=function(t){return new Di(this.root,t,this.P,!1)},ki.prototype.ct=function(){return new Di(this.root,null,this.P,!0)},ki.prototype.lt=function(t){return new Di(this.root,t,this.P,!0)},ki),Di=(Oi.prototype.dt=function(){var t=this.ft.pop(),e={key:t.key,value:t.value};if(this._t)for(t=t.left;!t._();)this.ft.push(t),t=t.right;else for(t=t.right;!t._();)this.ft.push(t),t=t.left;return e},Oi.prototype.wt=function(){return 0<this.ft.length},Oi.prototype.Tt=function(){if(0===this.ft.length)return null;var t=this.ft[this.ft.length-1];return{key:t.key,value:t.value}},Oi),xi=(Pi.prototype.copy=function(t,e,n,r,i){return new Pi(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},Pi.prototype._=function(){return!1},Pi.prototype.ot=function(t){return this.left.ot(t)||t(this.key,this.value)||this.right.ot(t)},Pi.prototype.ht=function(t){return this.right.ht(t)||t(this.key,this.value)||this.left.ht(t)},Pi.prototype.min=function(){return this.left._()?this:this.left.min()},Pi.prototype.it=function(){return this.min().key},Pi.prototype.rt=function(){return this.right._()?this.key:this.right.rt()},Pi.prototype.nt=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.nt(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.nt(t,e,n))).Et()},Pi.prototype.It=function(){if(this.left._())return Pi.EMPTY;var t=this;return t.left.At()||t.left.left.At()||(t=t.Rt()),(t=t.copy(null,null,null,t.left.It(),null)).Et()},Pi.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left._()||r.left.At()||r.left.left.At()||(r=r.Rt()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.At()&&(r=r.Pt()),r.right._()||r.right.At()||r.right.left.At()||(r=r.Vt()),0===e(t,r.key)){if(r.right._())return Pi.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.It())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.Et()},Pi.prototype.At=function(){return this.color},Pi.prototype.Et=function(){var t=this;return t.right.At()&&!t.left.At()&&(t=t.gt()),t.left.At()&&t.left.left.At()&&(t=t.Pt()),t.left.At()&&t.right.At()&&(t=t.yt()),t},Pi.prototype.Rt=function(){var t=this.yt();return t.right.left.At()&&(t=(t=(t=t.copy(null,null,null,null,t.right.Pt())).gt()).yt()),t},Pi.prototype.Vt=function(){var t=this.yt();return t.left.left.At()&&(t=(t=t.Pt()).yt()),t},Pi.prototype.gt=function(){var t=this.copy(null,null,Pi.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},Pi.prototype.Pt=function(){var t=this.copy(null,null,Pi.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},Pi.prototype.yt=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},Pi.prototype.pt=function(){var t=this.bt();return Math.pow(2,t)<=this.size+1},Pi.prototype.bt=function(){if(this.At()&&this.left.At())throw Dr();if(this.right.At())throw Dr();var t=this.left.bt();if(t!==this.right.bt())throw Dr();return t+(this.At()?0:1)},Pi);function Pi(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:Pi.RED,this.left=null!=r?r:Pi.EMPTY,this.right=null!=i?i:Pi.EMPTY,this.size=this.left.size+1+this.right.size}function Oi(t,e,n,r){this._t=r,this.ft=[];for(var i=1;!t._();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this._t?t.left:t.right;else{if(0===i){this.ft.push(t);break}this.ft.push(t),t=this._t?t.right:t.left}}function ki(t,e){this.P=t,this.root=e||xi.EMPTY}function Li(){this.size=0}xi.EMPTY=null,xi.RED=!0,xi.st=!1,xi.EMPTY=(Object.defineProperty(Li.prototype,"key",{get:function(){throw Dr()},enumerable:!1,configurable:!0}),Object.defineProperty(Li.prototype,"value",{get:function(){throw Dr()},enumerable:!1,configurable:!0}),Object.defineProperty(Li.prototype,"color",{get:function(){throw Dr()},enumerable:!1,configurable:!0}),Object.defineProperty(Li.prototype,"left",{get:function(){throw Dr()},enumerable:!1,configurable:!0}),Object.defineProperty(Li.prototype,"right",{get:function(){throw Dr()},enumerable:!1,configurable:!0}),Li.prototype.copy=function(t,e,n,r,i){return this},Li.prototype.nt=function(t,e,n){return new xi(t,e)},Li.prototype.remove=function(t,e){return this},Li.prototype._=function(){return!0},Li.prototype.ot=function(t){return!1},Li.prototype.ht=function(t){return!1},Li.prototype.it=function(){return null},Li.prototype.rt=function(){return null},Li.prototype.At=function(){return!1},Li.prototype.pt=function(){return!0},Li.prototype.bt=function(){return 0},new Li);var Ri=(Mi.prototype.has=function(t){return null!==this.data.get(t)},Mi.prototype.first=function(){return this.data.it()},Mi.prototype.last=function(){return this.data.rt()},Object.defineProperty(Mi.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),Mi.prototype.indexOf=function(t){return this.data.indexOf(t)},Mi.prototype.forEach=function(n){this.data.ot(function(t,e){return n(t),!1})},Mi.prototype.vt=function(t,e){for(var n=this.data.ut(t[0]);n.wt();){var r=n.dt();if(0<=this.P(r.key,t[1]))return;e(r.key)}},Mi.prototype.St=function(t,e){var n;for(n=void 0!==e?this.data.ut(e):this.data.at();n.wt();)if(!t(n.dt().key))return},Mi.prototype.Dt=function(t){var e=this.data.ut(t);return e.wt()?e.dt().key:null},Mi.prototype.at=function(){return new Ci(this.data.at())},Mi.prototype.ut=function(t){return new Ci(this.data.ut(t))},Mi.prototype.add=function(t){return this.copy(this.data.remove(t).nt(t,!0))},Mi.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},Mi.prototype._=function(){return this.data._()},Mi.prototype.Ct=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},Mi.prototype.isEqual=function(t){if(!(t instanceof Mi))return!1;if(this.size!==t.size)return!1;for(var e=this.data.at(),n=t.data.at();e.wt();){var r=e.dt().key,i=n.dt().key;if(0!==this.P(r,i))return!1}return!0},Mi.prototype.F=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},Mi.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},Mi.prototype.copy=function(t){var e=new Mi(this.P);return e.data=t,e},Mi),Ci=(Ui.prototype.dt=function(){return this.Ft.dt().key},Ui.prototype.wt=function(){return this.Ft.wt()},Ui),Vi=new Si(ei.P);function Ui(t){this.Ft=t}function Mi(t){this.P=t,this.data=new Si(this.P)}function ji(){return Vi}function Fi(){return ji()}var qi=new Si(ei.P);function Bi(){return qi}var zi=new Si(ei.P),Gi=new Ri(ei.P);function Qi(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Gi,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Hi=new Ri(Rr);function Wi(){return Hi}function $i(t,e,n,r){this.Zt=t,this.removedTargetIds=e,this.key=n,this.te=r}function Ki(t,e){this.targetId=t,this.ee=e}function Xi(t,e,n,r){void 0===n&&(n=mi.Y),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}var Yi=(co.kt=function(t){return new co(t.P)},co.prototype.has=function(t){return null!=this.Nt.get(t)},co.prototype.get=function(t){return this.Nt.get(t)},co.prototype.first=function(){return this.$t.it()},co.prototype.last=function(){return this.$t.rt()},co.prototype._=function(){return this.$t._()},co.prototype.indexOf=function(t){var e=this.Nt.get(t);return e?this.$t.indexOf(e):-1},Object.defineProperty(co.prototype,"size",{get:function(){return this.$t.size},enumerable:!1,configurable:!0}),co.prototype.forEach=function(n){this.$t.ot(function(t,e){return n(t),!1})},co.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.Nt.nt(t.key,t),e.$t.nt(t,null))},co.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.Nt.remove(t),this.$t.remove(e)):this},co.prototype.isEqual=function(t){if(!(t instanceof co))return!1;if(this.size!==t.size)return!1;for(var e=this.$t.at(),n=t.$t.at();e.wt();){var r=e.dt().key,i=n.dt().key;if(!r.isEqual(i))return!1}return!0},co.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},co.prototype.copy=function(t,e){var n=new co;return n.P=this.P,n.Nt=t,n.$t=e,n},co),Ji=(ho.prototype.track=function(t){var e=t.doc.key,n=this.xt.get(e);!n||0!==t.type&&3===n.type?this.xt=this.xt.nt(e,t):3===t.type&&1!==n.type?this.xt=this.xt.nt(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.xt=this.xt.nt(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.xt=this.xt.nt(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.xt=this.xt.remove(e):1===t.type&&2===n.type?this.xt=this.xt.nt(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.xt=this.xt.nt(e,{type:2,doc:t.doc}):Dr()},ho.prototype.Mt=function(){var n=[];return this.xt.ot(function(t,e){n.push(e)}),n},ho),Zi=(ao.Ut=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:0,doc:t})}),new ao(t,e,Yi.kt(e),i,n,r,!0,!1)},Object.defineProperty(ao.prototype,"hasPendingWrites",{get:function(){return!this.Lt._()},enumerable:!1,configurable:!0}),ao.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.Bt===t.Bt&&this.Lt.isEqual(t.Lt)&&vu(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.Ot.isEqual(t.Ot)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},ao),to=(uo.Gt=function(t,e){var n=new Map;return n.set(t,eo.zt(t,e)),new uo(Xr.min(),n,Wi(),ji(),Qi())},uo),eo=(so.zt=function(t,e){return new so(mi.Y,e,Qi(),Qi(),Qi())},so),no=(Object.defineProperty(oo.prototype,"Ht",{get:function(){return this.re},enumerable:!1,configurable:!0}),Object.defineProperty(oo.prototype,"resumeToken",{get:function(){return this.ie},enumerable:!1,configurable:!0}),Object.defineProperty(oo.prototype,"he",{get:function(){return 0!==this.ne},enumerable:!1,configurable:!0}),Object.defineProperty(oo.prototype,"ae",{get:function(){return this.oe},enumerable:!1,configurable:!0}),oo.prototype.ue=function(t){0<t.H()&&(this.oe=!0,this.ie=t)},oo.prototype.ce=function(){var n=Qi(),r=Qi(),i=Qi();return this.se.forEach(function(t,e){switch(e){case 0:n=n.add(t);break;case 2:r=r.add(t);break;case 1:i=i.add(t);break;default:Dr()}}),new eo(this.ie,this.re,n,r,i)},oo.prototype.le=function(){this.oe=!1,this.se=lo()},oo.prototype._e=function(t,e){this.oe=!0,this.se=this.se.nt(t,e)},oo.prototype.fe=function(t){this.oe=!0,this.se=this.se.remove(t)},oo.prototype.de=function(){this.ne+=1},oo.prototype.we=function(){--this.ne},oo.prototype.Te=function(){this.oe=!0,this.re=!0},oo),ro=(io.prototype.Pe=function(t){for(var e=0,n=t.Zt;e<n.length;e++){var r=n[e];t.te instanceof au?this.Ve(r,t.te):t.te instanceof hu&&this.ge(r,t.key,t.te)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){var s=o[i];this.ge(s,t.key,t.te)}},io.prototype.ye=function(n){var r=this;this.pe(n,function(t){var e=r.be(t);switch(n.state){case 0:r.ve(t)&&e.ue(n.resumeToken);break;case 1:e.we(),e.he||e.le(),e.ue(n.resumeToken);break;case 2:e.we(),e.he||r.removeTarget(t);break;case 3:r.ve(t)&&(e.Te(),e.ue(n.resumeToken));break;case 4:r.ve(t)&&(r.Se(t),e.ue(n.resumeToken));break;default:Dr()}})},io.prototype.pe=function(t,n){var r=this;0<t.targetIds.length?t.targetIds.forEach(n):this.Ie.forEach(function(t,e){r.ve(e)&&n(e)})},io.prototype.De=function(t){var e=t.targetId,n=t.ee.count,r=this.Ce(e);if(r){var i=r.target;if(gi(i))if(0===n){var o=new ei(i.path);this.ge(e,o,new hu(o,Xr.min()))}else xr(1===n);else this.Fe(e)!==n&&(this.Se(e),this.Re=this.Re.add(e))}},io.prototype.Ne=function(i){var o=this,s=new Map;this.Ie.forEach(function(t,e){var n=o.Ce(e);if(n){if(t.Ht&&gi(n.target)){var r=new ei(n.target.path);null!==o.me.get(r)||o.$e(e,r)||o.ge(e,r,new hu(r,i))}t.ae&&(s.set(e,t.ce()),t.le())}});var r=Qi();this.Ae.forEach(function(t,e){var n=!0;e.St(function(t){var e=o.Ce(t);return!e||2===e.J||(n=!1)}),n&&(r=r.add(t))});var t=new to(i,s,this.Re,this.me,r);return this.me=ji(),this.Ae=fo(),this.Re=new Ri(Rr),t},io.prototype.Ve=function(t,e){if(this.ve(t)){var n=this.$e(t,e.key)?2:0;this.be(t)._e(e.key,n),this.me=this.me.nt(e.key,e),this.Ae=this.Ae.nt(e.key,this.ke(e.key).add(t))}},io.prototype.ge=function(t,e,n){if(this.ve(t)){var r=this.be(t);this.$e(t,e)?r._e(e,1):r.fe(e),this.Ae=this.Ae.nt(e,this.ke(e).delete(t)),n&&(this.me=this.me.nt(e,n))}},io.prototype.removeTarget=function(t){this.Ie.delete(t)},io.prototype.Fe=function(t){var e=this.be(t).ce();return this.Ee.xe(t).size+e.Yt.size-e.Xt.size},io.prototype.de=function(t){this.be(t).de()},io.prototype.be=function(t){var e=this.Ie.get(t);return e||(e=new no,this.Ie.set(t,e)),e},io.prototype.ke=function(t){var e=this.Ae.get(t);return e||(e=new Ri(Rr),this.Ae=this.Ae.nt(t,e)),e},io.prototype.ve=function(t){var e=null!==this.Ce(t);return e||Ar("WatchChangeAggregator","Detected inactive target",t),e},io.prototype.Ce=function(t){var e=this.Ie.get(t);return e&&e.he?null:this.Ee.Me(t)},io.prototype.Se=function(e){var n=this;this.Ie.set(e,new no),this.Ee.xe(e).forEach(function(t){n.ge(e,t,null)})},io.prototype.$e=function(t,e){return this.Ee.xe(t).has(e)},io);function io(t){this.Ee=t,this.Ie=new Map,this.me=ji(),this.Ae=fo(),this.Re=new Ri(Rr)}function oo(){this.ne=0,this.se=lo(),this.ie=mi.Y,this.re=!1,this.oe=!0}function so(t,e,n,r,i){this.resumeToken=t,this.Ht=e,this.Yt=n,this.Jt=r,this.Xt=i}function uo(t,e,n,r,i){this.X=t,this.Qt=e,this.Wt=n,this.jt=r,this.Kt=i}function ao(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.Ot=n,this.docChanges=r,this.Lt=i,this.fromCache=o,this.Bt=s,this.qt=u}function ho(){this.xt=new Si(ei.P)}function co(n){this.P=n?function(t,e){return n(t,e)||ei.P(t.key,e.key)}:function(t,e){return ei.P(t.key,e.key)},this.Nt=Bi(),this.$t=new Si(this.P)}function fo(){return new Si(ei.P)}function lo(){return new Si(ei.P)}function po(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function yo(t){var e=To(t.mapValue.fields.__local_write_time__.timestampValue);return new Kr(e.seconds,e.nanos)}var vo=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function go(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?po(t)?4:10:Dr()}function mo(i,t){var e,n,r,o=go(i);if(o!==go(t))return!1;switch(o){case 0:return!0;case 1:return i.booleanValue===t.booleanValue;case 4:return yo(i).isEqual(yo(t));case 3:return function(t){if("string"==typeof i.timestampValue&&"string"==typeof t.timestampValue&&i.timestampValue.length===t.timestampValue.length)return i.timestampValue===t.timestampValue;var e=To(i.timestampValue),n=To(t.timestampValue);return e.seconds===n.seconds&&e.nanos===n.nanos}(t);case 5:return i.stringValue===t.stringValue;case 6:return r=t,Ao(i.bytesValue).isEqual(Ao(r.bytesValue));case 7:return i.referenceValue===t.referenceValue;case 8:return n=t,_o((e=i).geoPointValue.latitude)===_o(n.geoPointValue.latitude)&&_o(e.geoPointValue.longitude)===_o(n.geoPointValue.longitude);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return _o(t.integerValue)===_o(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=_o(t.doubleValue),r=_o(e.doubleValue);return n===r?fi(n)===fi(r):isNaN(n)&&isNaN(r)}return!1}(i,t);case 9:return Cr(i.arrayValue.values||[],t.arrayValue.values||[],mo);case 10:return function(t){var e=i.mapValue.fields||{},n=t.mapValue.fields||{};if(Fr(e)!==Fr(n))return!1;for(var r in e)if(e.hasOwnProperty(r)&&(void 0===n[r]||!mo(e[r],n[r])))return!1;return!0}(t);default:return Dr()}}function wo(t,e){return void 0!==(t.values||[]).find(function(t){return mo(t,e)})}function bo(t,e){var n,r,i,o,s,u,a,h,c,f,l=go(t),p=go(e);if(l!==p)return Rr(l,p);switch(l){case 0:return 0;case 1:return Rr(t.booleanValue,e.booleanValue);case 2:return h=e,c=_o(t.integerValue||t.doubleValue),f=_o(h.integerValue||h.doubleValue),c<f?-1:f<c?1:c===f?0:isNaN(c)?isNaN(f)?0:-1:1;case 3:return Io(t.timestampValue,e.timestampValue);case 4:return Io(yo(t),yo(e));case 5:return Rr(t.stringValue,e.stringValue);case 6:return o=t.bytesValue,s=e.bytesValue,u=Ao(o),a=Ao(s),u.o(a);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Rr(n[i],r[i]);if(0!==o)return o}return Rr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return n=t.geoPointValue,r=e.geoPointValue,0!==(i=Rr(_o(n.latitude),_o(r.latitude)))?i:Rr(_o(n.longitude),_o(r.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=bo(n[i],r[i]);if(o)return o}return Rr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=Rr(r[s],o[s]);if(0!==u)return u;var a=bo(n[r[s]],i[o[s]]);if(0!==a)return a}return Rr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Dr()}}function Io(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Rr(t,e);var n=To(t),r=To(e),i=Rr(n.seconds,r.seconds);return 0!==i?i:Rr(n.nanos,r.nanos)}function Eo(t){return function s(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?"time("+(t=To(i.timestampValue)).seconds+","+t.nanos+")":"stringValue"in i?i.stringValue:"bytesValue"in i?Ao(i.bytesValue).toBase64():"referenceValue"in i?(n=i.referenceValue,ei.q(n).toString()):"geoPointValue"in i?"geo("+(e=i.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in i?function(){for(var t="[",e=!0,n=0,r=i.arrayValue.values||[];n<r.length;n++){e?e=!1:t+=",",t+=s(r[n])}return t+"]"}():"mapValue"in i?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+s(t.fields[o])}return e+"}"}(i.mapValue):Dr();var t,e,n}(t)}function To(t){if(xr(!!t),"string"!=typeof t)return{seconds:_o(t.seconds),nanos:_o(t.nanos)};var e=0,n=vo.exec(t);if(xr(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}function _o(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Ao(t){return"string"==typeof t?mi.fromBase64String(t):mi.fromUint8Array(t)}function No(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.N()}}function So(t){return t&&"integerValue"in t}function Do(t){return!!t&&"arrayValue"in t}function xo(t){return t&&"nullValue"in t}function Po(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Oo(t){return t&&"mapValue"in t}var ko={asc:"ASCENDING",desc:"DESCENDING"},Lo={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Ro=function(t,e){this.s=t,this.Oe=e};function Co(t){return{integerValue:""+t}}function Vo(t,e){if(t.Oe){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:fi(e)?"-0":e}}function Uo(t,e){return li(e)?Co(e):Vo(t,e)}function Mo(t,e){return t.Oe?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function jo(t,e){return t.Oe?e.toBase64():e.toUint8Array()}function Fo(t){return xr(!!t),Xr.I((e=To(t),new Kr(e.seconds,e.nanos)));var e}function qo(t,e){return new Jr(["projects",t.projectId,"databases",t.database]).child("documents").child(e).N()}function Bo(t){var e=Jr.$(t);return xr(is(e)),e}function zo(t,e){return qo(t.s,e.path)}function Go(t,e){var n=Bo(e);return xr(n.get(1)===t.s.projectId),xr(!n.get(3)&&!t.s.database||n.get(3)===t.s.database),new ei($o(n))}function Qo(t,e){return qo(t.s,e)}function Ho(t){var e=Bo(t);return 4===e.length?Jr.k():$o(e)}function Wo(t){return new Jr(["projects",t.s.projectId,"databases",t.s.database]).N()}function $o(t){return xr(4<t.length&&"documents"===t.get(4)),t.g(5)}function Ko(t,e,n){return{name:zo(t,e),fields:n.proto.mapValue.fields}}function Xo(t,e){var n,r,i,o,s,u,a;if(e instanceof Us)n={update:Ko(t,e.key,e.value)};else if(e instanceof Ks)n={delete:zo(t,e.key)};else if(e instanceof Ms)n={update:Ko(t,e.key,e.data),updateMask:(r=e.Le,i=[],r.fields.forEach(function(t){return i.push(t.N())}),{fieldPaths:i})};else if(e instanceof zs)n={transform:{document:zo(t,e.key),fieldTransforms:e.fieldTransforms.map(function(t){return function(t){var e=t.transform;if(e instanceof hs)return{fieldPath:t.field.N(),setToServerValue:"REQUEST_TIME"};if(e instanceof cs)return{fieldPath:t.field.N(),appendMissingElements:{values:e.elements}};if(e instanceof ys)return{fieldPath:t.field.N(),removeAllFromArray:{values:e.elements}};if(e instanceof ws)return{fieldPath:t.field.N(),increment:e.Be};throw Dr()}(t)})}};else{if(!(e instanceof Xs))return Dr();n={verify:zo(t,e.key)}}return e.Ue.qe||(n.currentDocument=(o=t,void 0!==(s=e.Ue).updateTime?{updateTime:(u=o,a=s.updateTime,Mo(u,a.A()))}:void 0!==s.exists?{exists:s.exists}:Dr())),n}function Yo(e,t){var n,r,i=t.currentDocument?void 0!==(n=t.currentDocument).updateTime?Ss.updateTime(Fo(n.updateTime)):void 0!==n.exists?Ss.exists(n.exists):Ss.Qe():Ss.Qe();if(t.update){t.update.name;var o=Go(e,t.update.name),s=new Ys({mapValue:{fields:t.update.fields}});if(t.updateMask){var u=(r=t.updateMask.fieldPaths||[],new Ts(r.map(function(t){return ti.B(t)})));return new Ms(o,s,u,i)}return new Us(o,s,i)}if(t.delete){var a=Go(e,t.delete);return new Ks(a,i)}if(t.transform){var h=Go(e,t.transform.document),c=t.transform.fieldTransforms.map(function(t){return function(t,e){var n=null;if("setToServerValue"in e)xr("REQUEST_TIME"===e.setToServerValue),n=new hs;else if("appendMissingElements"in e){var r=e.appendMissingElements.values||[];n=new cs(r)}else if("removeAllFromArray"in e){var i=e.removeAllFromArray.values||[];n=new ys(i)}else"increment"in e?n=new ws(t,e.increment):Dr();var o=ti.B(e.fieldPath);return new _s(o,n)}(e,t)});return xr(!0===i.exists),new zs(h,c)}if(t.verify){var f=Go(e,t.verify);return new Xs(f,i)}return Dr()}function Jo(t,e){return{documents:[Qo(t,e.path)]}}function Zo(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Qo(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Qo(t,r.p()),n.structuredQuery.from=[{collectionId:r.S()}]);var i=function(t){if(0!==t.length){var e=t.map(function(t){return t instanceof Eu?function(t){if("=="===t.op){if(Po(t.value))return{unaryFilter:{field:ns(t.field),op:"IS_NAN"}};if(xo(t.value))return{unaryFilter:{field:ns(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:ns(t.field),op:(e=t.op,Lo[e]),value:t.value}};var e}(t):Dr()});return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map(function(t){return{field:ns((e=t).field),direction:(n=e.dir,ko[n])};var e,n})}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s,u,a=(s=t,u=e.limit,s.Oe||ci(u)?u:{value:u});return null!==a&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=ts(e.startAt)),e.endAt&&(n.structuredQuery.endAt=ts(e.endAt)),n}function ts(t){return{before:t.before,values:t.position}}function es(t){var e=!!t.before,n=t.values||[];return new Ru(n,e)}function ns(t){return{fieldPath:t.N()}}function rs(t){return ti.B(t.fieldPath)}function is(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}function os(){this.je=void 0}function ss(t,e){return t instanceof ws?So(n=e)||n&&"doubleValue"in n?e:{integerValue:0}:null;var n}var us,as,hs=(n(ls,as=os),ls),cs=(n(fs,us=os),fs);function fs(t){var e=this;return(e=us.call(this)||this).elements=t,e}function ls(){return null!==as&&as.apply(this,arguments)||this}function ps(t,e){for(var n=Es(e),r=function(e){n.some(function(t){return mo(t,e)})||n.push(e)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var ds,ys=(n(vs,ds=os),vs);function vs(t){var e=this;return(e=ds.call(this)||this).elements=t,e}function gs(t,e){for(var n=Es(e),r=function(e){n=n.filter(function(t){return!mo(t,e)})},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var ms,ws=(n(bs,ms=os),bs);function bs(t,e){var n=this;return(n=ms.call(this)||this).serializer=t,n.Be=e,n}function Is(t){return _o(t.integerValue||t.doubleValue)}function Es(t){return Do(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var Ts=(As.prototype.Ke=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].D(t))return!0;return!1},As.prototype.isEqual=function(t){return Cr(this.fields,t.fields,function(t,e){return t.isEqual(e)})},As),_s=function(t,e){this.field=t,this.transform=e};function As(t){(this.fields=t).sort(ti.P)}function Ns(t,e){this.version=t,this.transformResults=e}var Ss=(Ds.Qe=function(){return new Ds},Ds.exists=function(t){return new Ds(void 0,t)},Ds.updateTime=function(t){return new Ds(t)},Object.defineProperty(Ds.prototype,"qe",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),Ds.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},Ds);function Ds(t,e){this.updateTime=t,this.exists=e}function xs(t,e){return void 0!==t.updateTime?e instanceof au&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof au}function Ps(){}function Os(t,e,n){return t instanceof Us?(i=n,new au(t.key,i.version,t.value,{hasCommittedMutations:!0})):t instanceof Ms?function(t,e,n){if(!xs(t.Ue,e))return new cu(t.key,n.version);var r=qs(t,e);return new au(t.key,n.version,r,{hasCommittedMutations:!0})}(t,e,n):t instanceof zs?function(t,e,n){if(xr(null!=n.transformResults),!xs(t.Ue,e))return new cu(t.key,n.version);var r=Qs(0,e),i=function(t,e,n){var r,i,o,s=[];xr(t.length===n.length);for(var u=0;u<n.length;u++){var a=t[u],h=a.transform,c=null;e instanceof au&&(c=e.field(a.field)),s.push((r=h,i=c,o=n[u],r instanceof cs?ps(r,i):r instanceof ys?gs(r,i):o))}return s}(t.fieldTransforms,e,n.transformResults),o=n.version,s=Hs(t,r.data(),i);return new au(t.key,o,s,{hasCommittedMutations:!0})}(t,e,n):(r=n,new hu(t.key,r.version,{hasCommittedMutations:!0}));var r,i}function ks(t,e,n,r){return t instanceof Us?function(t,e){if(!xs(t.Ue,e))return e;var n=Rs(e);return new au(t.key,n,t.value,{Ge:!0})}(t,e):t instanceof Ms?function(t,e){if(!xs(t.Ue,e))return e;var n=Rs(e),r=qs(t,e);return new au(t.key,n,r,{Ge:!0})}(t,e):t instanceof zs?function(t,e,n,r){if(!xs(t.Ue,e))return e;var i=Qs(0,e),o=function(t,e,n,r){for(var i=[],o=0,s=t;o<s.length;o++){var u=s[o],a=u.transform,h=null;n instanceof au&&(h=n.field(u.field)),null===h&&r instanceof au&&(h=r.field(u.field)),i.push((f=h,l=e,v=y=d=p=void 0,(c=a)instanceof hs?(v={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:l.seconds,nanos:l.nanoseconds}}}},f&&(v.fields.__previous_value__=f),{mapValue:v}):c instanceof cs?ps(c,f):c instanceof ys?gs(c,f):(d=ss(p=c,f),y=Is(d)+Is(p.Be),So(d)&&So(p.Be)?Co(y):Vo(p.serializer,y))))}var c,f,l,p,d,y,v;return i}(t.fieldTransforms,n,e,r),s=Hs(t,i.data(),o);return new au(t.key,i.version,s,{Ge:!0})}(t,e,r,n):(o=e,xs((i=t).Ue,o)?new hu(i.key,Xr.min()):o);var i,o}function Ls(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.Ue.isEqual(e.Ue)&&(0===t.type?t.value.isEqual(e.value):1===t.type?t.data.isEqual(e.data)&&t.Le.isEqual(e.Le):2!==t.type||Cr(t.fieldTransforms,t.fieldTransforms,function(t,e){return r=e,(n=t).field.isEqual(r.field)&&(i=n.transform,o=r.transform,i instanceof cs&&o instanceof cs||i instanceof ys&&o instanceof ys?Cr(i.elements,o.elements,mo):i instanceof ws&&o instanceof ws?mo(i.Be,o.Be):i instanceof hs&&o instanceof hs);var n,r,i,o}))}function Rs(t){return t instanceof au?t.version:Xr.min()}var Cs,Vs,Us=(n(Fs,Vs=Ps),Fs),Ms=(n(js,Cs=Ps),js);function js(t,e,n,r){var i=this;return(i=Cs.call(this)||this).key=t,i.data=e,i.Le=n,i.Ue=r,i.type=1,i}function Fs(t,e,n){var r=this;return(r=Vs.call(this)||this).key=t,r.value=e,r.Ue=n,r.type=0,r}function qs(t,e){return n=t,r=e instanceof au?e.data():Ys.empty(),i=new Js(r),n.Le.fields.forEach(function(t){if(!t._()){var e=n.data.field(t);null!==e?i.set(t,e):i.delete(t)}}),i.ze();var n,r,i}var Bs,zs=(n(Gs,Bs=Ps),Gs);function Gs(t,e){var n=this;return(n=Bs.call(this)||this).key=t,n.fieldTransforms=e,n.type=2,n.Ue=Ss.exists(!0),n}function Qs(t,e){return e}function Hs(t,e,n){for(var r=new Js(e),i=0;i<t.fieldTransforms.length;i++){var o=t.fieldTransforms[i];r.set(o.field,n[i])}return r.ze()}var Ws,$s,Ks=(n(nu,$s=Ps),nu),Xs=(n(eu,Ws=Ps),eu),Ys=(tu.empty=function(){return new tu({mapValue:{}})},tu.prototype.field=function(t){if(t._())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!Oo(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.S()])||null},tu.prototype.isEqual=function(t){return mo(this.proto,t.proto)},tu),Js=(Zs.prototype.set=function(t,e){return this.Je(t,e),this},Zs.prototype.delete=function(t){return this.Je(t,null),this},Zs.prototype.Je=function(t,e){for(var n=this.Ye,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map||(o=o&&10===go(o)?new Map(Object.entries(o.mapValue.fields||{})):new Map,n.set(i,o)),n=o}n.set(t.S(),e)},Zs.prototype.ze=function(){var t=this.Xe(ti.k(),this.Ye);return null!=t?new Ys(t):this.He},Zs.prototype.Xe=function(r,t){var i=this,o=!1,e=this.He.field(r),s=Oo(e)?Object.assign({},e.mapValue.fields):{};return t.forEach(function(t,e){if(t instanceof Map){var n=i.Xe(r.child(e),t);null!=n&&(s[e]=n,o=!0)}else null!==t?(s[e]=t,o=!0):s.hasOwnProperty(e)&&(delete s[e],o=!0)}),o?{mapValue:{fields:s}}:null},Zs);function Zs(t){void 0===t&&(t=Ys.empty()),this.He=t,this.Ye=new Map}function tu(t){this.proto=t}function eu(t,e){var n=this;return(n=Ws.call(this)||this).key=t,n.Ue=e,n.type=4,n}function nu(t,e){var n=this;return(n=$s.call(this)||this).key=t,n.Ue=e,n.type=3,n}function ru(t){var u=[];return qr(t.fields||{},function(t,e){var n=new ti([t]);if(Oo(e)){var r=ru(e.mapValue).fields;if(0===r.length)u.push(n);else for(var i=0,o=r;i<o.length;i++){var s=o[i];u.push(n.child(s))}}else u.push(n)}),new Ts(u)}function iu(t,e){this.key=t,this.version=e}var ou,su,uu,au=(n(yu,uu=iu),yu.prototype.field=function(t){return this.Ze.field(t)},yu.prototype.data=function(){return this.Ze},yu.prototype.tn=function(){return this.Ze.proto},yu.prototype.isEqual=function(t){return t instanceof yu&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.Ge===t.Ge&&this.hasCommittedMutations===t.hasCommittedMutations&&this.Ze.isEqual(t.Ze)},yu.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.Ze.toString()+", {hasLocalMutations: "+this.Ge+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(yu.prototype,"hasPendingWrites",{get:function(){return this.Ge||this.hasCommittedMutations},enumerable:!1,configurable:!0}),yu),hu=(n(du,su=iu),du.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(du.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),du.prototype.isEqual=function(t){return t instanceof du&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},du),cu=(n(pu,ou=iu),pu.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(pu.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),pu.prototype.isEqual=function(t){return t instanceof pu&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},pu),fu=(lu.hn=function(t){return new lu(t)},Object.defineProperty(lu.prototype,"orderBy",{get:function(){if(null===this.sn){this.sn=[];var t=this.an(),e=this.un();if(null!==t&&null===e)t.O()||this.sn.push(new zu(t)),this.sn.push(new zu(ti.L(),"asc"));else{for(var n=!1,r=0,i=this.en;r<i.length;r++){var o=i[r];this.sn.push(o),o.field.O()&&(n=!0)}if(!n){var s=0<this.en.length?this.en[this.en.length-1].dir:"asc";this.sn.push(new zu(ti.L(),s))}}}return this.sn},enumerable:!1,configurable:!0}),lu.prototype.cn=function(t){var e=this.filters.concat([t]);return new lu(this.path,this.collectionGroup,this.en.slice(),e,this.limit,this.nn,this.startAt,this.endAt)},lu.prototype.ln=function(t){var e=this.en.concat([t]);return new lu(this.path,this.collectionGroup,e,this.filters.slice(),this.limit,this.nn,this.startAt,this.endAt)},lu.prototype._n=function(t){return new lu(this.path,this.collectionGroup,this.en.slice(),this.filters.slice(),t,"F",this.startAt,this.endAt)},lu.prototype.fn=function(t){return new lu(this.path,this.collectionGroup,this.en.slice(),this.filters.slice(),t,"L",this.startAt,this.endAt)},lu.prototype.dn=function(t){return new lu(this.path,this.collectionGroup,this.en.slice(),this.filters.slice(),this.limit,this.nn,t,this.endAt)},lu.prototype.wn=function(t){return new lu(this.path,this.collectionGroup,this.en.slice(),this.filters.slice(),this.limit,this.nn,this.startAt,t)},lu.prototype.Tn=function(t){return new lu(t,null,this.en.slice(),this.filters.slice(),this.limit,this.nn,this.startAt,this.endAt)},lu.prototype.En=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.en.length||1===this.en.length&&this.en[0].field.O())},lu.prototype.In=function(){return!ci(this.limit)&&"F"===this.nn},lu.prototype.mn=function(){return!ci(this.limit)&&"L"===this.nn},lu.prototype.un=function(){return 0<this.en.length?this.en[0].field:null},lu.prototype.an=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof Eu&&n.An())return n.field}return null},lu.prototype.Rn=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof Eu&&0<=t.indexOf(r.op))return r.op}return null},lu.prototype.Pn=function(){return gi(this.We())},lu.prototype.Vn=function(){return null!==this.collectionGroup},lu.prototype.We=function(){if(!this.rn)if("F"===this.nn)this.rn=di(this.path,this.collectionGroup,this.orderBy,this.filters,this.limit,this.startAt,this.endAt);else{for(var t=[],e=0,n=this.orderBy;e<n.length;e++){var r=n[e],i="desc"===r.dir?"asc":"desc";t.push(new zu(r.field,i))}var o=this.endAt?new Ru(this.endAt.position,!this.endAt.before):null,s=this.startAt?new Ru(this.startAt.position,!this.startAt.before):null;this.rn=di(this.path,this.collectionGroup,t,this.filters,this.limit,o,s)}return this.rn},lu.prototype.on=function(t){},lu);function lu(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.en=n,this.filters=r,this.limit=i,this.nn=o,this.startAt=s,this.endAt=u,this.sn=null,this.rn=null,this.startAt&&this.on(this.startAt),this.endAt&&this.on(this.endAt)}function pu(){return null!==ou&&ou.apply(this,arguments)||this}function du(t,e,n){var r=this;return(r=su.call(this,t,e)||this).hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function yu(t,e,n,r){var i=this;return(i=uu.call(this,t,e)||this).Ze=n,i.Ge=!!r.Ge,i.hasCommittedMutations=!!r.hasCommittedMutations,i}function vu(t,e){return vi(t.We(),e.We())&&t.nn===e.nn}function gu(t){return yi(t.We())+"|lt:"+t.nn}function mu(t){return"Query(target="+(e=t.We(),n=e.path.N(),null!==e.collectionGroup&&(n+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(n+=", filters: ["+e.filters.map(function(t){return(e=t).field.N()+" "+e.op+" "+Eo(e.value);var e}).join(", ")+"]"),ci(e.limit)||(n+=", limit: "+e.limit),0<e.orderBy.length&&(n+=", orderBy: ["+e.orderBy.map(function(t){return(e=t).field.N()+" ("+e.dir+")";var e}).join(", ")+"]"),e.startAt&&(n+=", startAt: "+Fu(e.startAt)),e.endAt&&(n+=", endAt: "+Fu(e.endAt)),"Target("+n+")")+"; limitType="+t.nn+")";var e,n}function wu(i,t){return r=i,o=t.key.path,(null!==r.collectionGroup?t.key.U(r.collectionGroup)&&r.path.D(o):ei.W(r.path)?r.path.isEqual(o):r.path.C(o))&&function(t){for(var e=0,n=i.en;e<n.length;e++){var r=n[e];if(!r.field.O()&&null===t.field(r.field))return}return 1}(t)&&function(t){for(var e=0,n=i.filters;e<n.length;e++)if(!n[e].matches(t))return;return 1}(t)&&(n=t,(!(e=i).startAt||qu(e.startAt,e.orderBy,n))&&(!e.endAt||!qu(e.endAt,e.orderBy,n)));var e,n,r,o}function bu(u){return function(t,e){for(var n=!1,r=0,i=u.orderBy;r<i.length;r++){var o=i[r],s=Gu(o,t,e);if(0!==s)return s;n=n||o.field.O()}return 0}}var Iu,Eu=(n(Tu,Iu=function(){}),Tu.create=function(t,e,n){if(t.O())return"in"===e?new Pu(t,n):new xu(t,e,n);if(xo(n)){if("=="!==e)throw new $r(Wr.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new Tu(t,e,n)}if(Po(n)){if("=="!==e)throw new $r(Wr.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new Tu(t,e,n)}return"array-contains"===e?new Ou(t,n):"in"===e?new ku(t,n):"array-contains-any"===e?new Lu(t,n):new Tu(t,e,n)},Tu.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&go(this.value)===go(e)&&this.gn(bo(e,this.value))},Tu.prototype.gn=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case">":return 0<t;case">=":return 0<=t;default:return Dr()}},Tu.prototype.An=function(){return 0<=["<","<=",">",">="].indexOf(this.op)},Tu);function Tu(t,e,n){var r=this;return(r=Iu.call(this)||this).field=t,r.op=e,r.value=n,r}var _u,Au,Nu,Su,Du,xu=(n(ju,Du=Eu),ju.prototype.matches=function(t){var e=ei.P(t.key,this.key);return this.gn(e)},ju),Pu=(n(Mu,Su=Eu),Mu.prototype.matches=function(e){return this.keys.some(function(t){return t.isEqual(e.key)})},Mu),Ou=(n(Uu,Nu=Eu),Uu.prototype.matches=function(t){var e=t.field(this.field);return Do(e)&&wo(e.arrayValue,this.value)},Uu),ku=(n(Vu,Au=Eu),Vu.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&wo(this.value.arrayValue,e)},Vu),Lu=(n(Cu,_u=Eu),Cu.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!Do(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return wo(e.value.arrayValue,t)})},Cu),Ru=function(t,e){this.position=t,this.before=e};function Cu(t,e){return _u.call(this,t,"array-contains-any",e)||this}function Vu(t,e){return Au.call(this,t,"in",e)||this}function Uu(t,e){return Nu.call(this,t,"array-contains",e)||this}function Mu(t,e){var n=this;return(n=Su.call(this,t,"in",e)||this).keys=(e.arrayValue.values||[]).map(function(t){return ei.q(t.referenceValue)}),n}function ju(t,e,n){var r=this;return(r=Du.call(this,t,e,n)||this).key=ei.q(n.referenceValue),r}function Fu(t){return(t.before?"b":"a")+":"+t.position.map(function(t){return Eo(t)}).join(",")}function qu(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.O()?ei.P(ei.q(s.referenceValue),n.key):bo(s,n.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function Bu(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!mo(t.position[n],e.position[n]))return!1;return!0}var zu=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function Gu(t,e,n){var r,i,o,s,u=t.field.O()?ei.P(e.key,n.key):(r=t.field,i=n,o=e.field(r),s=i.field(r),null!==o&&null!==s?bo(o,s):Dr());switch(t.dir){case"asc":return u;case"desc":return-1*u;default:return Dr()}}var Qu=(ua.prototype.pn=function(t,e,n){for(var r=n.bn,i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(t)&&(e=Os(o,e,r[i]))}return e},ua.prototype.vn=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=ks(i,e,e,this.yn))}for(var o=e,s=0,u=this.mutations;s<u.length;s++){var a=u[s];a.key.isEqual(t)&&(e=ks(a,e,o,this.yn))}return e},ua.prototype.Sn=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.vn(t.key,n.get(t.key));e&&(i=i.nt(t.key,e))}),i},ua.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Qi())},ua.prototype.isEqual=function(t){return this.batchId===t.batchId&&Cr(this.mutations,t.mutations,function(t,e){return Ls(t,e)})&&Cr(this.baseMutations,t.baseMutations,function(t,e){return Ls(t,e)})},ua),Hu=(sa.from=function(t,e,n){xr(t.mutations.length===n.length);for(var r=zi,i=t.mutations,o=0;o<i.length;o++)r=r.nt(i[o].key,n[o].version);return new sa(t,e,n,r)},sa),Wu=(oa.prototype.catch=function(t){return this.next(void 0,t)},oa.prototype.next=function(r,i){var o=this;return this.kn&&Dr(),this.kn=!0,this.$n?this.error?this.xn(i,this.error):this.Mn(r,this.result):new oa(function(e,n){o.Fn=function(t){o.Mn(r,t).next(e,n)},o.Nn=function(t){o.xn(i,t).next(e,n)}})},oa.prototype.On=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},oa.prototype.Ln=function(t){try{var e=t();return e instanceof oa?e:oa.resolve(e)}catch(t){return oa.reject(t)}},oa.prototype.Mn=function(t,e){return t?this.Ln(function(){return t(e)}):oa.resolve(e)},oa.prototype.xn=function(t,e){return t?this.Ln(function(){return t(e)}):oa.reject(e)},oa.resolve=function(n){return new oa(function(t,e){t(n)})},oa.reject=function(n){return new oa(function(t,e){e(n)})},oa.Bn=function(t){return new oa(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},oa.qn=function(t){for(var n=oa.resolve(!1),e=function(e){n=n.next(function(t){return t?oa.resolve(t):e()})},r=0,i=t;r<i.length;r++)e(i[r]);return n},oa.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.Bn(i)},oa),$u=(Object.defineProperty(ia.prototype,"readTime",{get:function(){return this.Wn},set:function(t){this.Wn=t},enumerable:!1,configurable:!0}),ia.prototype.jn=function(t,e){this.Kn(),this.readTime=e,this.Un.set(t.key,t)},ia.prototype.Gn=function(t,e){this.Kn(),e&&(this.readTime=e),this.Un.set(t,null)},ia.prototype.zn=function(t,e){this.Kn();var n=this.Un.get(e);return void 0!==n?Wu.resolve(n):this.Hn(t,e)},ia.prototype.getEntries=function(t,e){return this.Yn(t,e)},ia.prototype.apply=function(t){return this.Kn(),this.Qn=!0,this.Jn(t)},ia.prototype.Kn=function(){},ia),Ku="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Xu=(ra.prototype.Zn=function(t){this.Xn.push(t)},ra.prototype.ts=function(){this.Xn.forEach(function(t){return t()})},ra),Yu=(na.prototype.rs=function(e,n){var r=this;return this.ns.os(e,n).next(function(t){return r.hs(e,n,t)})},na.prototype.hs=function(t,r,i){return this.es.zn(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].vn(r,t);return t})},na.prototype.as=function(t,e,i){var o=Fi();return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].vn(t,e);o=o.nt(t,e)}),o},na.prototype.us=function(e,t){var n=this;return this.es.getEntries(e,t).next(function(t){return n.cs(e,t)})},na.prototype.cs=function(r,i){var o=this;return this.ns.ls(r,i).next(function(t){var e=o.as(r,i,t),n=ji();return e.forEach(function(t,e){e=e||new hu(t,Xr.min()),n=n.nt(t,e)}),n})},na.prototype._s=function(t,e,n){return e.Pn()?this.fs(t,e.path):e.Vn()?this.ds(t,e,n):this.ws(t,e,n)},na.prototype.fs=function(t,e){return this.rs(t,new ei(e)).next(function(t){var e=Bi();return t instanceof au&&(e=e.nt(t.key,t)),e})},na.prototype.ds=function(n,r,i){var o=this,s=r.collectionGroup,u=Bi();return this.ss.Ts(n,s).next(function(t){return Wu.forEach(t,function(t){var e=r.Tn(t.child(s));return o.ws(n,e,i).next(function(t){t.forEach(function(t,e){u=u.nt(t,e)})})}).next(function(){return u})})},na.prototype.ws=function(e,n,t){var c,f,r=this;return this.es._s(e,n,t).next(function(t){return c=t,r.ns.Es(e,n)}).next(function(t){return f=t,r.Is(e,f,c).next(function(t){c=t;for(var e=0,n=f;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],u=s.key,a=c.get(u),h=ks(s,a,a,r.yn);c=h instanceof au?c.nt(u,h):c.remove(u)}})}).next(function(){return c.forEach(function(t,e){wu(n,e)||(c=c.remove(t))}),c})},na.prototype.Is=function(t,e,n){for(var r=Qi(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof Ms&&null===n.get(a.key)&&(r=r.add(a.key))}var h=n;return this.es.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof au&&(h=h.nt(t,e))}),h})},na),Ju=(ea.Rs=function(t,e){for(var n=Qi(),r=Qi(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new ea(t,e.fromCache,n,r)},ea),Zu=(ta.prototype.Vs=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},ta.prototype.next=function(){var t=++this.previousValue;return this.gs&&this.gs(t),t},ta);function ta(t,e){var n=this;this.previousValue=t,e&&(e.Ps=function(t){return n.Vs(t)},this.gs=function(t){return e.ys(t)})}function ea(t,e,n,r){this.targetId=t,this.fromCache=e,this.ms=n,this.As=r}function na(t,e,n){this.es=t,this.ns=e,this.ss=n}function ra(){this.Xn=[]}function ia(){this.Un=new Hr(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.Qn=!1}function oa(t){var e=this;this.Fn=null,this.Nn=null,this.result=void 0,this.error=void 0,this.$n=!1,this.kn=!1,t(function(t){e.$n=!0,e.result=t,e.Fn&&e.Fn(t)},function(t){e.$n=!0,e.error=t,e.Nn&&e.Nn(t)})}function sa(t,e,n,r){this.batch=t,this.Dn=e,this.bn=n,this.Cn=r}function ua(t,e,n,r){this.batchId=t,this.yn=e,this.baseMutations=n,this.mutations=r}Zu.ps=-1;function aa(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})}var ha=(ca.prototype.reset=function(){this.Fs=0},ca.prototype.ks=function(){this.Fs=this.Cs},ca.prototype.xs=function(t){var e=this;this.cancel();var n=Math.floor(this.Fs+this.Ms()),r=Math.max(0,Date.now()-this.$s),i=Math.max(0,n-r);0<i&&Ar("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.Fs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ns=this.bs.Os(this.vs,i,function(){return e.$s=Date.now(),t()}),this.Fs*=this.Ds,this.Fs<this.Ss&&(this.Fs=this.Ss),this.Fs>this.Cs&&(this.Fs=this.Cs)},ca.prototype.Ls=function(){null!==this.Ns&&(this.Ns.Bs(),this.Ns=null)},ca.prototype.cancel=function(){null!==this.Ns&&(this.Ns.cancel(),this.Ns=null)},ca.prototype.Ms=function(){return(Math.random()-.5)*this.Fs},ca);function ca(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.bs=t,this.vs=e,this.Ss=n,this.Ds=r,this.Cs=i,this.Fs=0,this.Ns=null,this.$s=Date.now(),this.reset()}function fa(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=pa(e)),e=la(t.get(n),e);return pa(e)}function la(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function pa(t){return t+""}function da(t){var e=t.length;if(xr(2<=e),2===e)return xr(""===t.charAt(0)&&""===t.charAt(1)),Jr.k();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||n<s)&&Dr(),t.charAt(s+1)){case"":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:Dr()}o=s+2}return new Jr(r)}var ya=(ba.prototype.Us=function(t,e){return this.qs.add(e),Wu.resolve()},ba.prototype.Ts=function(t,e){return Wu.resolve(this.qs.getEntries(e))},ba),va=(wa.prototype.add=function(t){var e=t.S(),n=t.p(),r=this.index[e]||new Ri(Jr.P),i=!r.has(n);return this.index[e]=r.add(n),i},wa.prototype.has=function(t){var e=t.S(),n=t.p(),r=this.index[e];return r&&r.has(n)},wa.prototype.getEntries=function(t){return(this.index[t]||new Ri(Jr.P)).F()},wa),ga=(ma.prototype.Us=function(t,e){var n=this;if(this.Qs.has(e))return Wu.resolve();var r=e.S(),i=e.p();t.Zn(function(){n.Qs.add(e)});var o={collectionId:r,parent:fa(i)};return Ia(t).put(o)},ma.prototype.Ts=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[Vr(i),""],!1,!0);return Ia(t).Ws(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(da(r.parent))}return o})},ma);function ma(){this.Qs=new va}function wa(){this.index={}}function ba(){this.qs=new va}function Ia(t){return Xa.js(t,Dh.store)}function Ea(t){this.Ks=t}function Ta(t,e){if(e.document)return n=t.Ks,r=e.document,i=!!e.hasCommittedMutations,o=Go(n,r.name),s=Fo(r.updateTime),u=new Ys({mapValue:{fields:r.fields}}),new au(o,s,u,{hasCommittedMutations:!!i});var n,r,i,o,s,u;if(e.noDocument){var a=ei.j(e.noDocument.path),h=Da(e.noDocument.readTime);return new hu(a,h,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){var c=ei.j(e.unknownDocument.path),f=Da(e.unknownDocument.version);return new cu(c,f)}return Dr()}function _a(t,e,n){var r,i,o=Aa(n),s=e.key.path.p().F();if(e instanceof au){var u={name:zo(r=t.Ks,(i=e).key),fields:i.tn().mapValue.fields,updateTime:Mo(r,i.version.A())},a=e.hasCommittedMutations;return new Th(null,null,u,a,o,s)}if(e instanceof hu){var h=e.key.path.F(),c=Sa(e.version),f=e.hasCommittedMutations;return new Th(null,new Ih(h,c),null,f,o,s)}if(e instanceof cu){var l=e.key.path.F(),p=Sa(e.version);return new Th(new Eh(l,p),null,null,!0,o,s)}return Dr()}function Aa(t){var e=t.A();return[e.seconds,e.nanoseconds]}function Na(t){var e=new Kr(t[0],t[1]);return Xr.I(e)}function Sa(t){var e=t.A();return new dh(e.seconds,e.nanoseconds)}function Da(t){var e=new Kr(t.seconds,t.nanoseconds);return Xr.I(e)}function xa(e,t){var n=(t.baseMutations||[]).map(function(t){return Yo(e.Ks,t)}),r=t.mutations.map(function(t){return Yo(e.Ks,t)}),i=Kr.fromMillis(t.localWriteTimeMs);return new Qu(t.batchId,i,n,r)}function Pa(t){var e,n=Da(t.readTime),r=void 0!==t.lastLimboFreeSnapshotVersion?Da(t.lastLimboFreeSnapshotVersion):Xr.min();return e=(void 0!==t.query.documents?function(t){xr(1===t.documents.length);var e=t.documents[0];return fu.hn(Ho(e)).We()}:function(t){var e=Ho(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(0<r){xr(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=function e(t){return t?void 0!==t.unaryFilter?[function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=rs(t.unaryFilter.field);return Eu.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=rs(t.unaryFilter.field);return Eu.create(n,"==",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Dr()}}(t)]:void 0!==t.fieldFilter?[(n=t,Eu.create(rs(n.fieldFilter.field),function(){switch(n.fieldFilter.op){case"EQUAL":return"==";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Dr()}}(),n.fieldFilter.value))]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e(t)}).reduce(function(t,e){return t.concat(e)}):Dr():[];var n}(n.where));var u=[];n.orderBy&&(u=n.orderBy.map(function(t){return new zu(rs((e=t).field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}());var e}));var a,h,c=null;n.limit&&(a=n.limit,c=ci(h="object"==typeof a?a.value:a)?null:h);var f=null;n.startAt&&(f=es(n.startAt));var l=null;return n.endAt&&(l=es(n.endAt)),new fu(e,i,u,s,c,"F",f,l).We()})(t.query),new Ti(e,t.targetId,0,t.lastListenSequenceNumber,n,r,mi.fromBase64String(t.resumeToken))}function Oa(t,e){var n,r=Sa(e.X),i=Sa(e.lastLimboFreeSnapshotVersion);n=(gi(e.target)?Jo:Zo)(t.Ks,e.target);var o=e.resumeToken.toBase64();return new Ah(e.targetId,yi(e.target),r,o,e.sequenceNumber,i,n)}var ka,La=(Ra.prototype.jn=function(t,e,n){return Va(t).put(Ua(e),n)},Ra.prototype.Gn=function(t,e){var n=Va(t),r=Ua(e);return n.delete(r)},Ra.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.Gs(e,t)})},Ra.prototype.zn=function(t,e){var n=this;return Va(t).get(Ua(e)).next(function(t){return n.zs(t)})},Ra.prototype.Hs=function(t,e){var n=this;return Va(t).get(Ua(e)).next(function(t){var e=n.zs(t);return e?{Ys:e,size:Ma(t)}:null})},Ra.prototype.getEntries=function(t,e){var r=this,i=Fi();return this.Js(t,e,function(t,e){var n=r.zs(e);i=i.nt(t,n)}).next(function(){return i})},Ra.prototype.Xs=function(t,e){var r=this,i=Fi(),o=new Si(ei.P);return this.Js(t,e,function(t,e){var n=r.zs(e);o=n?(i=i.nt(t,n),o.nt(t,Ma(e))):(i=i.nt(t,null),o.nt(t,0))}).next(function(){return{Zs:i,ti:o}})},Ra.prototype.Js=function(t,e,i){if(e._())return Wu.resolve();var n=IDBKeyRange.bound(e.first().path.F(),e.last().path.F()),o=e.at(),s=o.dt();return Va(t).ei({range:n},function(t,e,n){for(var r=ei.j(t);s&&ei.P(s,r)<0;)i(s,null),s=o.dt();s&&s.isEqual(r)&&(i(s,e),s=o.wt()?o.dt():null),s?n.ni(s.path.F()):n.done()}).next(function(){for(;s;)i(s,null),s=o.wt()?o.dt():null})},Ra.prototype._s=function(t,i,e){var o=this,s=Bi(),u=i.path.length+1,n={};if(e.isEqual(Xr.min())){var r=i.path.F();n.range=IDBKeyRange.lowerBound(r)}else{var a=i.path.F(),h=Aa(e);n.range=IDBKeyRange.lowerBound([a,h],!0),n.index=Th.collectionReadTimeIndex}return Va(t).ei(n,function(t,e,n){if(t.length===u){var r=Ta(o.serializer,e);i.path.D(r.key.path)?r instanceof au&&wu(i,r)&&(s=s.nt(r.key,r)):n.done()}}).next(function(){return s})},Ra.prototype.si=function(t,e){var r=this,i=ji(),o=Aa(e),n=Va(t),s=IDBKeyRange.lowerBound(o,!0);return n.ei({index:Th.readTimeIndex,range:s},function(t,e){var n=Ta(r.serializer,e);i=i.nt(n.key,n),o=e.readTime}).next(function(){return{ii:i,readTime:Na(o)}})},Ra.prototype.ri=function(t){var e=Va(t),r=Xr.min();return e.ei({index:Th.readTimeIndex,reverse:!0},function(t,e,n){e.readTime&&(r=Na(e.readTime)),n.done()}).next(function(){return r})},Ra.prototype.oi=function(t){return new Ra.hi(this,!!t&&t.ai)},Ra.prototype.ui=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},Ra.prototype.getMetadata=function(t){return Ca(t).get(_h.key).next(function(t){return xr(!!t),t})},Ra.prototype.Gs=function(t,e){return Ca(t).put(_h.key,e)},Ra.prototype.zs=function(t){if(t){var e=Ta(this.serializer,t);return e instanceof hu&&e.version.isEqual(Xr.min())?null:e}return null},Ra);function Ra(t,e){this.serializer=t,this.ss=e}function Ca(t){return Xa.js(t,_h.store)}function Va(t){return Xa.js(t,Th.store)}function Ua(t){return t.path.F()}function Ma(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Dr();e=t.noDocument}return JSON.stringify(e).length}function ja(t,e){var n=this;return(n=ka.call(this)||this).ci=t,n.ai=e,n.li=new Hr(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),n}La.hi=(n(ja,ka=$u),ja.prototype.Jn=function(s){var u=this,a=[],h=0,c=new Ri(function(t,e){return Rr(t.N(),e.N())});return this.Un.forEach(function(t,e){var n=u.li.get(t);if(e){var r=_a(u.ci.serializer,e,u.readTime);c=c.add(t.path.p());var i=Ma(r);h+=i-n,a.push(u.ci.jn(s,t,r))}else if(h-=n,u.ai){var o=_a(u.ci.serializer,new hu(t,Xr.min()),u.readTime);a.push(u.ci.jn(s,t,o))}else a.push(u.ci.Gn(s,t))}),c.forEach(function(t){a.push(u.ci.ss.Us(s,t))}),a.push(this.ci.updateMetadata(s,h)),Wu.Bn(a)},ja.prototype.Hn=function(t,e){var n=this;return this.ci.Hs(t,e).next(function(t){return null===t?(n.li.set(e,0),null):(n.li.set(e,t.size),t.Ys)})},ja.prototype.Yn=function(t,e){var n=this;return this.ci.Xs(t,e).next(function(t){var e=t.Zs;return t.ti.forEach(function(t,e){n.li.set(t,e)}),e})},ja);var Fa=(za.prototype.next=function(){return this._i+=2,this._i},za.fi=function(){return new za(0)},za.di=function(){return new za(-1)},za),qa=(Ba.prototype.Ti=function(n){var r=this;return this.Ei(n).next(function(t){var e=new Fa(t.highestTargetId);return t.highestTargetId=e.next(),r.Ii(n,t).next(function(){return t.highestTargetId})})},Ba.prototype.mi=function(t){return this.Ei(t).next(function(t){return Xr.I(new Kr(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},Ba.prototype.Ai=function(t){return this.Ei(t).next(function(t){return t.highestListenSequenceNumber})},Ba.prototype.Ri=function(e,n,r){var i=this;return this.Ei(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.A()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.Ii(e,t)})},Ba.prototype.Pi=function(e,n){var r=this;return this.Vi(e,n).next(function(){return r.Ei(e).next(function(t){return t.targetCount+=1,r.gi(n,t),r.Ii(e,t)})})},Ba.prototype.yi=function(t,e){return this.Vi(t,e)},Ba.prototype.pi=function(e,t){var n=this;return this.bi(e,t.targetId).next(function(){return Ga(e).delete(t.targetId)}).next(function(){return n.Ei(e)}).next(function(t){return xr(0<t.targetCount),--t.targetCount,n.Ii(e,t)})},Ba.prototype.vi=function(r,i,o){var s=this,u=0,a=[];return Ga(r).ei(function(t,e){var n=Pa(e);n.sequenceNumber<=i&&null===o.get(n.targetId)&&(u++,a.push(s.pi(r,n)))}).next(function(){return Wu.Bn(a)}).next(function(){return u})},Ba.prototype.pe=function(t,r){return Ga(t).ei(function(t,e){var n=Pa(e);r(n)})},Ba.prototype.Ei=function(t){return Qa(t).get(Sh.key).next(function(t){return xr(null!==t),t})},Ba.prototype.Ii=function(t,e){return Qa(t).put(Sh.key,e)},Ba.prototype.Vi=function(t,e){return Ga(t).put(Oa(this.serializer,e))},Ba.prototype.gi=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},Ba.prototype.Si=function(t){return this.Ei(t).next(function(t){return t.targetCount})},Ba.prototype.Di=function(t,i){var e=yi(i),n=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),o=null;return Ga(t).ei({range:n,index:Ah.queryTargetsIndexName},function(t,e,n){var r=Pa(e);vi(i,r.target)&&(o=r,n.done())}).next(function(){return o})},Ba.prototype.Ci=function(n,t,r){var i=this,o=[],s=Ha(n);return t.forEach(function(t){var e=fa(t.path);o.push(s.put(new Nh(r,e))),o.push(i.wi.Fi(n,r,t))}),Wu.Bn(o)},Ba.prototype.Ni=function(n,t,r){var i=this,o=Ha(n);return Wu.forEach(t,function(t){var e=fa(t.path);return Wu.Bn([o.delete([r,e]),i.wi.$i(n,r,t)])})},Ba.prototype.bi=function(t,e){var n=Ha(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},Ba.prototype.ki=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Ha(t),o=Qi();return r.ei({range:n,xi:!0},function(t,e,n){var r=da(t[1]),i=new ei(r);o=o.add(i)}).next(function(){return o})},Ba.prototype.Mi=function(t,e){var n=fa(e.path),r=IDBKeyRange.bound([n],[Vr(n)],!1,!0),i=0;return Ha(t).ei({index:Nh.documentTargetsIndex,xi:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},Ba.prototype.Me=function(t,e){return Ga(t).get(e).next(function(t){return t?Pa(t):null})},Ba);function Ba(t,e){this.wi=t,this.serializer=e}function za(t){this._i=t}function Ga(t){return Xa.js(t,Ah.store)}function Qa(t){return Xa.js(t,Sh.store)}function Ha(t){return Xa.js(t,Nh.store)}var Wa,$a="Failed to obtain exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Ka=(n(Ja,Wa=Xu),Ja),Xa=(Ya.js=function(t,e){if(t instanceof Ka)return Lh.js(t.Oi,e);throw Dr()},Ya.prototype.start=function(){var e=this;return Lh.Zi(this.Yi,lh,new ph(this.serializer)).then(function(t){return e.tr=t,e.er()}).then(function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new $r(Wr.FAILED_PRECONDITION,$a);return e.nr(),e.sr(),e.ir(),e.runTransaction("getHighestListenSequenceNumber","readonly",function(t){return e.Ji.Ai(t)})}).then(function(t){e.Ui=new Zu(t,e.Bi)}).then(function(){e.Qi=!0}).catch(function(t){return e.tr&&e.tr.close(),Promise.reject(t)})},Ya.prototype.rr=function(n){var t=this;return this.zi=function(e){return y(t,void 0,void 0,function(){return v(this,function(t){return this.or?[2,n(e)]:[2]})})},n(this.isPrimary)},Ya.prototype.hr=function(n){var t=this;this.tr.ar(function(e){return y(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return null===e.newVersion?[4,n()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},Ya.prototype.ur=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.bs.cr(function(){return y(e,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.or?[4,this.er()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},Ya.prototype.er=function(){var n=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return th(e).put(new Ph(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n.lr(e).next(function(t){t||(n.isPrimary=!1,n.bs._r(function(){return n.zi(!1)}))})}).next(function(){return n.dr(e)}).next(function(t){return n.isPrimary&&!t?n.wr(e).next(function(){return!1}):!!t&&n.Tr(e).next(function(){return!0})})}).catch(function(t){if(jh(t))return Ar("IndexedDbPersistence","Failed to extend owner lease: ",t),n.isPrimary;if(!n.allowTabSynchronization)throw t;return Ar("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(function(t){n.isPrimary!==t&&n.bs._r(function(){return n.zi(t)}),n.isPrimary=t})},Ya.prototype.lr=function(t){var e=this;return Za(t).get(yh.key).next(function(t){return Wu.resolve(e.Er(t))})},Ya.prototype.Ir=function(t){return th(t).delete(this.clientId)},Ya.prototype.mr=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o=this;return v(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.Ar(this.Gi,18e5)?[3,2]:(this.Gi=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var r=Ya.js(t,Ph.store);return r.Ws().next(function(t){var e=o.Rr(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return Wu.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})}).catch(function(){return[]})]);case 1:if(e=t.sent(),this.Xi)for(n=0,r=e;n<r.length;n++)i=r[n],this.Xi.removeItem(this.Pr(i.clientId));t.label=2;case 2:return[2]}})})},Ya.prototype.ir=function(){var t=this;this.Ki=this.bs.Os("client_metadata_refresh",4e3,function(){return t.er().then(function(){return t.mr()}).then(function(){return t.ir()})})},Ya.prototype.Er=function(t){return!!t&&t.ownerId===this.clientId},Ya.prototype.dr=function(e){var i=this;return this.qi?Wu.resolve(!0):Za(e).get(yh.key).next(function(t){if(null!==t&&i.Ar(t.leaseTimestampMs,5e3)&&!i.Vr(t.ownerId)){if(i.Er(t)&&i.networkEnabled)return!0;if(!i.Er(t)){if(!t.allowTabSynchronization)throw new $r(Wr.FAILED_PRECONDITION,$a);return!1}}return!(!i.networkEnabled||!i.inForeground)||th(e).Ws().next(function(t){return void 0===i.Rr(t,5e3).find(function(t){if(i.clientId!==t.clientId){var e=!i.networkEnabled&&t.networkEnabled,n=!i.inForeground&&t.inForeground,r=i.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1})})}).next(function(t){return i.isPrimary!==t&&Ar("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},Ya.prototype.gr=function(){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:return this.Qi=!1,this.yr(),this.Ki&&(this.Ki.cancel(),this.Ki=null),this.pr(),this.br(),[4,this.runTransaction("shutdown","readwrite",function(t){return e.wr(t).next(function(){return e.Ir(t)})}).catch(function(t){Ar("IndexedDbPersistence","Proceeding with shutdown despite failure: ",t)})];case 1:return t.sent(),this.tr.close(),this.vr(),[2]}})})},Ya.prototype.Rr=function(t,e){var n=this;return t.filter(function(t){return n.Ar(t.updateTimeMs,e)&&!n.Vr(t.clientId)})},Ya.prototype.Sr=function(){var e=this;return this.runTransaction("getActiveClients","readonly",function(t){return th(t).Ws().next(function(t){return e.Rr(t,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(Ya.prototype,"or",{get:function(){return this.Qi},enumerable:!1,configurable:!0}),Ya.prototype.Dr=function(t){return oh.Cr(t,this.serializer,this.ss,this.wi)},Ya.prototype.Fr=function(){return this.Ji},Ya.prototype.Nr=function(){return this.es},Ya.prototype.$r=function(){return this.ss},Ya.prototype.runTransaction=function(e,n,r){var i=this;Ar("IndexedDbPersistence","Starting transaction:",e);var o,t="readonly"===n?"readonly":"readwrite";return this.tr.runTransaction(t,kh,function(t){return o=new Ka(t,i.Ui?i.Ui.next():Zu.ps),"readwrite-primary"===n?i.lr(o).next(function(t){return!!t||i.dr(o)}).next(function(t){if(!t)throw Nr("Failed to obtain primary lease for action '"+e+"'."),i.isPrimary=!1,i.bs._r(function(){return i.zi(!1)}),new $r(Wr.FAILED_PRECONDITION,Ku);return r(o)}).next(function(t){return i.Tr(o).next(function(){return t})}):i.kr(o).next(function(){return r(o)})}).then(function(t){return o.ts(),t})},Ya.prototype.kr=function(t){var e=this;return Za(t).get(yh.key).next(function(t){if(null!==t&&e.Ar(t.leaseTimestampMs,5e3)&&!e.Vr(t.ownerId)&&!e.Er(t)&&!(e.qi||e.allowTabSynchronization&&t.allowTabSynchronization))throw new $r(Wr.FAILED_PRECONDITION,$a)})},Ya.prototype.Tr=function(t){var e=new yh(this.clientId,this.allowTabSynchronization,Date.now());return Za(t).put(yh.key,e)},Ya.Hi=function(){return Lh.Hi()},Ya.prototype.wr=function(t){var e=this,n=Za(t);return n.get(yh.key).next(function(t){return e.Er(t)?(Ar("IndexedDbPersistence","Releasing primary lease."),n.delete(yh.key)):Wu.resolve()})},Ya.prototype.Ar=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(Nr("Detected an update time that is in the future: "+t+" > "+n),1))},Ya.prototype.nr=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ji=function(){t.bs.cr(function(){return t.inForeground="visible"===t.document.visibilityState,t.er()})},this.document.addEventListener("visibilitychange",this.ji),this.inForeground="visible"===this.document.visibilityState)},Ya.prototype.pr=function(){this.ji&&(this.document.removeEventListener("visibilitychange",this.ji),this.ji=null)},Ya.prototype.sr=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Wi=function(){e.yr(),e.bs.cr(function(){return e.gr()})},this.window.addEventListener("unload",this.Wi))},Ya.prototype.br=function(){this.Wi&&(this.window.removeEventListener("unload",this.Wi),this.Wi=null)},Ya.prototype.Vr=function(t){var e;try{var n=null!==(null===(e=this.Xi)||void 0===e?void 0:e.getItem(this.Pr(t)));return Ar("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return Nr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},Ya.prototype.yr=function(){if(this.Xi)try{this.Xi.setItem(this.Pr(this.clientId),String(Date.now()))}catch(t){Nr("Failed to set zombie client id.",t)}},Ya.prototype.vr=function(){if(this.Xi)try{this.Xi.removeItem(this.Pr(this.clientId))}catch(t){}},Ya.prototype.Pr=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},Ya);function Ya(t,e,n,r,i,o,s,u,a,h){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.bs=i,this.window=o,this.document=s,this.Bi=a,this.qi=h,this.Ui=null,this.Qi=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Wi=null,this.inForeground=!1,this.ji=null,this.Ki=null,this.Gi=Number.NEGATIVE_INFINITY,this.zi=function(t){return Promise.resolve()},!Ya.Hi())throw new $r(Wr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.wi=new eh(this,r),this.Yi=e+"main",this.serializer=new Ea(u),this.Ji=new qa(this.wi,this.serializer),this.ss=new ga,this.es=new La(this.serializer,this.ss),this.window&&this.window.localStorage?this.Xi=this.window.localStorage:(this.Xi=null,!1===h&&Nr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}function Ja(t,e){var n=this;return(n=Wa.call(this)||this).Oi=t,n.Li=e,n}function Za(t){return Xa.js(t,yh.store)}function th(t){return Xa.js(t,Ph.store)}var eh=(nh.prototype.Mr=function(t){var n=this.Or(t);return this.db.Fr().Si(t).next(function(e){return n.next(function(t){return e+t})})},nh.prototype.Or=function(t){var e=0;return this.Lr(t,function(t){e++}).next(function(){return e})},nh.prototype.pe=function(t,e){return this.db.Fr().pe(t,e)},nh.prototype.Lr=function(t,n){return this.Br(t,function(t,e){return n(e)})},nh.prototype.Fi=function(t,e,n){return rh(t,n)},nh.prototype.$i=function(t,e,n){return rh(t,n)},nh.prototype.vi=function(t,e,n){return this.db.Fr().vi(t,e,n)},nh.prototype.qr=function(t,e){return rh(t,e)},nh.prototype.Ur=function(t,e){return r=e,i=!1,fh(n=t).Qr(function(t){return uh(n,t,r).next(function(t){return t&&(i=!0),Wu.resolve(!t)})}).next(function(){return i});var n,r,i},nh.prototype.Wr=function(r,i){var o=this,s=this.db.Nr().oi(),u=[],a=0;return this.Br(r,function(e,t){if(t<=i){var n=o.Ur(r,e).next(function(t){if(!t)return a++,s.zn(r,e).next(function(){return s.Gn(e),Ha(r).delete([0,fa(e.path)])})});u.push(n)}}).next(function(){return Wu.Bn(u)}).next(function(){return s.apply(r)}).next(function(){return a})},nh.prototype.removeTarget=function(t,e){var n=e.Z(t.Li);return this.db.Fr().yi(t,n)},nh.prototype.jr=function(t,e){return rh(t,e)},nh.prototype.Br=function(t,o){var s,e=Ha(t),u=Zu.ps;return e.ei({index:Nh.documentTargetsIndex},function(t,e){var n=t[0],r=(t[1],e.path),i=e.sequenceNumber;0===n?(u!==Zu.ps&&o(new ei(da(s)),u),u=i,s=r):u=Zu.ps}).next(function(){u!==Zu.ps&&o(new ei(da(s)),u)})},nh.prototype.Kr=function(t){return this.db.Nr().ui(t)},nh);function nh(t,e){this.db=t,this.xr=new sc(this,e)}function rh(t,e){return Ha(t).put((n=e,r=t.Li,new Nh(0,fa(n.path),r)));var n,r}function ih(t,e){var n=t.projectId;return t.i||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var oh=(sh.Cr=function(t,e,n,r){return xr(""!==t.uid),new sh(t.zr()?t.uid:"",e,n,r)},sh.prototype.Hr=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return hh(t).ei({index:mh.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},sh.prototype.Yr=function(h,c,f,l){var p=this,d=ch(h),y=hh(h);return y.add({}).next(function(t){xr("number"==typeof t);for(var e=new Qu(t,c,f,l),n=function(e,t,n){var r=n.baseMutations.map(function(t){return Xo(e.Ks,t)}),i=n.mutations.map(function(t){return Xo(e.Ks,t)});return new mh(t,n.batchId,n.yn.toMillis(),r,i)}(p.serializer,p.userId,e),r=[],i=new Ri(function(t,e){return Rr(t.N(),e.N())}),o=0,s=l;o<s.length;o++){var u=s[o],a=wh.key(p.userId,u.key.path,t);i=i.add(u.key.path.p()),r.push(y.put(n)),r.push(d.put(a,wh.PLACEHOLDER))}return i.forEach(function(t){r.push(p.ss.Us(h,t))}),h.Zn(function(){p.Gr[t]=e.keys()}),Wu.Bn(r).next(function(){return e})})},sh.prototype.Jr=function(t,e){var n=this;return hh(t).get(e).next(function(t){return t?(xr(t.userId===n.userId),xa(n.serializer,t)):null})},sh.prototype.Xr=function(t,n){var r=this;return this.Gr[n]?Wu.resolve(this.Gr[n]):this.Jr(t,n).next(function(t){if(t){var e=t.keys();return r.Gr[n]=e}return null})},sh.prototype.Zr=function(t,e){var r=this,i=e+1,n=IDBKeyRange.lowerBound([this.userId,i]),o=null;return hh(t).ei({index:mh.userMutationsIndex,range:n},function(t,e,n){e.userId===r.userId&&(xr(e.batchId>=i),o=xa(r.serializer,e)),n.done()}).next(function(){return o})},sh.prototype.to=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return hh(t).ei({index:mh.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},sh.prototype.eo=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return hh(t).Ws(mh.userMutationsIndex,n).next(function(t){return t.map(function(t){return xa(e.serializer,t)})})},sh.prototype.os=function(u,a){var h=this,t=wh.prefixForPath(this.userId,a.path),e=IDBKeyRange.lowerBound(t),c=[];return ch(u).ei({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=da(i);if(r===h.userId&&a.path.isEqual(s))return hh(u).get(o).next(function(t){if(!t)throw Dr();xr(t.userId===h.userId),c.push(xa(h.serializer,t))});n.done()}).next(function(){return c})},sh.prototype.ls=function(r,t){var a=this,h=new Ri(Rr),i=[];return t.forEach(function(u){var t=wh.prefixForPath(a.userId,u.path),e=IDBKeyRange.lowerBound(t),n=ch(r).ei({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=da(i);r===a.userId&&u.path.isEqual(s)?h=h.add(o):n.done()});i.push(n)}),Wu.Bn(i).next(function(){return a.no(r,h)})},sh.prototype.Es=function(t,e){var u=this,a=e.path,h=a.length+1,n=wh.prefixForPath(this.userId,a),r=IDBKeyRange.lowerBound(n),c=new Ri(Rr);return ch(t).ei({range:r},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=da(i);r===u.userId&&a.D(s)?s.length===h&&(c=c.add(o)):n.done()}).next(function(){return u.no(t,c)})},sh.prototype.no=function(e,t){var n=this,r=[],i=[];return t.forEach(function(t){i.push(hh(e).get(t).next(function(t){if(null===t)throw Dr();xr(t.userId===n.userId),r.push(xa(n.serializer,t))}))}),Wu.Bn(i).next(function(){return r})},sh.prototype.so=function(e,n){var r=this;return ah(e.Oi,this.userId,n).next(function(t){return e.Zn(function(){r.io(n.batchId)}),Wu.forEach(t,function(t){return r.wi.qr(e,t)})})},sh.prototype.io=function(t){delete this.Gr[t]},sh.prototype.ro=function(n){var o=this;return this.Hr(n).next(function(t){if(!t)return Wu.resolve();var e=IDBKeyRange.lowerBound(wh.prefixForUser(o.userId)),i=[];return ch(n).ei({range:e},function(t,e,n){if(t[0]===o.userId){var r=da(t[1]);i.push(r)}else n.done()}).next(function(){xr(0===i.length)})})},sh.prototype.Mi=function(t,e){return uh(t,this.userId,e)},sh.prototype.oo=function(t){var e=this;return fh(t).get(this.userId).next(function(t){return t||new gh(e.userId,-1,"")})},sh);function sh(t,e,n,r){this.userId=t,this.serializer=e,this.ss=n,this.wi=r,this.Gr={}}function uh(t,o,e){var n=wh.prefixForPath(o,e.path),s=n[1],r=IDBKeyRange.lowerBound(n),u=!1;return ch(t).ei({range:r,xi:!0},function(t,e,n){var r=t[0],i=t[1];t[2],r===o&&i===s&&(u=!0),n.done()}).next(function(){return u})}function ah(t,e,n){var r=t.store(mh.store),i=t.store(wh.store),o=[],s=IDBKeyRange.only(n.batchId),u=0,a=r.ei({range:s},function(t,e,n){return u++,n.delete()});o.push(a.next(function(){xr(1===u)}));for(var h=[],c=0,f=n.mutations;c<f.length;c++){var l=f[c],p=wh.key(e,l.key.path,n.batchId);o.push(i.delete(p)),h.push(l.key)}return Wu.Bn(o).next(function(){return h})}function hh(t){return Xa.js(t,mh.store)}function ch(t){return Xa.js(t,wh.store)}function fh(t){return Xa.js(t,gh.store)}var lh=10,ph=(vh.prototype.createOrUpgrade=function(n,r,t,e){var i=this;xr(t<e&&0<=t&&e<=lh);var o,s=new Fh(r);t<1&&1<=e&&(n.createObjectStore(yh.store),(o=n).createObjectStore(gh.store,{keyPath:gh.keyPath}),o.createObjectStore(mh.store,{keyPath:mh.keyPath,autoIncrement:!0}).createIndex(mh.userMutationsIndex,mh.userMutationsKeyPath,{unique:!0}),o.createObjectStore(wh.store),xh(n),n.createObjectStore(Th.store));var u,a=Wu.resolve();return t<3&&3<=e&&(0!==t&&((u=n).deleteObjectStore(Nh.store),u.deleteObjectStore(Ah.store),u.deleteObjectStore(Sh.store),xh(n)),a=a.next(function(){return t=s.store(Sh.store),e=new Sh(0,0,Xr.min().A(),0),t.put(Sh.key,e);var t,e})),t<4&&4<=e&&(0!==t&&(a=a.next(function(){return r=n,(i=s).store(mh.store).Ws().next(function(t){r.deleteObjectStore(mh.store),r.createObjectStore(mh.store,{keyPath:mh.keyPath,autoIncrement:!0}).createIndex(mh.userMutationsIndex,mh.userMutationsKeyPath,{unique:!0});var e=i.store(mh.store),n=t.map(function(t){return e.put(t)});return Wu.Bn(n)});var r,i})),a=a.next(function(){n.createObjectStore(Ph.store,{keyPath:Ph.keyPath})})),t<5&&5<=e&&(a=a.next(function(){return i.removeAcknowledgedMutations(s)})),t<6&&6<=e&&(a=a.next(function(){return n.createObjectStore(_h.store),i.addDocumentGlobal(s)})),t<7&&7<=e&&(a=a.next(function(){return i.ensureSequenceNumbers(s)})),t<8&&8<=e&&(a=a.next(function(){return i.createCollectionParentIndex(n,s)})),t<9&&9<=e&&(a=a.next(function(){var t,e;(e=n).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges"),(t=r.objectStore(Th.store)).createIndex(Th.readTimeIndex,Th.readTimeIndexPath,{unique:!1}),t.createIndex(Th.collectionReadTimeIndex,Th.collectionReadTimeIndexPath,{unique:!1})})),t<10&&10<=e&&(a=a.next(function(){return i.rewriteCanonicalIds(s)})),a},vh.prototype.addDocumentGlobal=function(e){var n=0;return e.store(Th.store).ei(function(t,e){n+=Ma(e)}).next(function(){var t=new _h(n);return e.store(_h.store).put(_h.key,t)})},vh.prototype.removeAcknowledgedMutations=function(r){var i=this,t=r.store(gh.store),e=r.store(mh.store);return t.Ws().next(function(t){return Wu.forEach(t,function(n){var t=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return e.Ws(mh.userMutationsIndex,t).next(function(t){return Wu.forEach(t,function(t){xr(t.userId===n.userId);var e=xa(i.serializer,t);return ah(r,n.userId,e).next(function(){})})})})})},vh.prototype.ensureSequenceNumbers=function(t){var s=t.store(Nh.store),e=t.store(Th.store);return t.store(Sh.store).get(Sh.key).next(function(i){var o=[];return e.ei(function(t,e){var n=new Jr(t),r=[0,fa(n)];o.push(s.get(r).next(function(t){return t?Wu.resolve():(e=n,s.put(new Nh(0,fa(e),i.highestListenSequenceNumber)));var e}))}).next(function(){return Wu.Bn(o)})})},vh.prototype.createCollectionParentIndex=function(t,e){function i(t){if(o.add(t)){var e=t.S(),n=t.p();return r.put({collectionId:e,parent:fa(n)})}}t.createObjectStore(Dh.store,{keyPath:Dh.keyPath});var r=e.store(Dh.store),o=new va;return e.store(Th.store).ei({xi:!0},function(t,e){var n=new Jr(t);return i(n.p())}).next(function(){return e.store(wh.store).ei({xi:!0},function(t,e){t[0];var n=t[1],r=(t[2],da(n));return i(r.p())})})},vh.prototype.rewriteCanonicalIds=function(t){var i=this,o=t.store(Ah.store);return o.ei(function(t,e){var n=Pa(e),r=Oa(i.serializer,n);return o.put(r)})},vh),dh=function(t,e){this.seconds=t,this.nanoseconds=e},yh=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};function vh(t){this.serializer=t}yh.store="owner",yh.key="owner";var gh=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};gh.store="mutationQueues",gh.keyPath="userId";var mh=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};mh.store="mutations",mh.keyPath="batchId",mh.userMutationsIndex="userMutationsIndex",mh.userMutationsKeyPath=["userId","batchId"];var wh=(bh.prefixForUser=function(t){return[t]},bh.prefixForPath=function(t,e){return[t,fa(e)]},bh.key=function(t,e,n){return[t,fa(e),n]},bh);function bh(){}wh.store="documentMutations",wh.PLACEHOLDER=new wh;var Ih=function(t,e){this.path=t,this.readTime=e},Eh=function(t,e){this.path=t,this.version=e},Th=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Th.store="remoteDocuments",Th.readTimeIndex="readTimeIndex",Th.readTimeIndexPath="readTime",Th.collectionReadTimeIndex="collectionReadTimeIndex",Th.collectionReadTimeIndexPath=["parentPath","readTime"];var _h=function(t){this.byteSize=t};_h.store="remoteDocumentGlobal",_h.key="remoteDocumentGlobalKey";var Ah=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Ah.store="targets",Ah.keyPath="targetId",Ah.queryTargetsIndexName="queryTargetsIndex",Ah.queryTargetsKeyPath=["canonicalId","targetId"];var Nh=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Nh.store="targetDocuments",Nh.keyPath=["targetId","path"],Nh.documentTargetsIndex="documentTargetsIndex",Nh.documentTargetsKeyPath=["path","targetId"];var Sh=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Sh.key="targetGlobalKey",Sh.store="targetGlobal";var Dh=function(t,e){this.collectionId=t,this.parent=e};function xh(t){t.createObjectStore(Nh.store,{keyPath:Nh.keyPath}).createIndex(Nh.documentTargetsIndex,Nh.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Ah.store,{keyPath:Ah.keyPath}).createIndex(Ah.queryTargetsIndexName,Ah.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Sh.store)}Dh.store="collectionParents",Dh.keyPath=["collectionId","parent"];var Ph=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Ph.store="clientMetadata",Ph.keyPath="clientId";var Oh,kh=d(d(d([gh.store,mh.store,wh.store,Th.store,Ah.store,yh.store,Sh.store,Nh.store],[Ph.store]),[_h.store]),[Dh.store]),Lh=(Mh.Zi=function(o,t,s){return Ar("SimpleDb","Opening database:",o),new Wu(function(n,r){var i=indexedDB.open(o,t);i.onsuccess=function(t){var e=t.target.result;n(new Mh(e))},i.onblocked=function(){r(new $r(Wr.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(t){var e=t.target.error;"VersionError"===e.name?r(new $r(Wr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(e)},i.onupgradeneeded=function(t){Ar("SimpleDb",'Database "'+o+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;s.createOrUpgrade(e,i.transaction,t.oldVersion,lh).next(function(){Ar("SimpleDb","Database upgrade to version "+lh+" complete")})}}).On()},Mh.delete=function(t){return Ar("SimpleDb","Removing database:",t),Gh(window.indexedDB.deleteDatabase(t)).On()},Mh.Hi=function(){if("undefined"==typeof indexedDB)return!1;if(Mh.ao())return!0;var t=g(),e=Mh.ho(t),n=0<e&&e<10,r=Mh.uo(t),i=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||i)},Mh.ao=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.co)},Mh.js=function(t,e){return t.store(e)},Mh.ho=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},Mh.uo=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},Mh.prototype.ar=function(e){this.db.onversionchange=function(t){return e(t)}},Mh.prototype.runTransaction=function(r,h,c){return y(this,void 0,void 0,function(){var s,u,e,a,n;return v(this,function(t){switch(t.label){case 0:s="readonly"===r,u=0,e=function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:++u,e=Fh.open(a.db,s?"readonly":"readwrite",h),t.label=1;case 1:return t.trys.push([1,3,,4]),n=c(e).catch(function(t){return e.abort(t),Wu.reject(t)}).On(),r={},n.catch(function(){}),[4,e.lo];case 2:return[2,(r.value=(t.sent(),n),r)];case 3:return i=t.sent(),o="FirebaseError"!==i.name&&u<3,Ar("SimpleDb","Transaction failed with error: %s. Retrying: %s.",i.message,o),o?[3,4]:[2,{value:Promise.reject(i)}];case 4:return[2]}})},a=this,t.label=1;case 1:return[5,e()];case 2:if("object"==typeof(n=t.sent()))return[2,n.value];t.label=3;case 3:return[3,1];case 4:return[2]}})})},Mh.prototype.close=function(){this.db.close()},Mh),Rh=(Object.defineProperty(Uh.prototype,"$n",{get:function(){return this.fo},enumerable:!1,configurable:!0}),Object.defineProperty(Uh.prototype,"wo",{get:function(){return this.do},enumerable:!1,configurable:!0}),Object.defineProperty(Uh.prototype,"cursor",{set:function(t){this._o=t},enumerable:!1,configurable:!0}),Uh.prototype.done=function(){this.fo=!0},Uh.prototype.ni=function(t){this.do=t},Uh.prototype.delete=function(){return Gh(this._o.delete())},Uh),Ch=(n(Vh,Oh=$r),Vh);function Vh(t){var e=this;return(e=Oh.call(this,Wr.UNAVAILABLE,"IndexedDB transaction failed: "+t)||this).name="IndexedDbTransactionError",e}function Uh(t){this._o=t,this.fo=!1,this.do=null}function Mh(t){this.db=t,12.2===Mh.ho(g())&&Nr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function jh(t){return"IndexedDbTransactionError"===t.name}var Fh=(zh.open=function(t,e,n){return new zh(t.transaction(n,e))},Object.defineProperty(zh.prototype,"lo",{get:function(){return this.To.promise},enumerable:!1,configurable:!0}),zh.prototype.abort=function(t){t&&this.To.reject(t),this.aborted||(Ar("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},zh.prototype.store=function(t){var e=this.transaction.objectStore(t);return new qh(e)},zh),qh=(Bh.prototype.put=function(t,e){return Gh(void 0!==e?(Ar("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(Ar("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},Bh.prototype.add=function(t){return Ar("SimpleDb","ADD",this.store.name,t,t),Gh(this.store.add(t))},Bh.prototype.get=function(e){var n=this;return Gh(this.store.get(e)).next(function(t){return void 0===t&&(t=null),Ar("SimpleDb","GET",n.store.name,e,t),t})},Bh.prototype.delete=function(t){return Ar("SimpleDb","DELETE",this.store.name,t),Gh(this.store.delete(t))},Bh.prototype.count=function(){return Ar("SimpleDb","COUNT",this.store.name),Gh(this.store.count())},Bh.prototype.Ws=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.Eo(n,function(t,e){r.push(e)}).next(function(){return r})},Bh.prototype.Io=function(t,e){Ar("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.xi=!1;var r=this.cursor(n);return this.Eo(r,function(t,e,n){return n.delete()})},Bh.prototype.ei=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.Eo(r,e)},Bh.prototype.Qr=function(i){var t=this.cursor({});return new Wu(function(n,r){t.onerror=function(t){var e=Hh(t.target.error);r(e)},t.onsuccess=function(t){var e=t.target.result;e?i(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},Bh.prototype.Eo=function(t,s){var u=[];return new Wu(function(o,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e=t.target.result;if(e){var n=new Rh(e),r=s(e.primaryKey,e.value,n);if(r instanceof Wu){var i=r.catch(function(t){return n.done(),Wu.reject(t)});u.push(i)}n.$n?o():null===n.wo?e.continue():e.continue(n.wo)}else o()}}).next(function(){return Wu.Bn(u)})},Bh.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},Bh.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.xi?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},Bh);function Bh(t){this.store=t}function zh(t){var n=this;this.transaction=t,this.aborted=!1,this.To=new aa,this.transaction.oncomplete=function(){n.To.resolve()},this.transaction.onabort=function(){t.error?n.To.reject(new Ch(t.error)):n.To.resolve()},this.transaction.onerror=function(t){var e=Hh(t.target.error);n.To.reject(new Ch(e))}}function Gh(t){return new Wu(function(n,r){t.onsuccess=function(t){var e=t.target.result;n(e)},t.onerror=function(t){var e=Hh(t.target.error);r(e)}})}var Qh=!1;function Hh(t){var e=Lh.ho(g());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new $r("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Qh||(Qh=!0,setTimeout(function(){throw r},0)),r}}return t}function Wh(){return"undefined"!=typeof window?window:null}var $h=(Yh.Vo=function(t,e,n,r,i){var o=new Yh(t,e,Date.now()+n,r,i);return o.start(n),o},Yh.prototype.start=function(t){var e=this;this.yo=setTimeout(function(){return e.po()},t)},Yh.prototype.Bs=function(){return this.po()},Yh.prototype.cancel=function(t){null!==this.yo&&(this.clearTimeout(),this.Po.reject(new $r(Wr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},Yh.prototype.po=function(){var e=this;this.mo.cr(function(){return null!==e.yo?(e.clearTimeout(),e.op().then(function(t){return e.Po.resolve(t)})):Promise.resolve()})},Yh.prototype.clearTimeout=function(){null!==this.yo&&(this.Ro(this),clearTimeout(this.yo),this.yo=null)},Yh),Kh=(Object.defineProperty(Xh.prototype,"xo",{get:function(){return this.So},enumerable:!1,configurable:!0}),Xh.prototype.cr=function(t){this.enqueue(t)},Xh.prototype.Mo=function(t){this.Oo(),this.Lo(t)},Xh.prototype.Bo=function(t){return this.Oo(),this.Lo(t)},Xh.prototype.qo=function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.Oo(),this.So?[3,2]:(this.So=!0,(e=Wh())&&e.removeEventListener("visibilitychange",this.ko),[4,this.Bo(n)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},Xh.prototype.enqueue=function(t){return this.Oo(),this.So?new Promise(function(t){}):this.Lo(t)},Xh.prototype._r=function(t){var e=this;this.vo.push(t),this.cr(function(){return e.Uo()})},Xh.prototype.Uo=function(){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(0===this.vo.length)return[3,5];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.vo[0]()];case 2:return t.sent(),this.vo.shift(),this.$o.reset(),[3,4];case 3:if(!jh(e=t.sent()))throw e;return Ar("AsyncQueue","Operation failed with retryable error: "+e),[3,4];case 4:0<this.vo.length&&this.$o.xs(function(){return n.Uo()}),t.label=5;case 5:return[2]}})})},Xh.prototype.Lo=function(t){var r=this,e=this.bo.then(function(){return r.Fo=!0,t().catch(function(t){throw r.Co=t,r.Fo=!1,Nr("INTERNAL UNHANDLED ERROR: ",(n=(e=t).message||"",e.stack&&(n=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),n)),t;var e,n}).then(function(t){return r.Fo=!1,t})});return this.bo=e},Xh.prototype.Os=function(t,e,n){var r=this;this.Oo(),-1<this.No.indexOf(t)&&(e=0);var i=$h.Vo(this,t,e,n,function(t){return r.Qo(t)});return this.Do.push(i),i},Xh.prototype.Oo=function(){this.Co&&Dr()},Xh.prototype.Wo=function(){},Xh.prototype.jo=function(){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return[4,e=this.bo];case 1:t.sent(),t.label=2;case 2:if(e!==this.bo)return[3,0];t.label=3;case 3:return[2]}})})},Xh.prototype.Ko=function(t){for(var e=0,n=this.Do;e<n.length;e++)if(n[e].vs===t)return!0;return!1},Xh.prototype.Go=function(r){var i=this;return this.jo().then(function(){i.Do.sort(function(t,e){return t.Ao-e.Ao});for(var t=0,e=i.Do;t<e.length;t++){var n=e[t];if(n.Bs(),"all"!==r&&n.vs===r)break}return i.jo()})},Xh.prototype.zo=function(t){this.No.push(t)},Xh.prototype.Qo=function(t){var e=this.Do.indexOf(t);this.Do.splice(e,1)},Xh);function Xh(){var t=this;this.bo=Promise.resolve(),this.vo=[],this.So=!1,this.Do=[],this.Co=null,this.Fo=!1,this.No=[],this.$o=new ha(this,"async_queue_retry"),this.ko=function(){return t.$o.Ls()};var e=Wh();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.ko)}function Yh(t,e,n,r,i){this.mo=t,this.vs=e,this.Ao=n,this.op=r,this.Ro=i,this.Po=new aa,this.then=this.Po.promise.then.bind(this.Po.promise),this.Po.promise.catch(function(t){})}function Jh(t,e){if(Nr("AsyncQueue",e+": "+t),jh(t))return new $r(Wr.UNAVAILABLE,e+": "+t);throw t}function Zh(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=Rr(n,i);return 0===s?Rr(r,o):s}var tc=(ic.prototype.Jo=function(){return++this.Yo},ic.prototype.Xo=function(t){var e=[t,this.Jo()];if(this.buffer.size<this.Ho)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Zh(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(ic.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),ic),ec={Zo:!1,th:0,eh:0,nh:0},nc=(rc.oh=function(t){return new rc(t,rc.hh,rc.ah)},rc);function rc(t,e,n){this.sh=t,this.ih=e,this.rh=n}function ic(t){this.Ho=t,this.buffer=new Ri(Zh),this.Yo=0}nc.uh=-1,nc.lh=1048576,nc._h=41943040,nc.hh=10,nc.ah=1e3,nc.fh=new nc(nc._h,nc.hh,nc.ah),nc.dh=new nc(nc.uh,0,0);var oc=(cc.prototype.start=function(t){this.xr.params.sh!==nc.uh&&this.Eh(t)},cc.prototype.stop=function(){this.Th&&(this.Th.cancel(),this.Th=null)},Object.defineProperty(cc.prototype,"or",{get:function(){return null!==this.Th},enumerable:!1,configurable:!0}),cc.prototype.Eh=function(n){var t=this,e=this.wh?3e5:6e4;Ar("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.Th=this.mo.Os("lru_garbage_collection",e,function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:this.Th=null,this.wh=!0,t.label=1;case 1:return t.trys.push([1,3,,7]),[4,n.Ih(this.xr)];case 2:return t.sent(),[3,7];case 3:return jh(e=t.sent())?(Ar("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,yc(e)];case 5:t.sent(),t.label=6;case 6:return[3,7];case 7:return[4,this.Eh(n)];case 8:return t.sent(),[2]}})})})},cc),sc=(hc.prototype.Ah=function(t,e){return this.mh.Mr(t).next(function(t){return Math.floor(e/100*t)})},hc.prototype.Rh=function(t,e){var n=this;if(0===e)return Wu.resolve(Zu.ps);var r=new tc(e);return this.mh.pe(t,function(t){return r.Xo(t.sequenceNumber)}).next(function(){return n.mh.Lr(t,function(t){return r.Xo(t)})}).next(function(){return r.maxValue})},hc.prototype.vi=function(t,e,n){return this.mh.vi(t,e,n)},hc.prototype.Wr=function(t,e){return this.mh.Wr(t,e)},hc.prototype.Ph=function(e,n){var r=this;return this.params.sh===nc.uh?(Ar("LruGarbageCollector","Garbage collection skipped; disabled"),Wu.resolve(ec)):this.Kr(e).next(function(t){return t<r.params.sh?(Ar("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.params.sh),ec):r.Vh(e,n)})},hc.prototype.Kr=function(t){return this.mh.Kr(t)},hc.prototype.Vh=function(e,n){var r,i,o,s,u,a,h,c=this,f=Date.now();return this.Ah(e,this.params.ih).next(function(t){return i=t>c.params.rh?(Ar("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.rh+" from "+t),c.params.rh):t,s=Date.now(),c.Rh(e,i)}).next(function(t){return r=t,u=Date.now(),c.vi(e,r,n)}).next(function(t){return o=t,a=Date.now(),c.Wr(e,r)}).next(function(t){return h=Date.now(),_r()<=p.DEBUG&&Ar("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-f)+"ms\n\tDetermined least recently used "+i+" in "+(u-s)+"ms\n\tRemoved "+o+" targets in "+(a-u)+"ms\n\tRemoved "+t+" documents in "+(h-a)+"ms\nTotal Duration: "+(h-f)+"ms"),Wu.resolve({Zo:!0,th:i,eh:o,nh:t})})},hc),uc=(ac.prototype.start=function(){return Promise.resolve()},ac.prototype.Ch=function(i){return y(this,void 0,void 0,function(){var e,m,n,r=this;return v(this,function(t){switch(t.label){case 0:return e=this.ns,m=this.Sh,[4,this.persistence.runTransaction("Handle user change","readonly",function(v){var g;return r.ns.eo(v).next(function(t){return g=t,e=r.persistence.Dr(i),m=new Yu(r.vh,e,r.persistence.$r()),e.eo(v)}).next(function(t){for(var e=[],n=[],r=Qi(),i=0,o=g;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var u=0,a=s.mutations;u<a.length;u++){var h=a[u];r=r.add(h.key)}}for(var c=0,f=t;c<f.length;c++){var l=f[c];n.push(l.batchId);for(var p=0,d=l.mutations;p<d.length;p++){var y=d[p];r=r.add(y.key)}}return m.us(v,r).next(function(t){return{Fh:t,Nh:e,$h:n}})})})];case 1:return n=t.sent(),[2,(this.ns=e,this.Sh=m,this.gh.Dh(this.Sh),n)]}})})},ac.prototype.kh=function(h){var c,f=this,l=Kr.now(),t=h.reduce(function(t,e){return t.add(e.key)},Qi());return this.persistence.runTransaction("Locally write mutations","readwrite",function(a){return f.Sh.us(a,t).next(function(t){c=t;for(var e=[],n=0,r=h;n<r.length;n++){var i=r[n],o=(u=i,s=c.get(i.key),u instanceof zs?function(t){for(var e=null,n=0,r=u.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof au?t.field(i.field):void 0,s=ss(i.transform,o||null);null!=s&&(e=null==e?(new Js).set(i.field,s):e.set(i.field,s))}return e?e.ze():null}(s):null);null!=o&&e.push(new Ms(i.key,o,ru(o.proto.mapValue),Ss.exists(!0)))}var u,s;return f.ns.Yr(a,l,e,h)})}).then(function(t){var e=t.Sn(c);return{batchId:t.batchId,Un:e}})},ac.prototype.xh=function(r){var i=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var e=r.batch.keys(),n=i.vh.oi({ai:!0});return i.Mh(t,r,n).next(function(){return n.apply(t)}).next(function(){return i.ns.ro(t)}).next(function(){return i.Sh.us(t,e)})})},ac.prototype.Oh=function(t){var r=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return r.ns.Jr(e,t).next(function(t){return xr(null!==t),n=t.keys(),r.ns.so(e,t)}).next(function(){return r.ns.ro(e)}).next(function(){return r.Sh.us(e,n)})})},ac.prototype.to=function(){var e=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e.ns.to(t)})},ac.prototype.mi=function(){var e=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.Ji.mi(t)})},ac.prototype.Lh=function(a){var h=this,c=a.X,f=this.yh;return this.persistence.runTransaction("Apply remote event","readwrite-primary",function(o){var i=h.vh.oi({ai:!0});f=h.yh;var s=[];a.Qt.forEach(function(t,e){var n=f.get(e);if(n){s.push(h.Ji.Ni(o,t.Xt,e).next(function(){return h.Ji.Ci(o,t.Yt,e)}));var r=t.resumeToken;if(0<r.H()){var i=n.tt(r,c).Z(o.Li);f=f.nt(e,i),ac.Bh(n,i,t)&&s.push(h.Ji.yi(o,i))}}});var u=ji(),n=Qi();if(a.jt.forEach(function(t,e){n=n.add(t)}),s.push(i.getEntries(o,n).next(function(r){a.jt.forEach(function(t,e){var n=r.get(t);e instanceof hu&&e.version.isEqual(Xr.min())?(i.Gn(t,c),u=u.nt(t,e)):null==n||0<e.version.o(n.version)||0===e.version.o(n.version)&&n.hasPendingWrites?(i.jn(e,c),u=u.nt(t,e)):Ar("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),a.Kt.has(t)&&s.push(h.persistence.wi.jr(o,t))})})),!c.isEqual(Xr.min())){var t=h.Ji.mi(o).next(function(t){return h.Ji.Ri(o,o.Li,c)});s.push(t)}return Wu.Bn(s).next(function(){return i.apply(o)}).next(function(){return h.Sh.cs(o,u)})}).then(function(t){return h.yh=f,t})},ac.Bh=function(t,e,n){return xr(0<e.resumeToken.H()),0===t.resumeToken.H()||e.X.m()-t.X.m()>=this.qh||0<n.Yt.size+n.Jt.size+n.Xt.size},ac.prototype.Uh=function(c){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h=this;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return Wu.forEach(c,function(e){return Wu.forEach(e.ms,function(t){return h.persistence.wi.Fi(n,e.targetId,t)}).next(function(){return Wu.forEach(e.As,function(t){return h.persistence.wi.$i(n,e.targetId,t)})})})})];case 1:return t.sent(),[3,3];case 2:if(!jh(e=t.sent()))throw e;return Ar("LocalStore","Failed to update sequence numbers: "+e),[3,3];case 3:for(n=0,r=c;n<r.length;n++)i=r[n],o=i.targetId,i.fromCache||(s=this.yh.get(o),u=s.X,a=s.et(u),this.yh=this.yh.nt(o,a));return[2]}})})},ac.prototype.Qh=function(e){var n=this;return this.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n.ns.Zr(t,e)})},ac.prototype.Wh=function(e){var n=this;return this.persistence.runTransaction("read document","readonly",function(t){return n.Sh.rs(t,e)})},ac.prototype.jh=function(r){var i=this;return this.persistence.runTransaction("Allocate target","readwrite",function(e){var n;return i.Ji.Di(e,r).next(function(t){return t?(n=t,Wu.resolve(n)):i.Ji.Ti(e).next(function(t){return n=new Ti(r,t,0,e.Li),i.Ji.Pi(e,n).next(function(){return n})})})}).then(function(t){var e=i.yh.get(t.targetId);return(null===e||0<t.X.o(e.X))&&(i.yh=i.yh.nt(t.targetId,t),i.ph.set(r,t.targetId)),t})},ac.prototype.Di=function(t,e){var n=this.ph.get(e);return void 0!==n?Wu.resolve(this.yh.get(n)):this.Ji.Di(t,e)},ac.prototype.Kh=function(o,s){return y(this,void 0,void 0,function(){var e,n,r,i=this;return v(this,function(t){switch(t.label){case 0:e=this.yh.get(o),n=s?"readwrite":"readwrite-primary",t.label=1;case 1:return t.trys.push([1,4,,5]),s?[3,3]:[4,this.persistence.runTransaction("Release target",n,function(t){return i.persistence.wi.removeTarget(t,e)})];case 2:t.sent(),t.label=3;case 3:return[3,5];case 4:if(!jh(r=t.sent()))throw r;return Ar("LocalStore","Failed to update sequence numbers for target "+o+": "+r),[3,5];case 5:return this.yh=this.yh.remove(o),this.ph.delete(e.target),[2]}})})},ac.prototype.Gh=function(t,n){var r=this,i=Xr.min(),o=Qi();return this.persistence.runTransaction("Execute query","readonly",function(e){return r.Di(e,t.We()).next(function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,r.Ji.ki(e,t.targetId).next(function(t){o=t})}).next(function(){return r.gh._s(e,t,n?i:Xr.min(),n?o:Qi())}).next(function(t){return{documents:t,zh:o}})})},ac.prototype.Mh=function(t,i,o){var e=this,s=i.batch,n=s.keys(),u=Wu.resolve();return n.forEach(function(r){u=u.next(function(){return o.zn(t,r)}).next(function(t){var e=t,n=i.Cn.get(r);xr(null!==n),(!e||e.version.o(n)<0)&&(e=s.pn(r,e,i))&&o.jn(e,i.Dn)})}),u.next(function(){return e.ns.so(t,s)})},ac.prototype.Ih=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.Ph(t,n.yh)})},ac);function ac(t,e,n){this.persistence=t,this.gh=e,this.yh=new Si(Rr),this.ph=new Hr(function(t){return yi(t)},vi),this.bh=Xr.min(),this.ns=t.Dr(n),this.vh=t.Nr(),this.Ji=t.Fr(),this.Sh=new Yu(this.vh,this.ns,this.persistence.$r()),this.gh.Dh(this.Sh)}function hc(t,e){this.mh=t,this.params=e}function cc(t,e){this.xr=t,this.mo=e,this.wh=!1,this.Th=null}function fc(t,e,n){return new uc(t,e,n)}uc.qh=3e8;var lc,pc=(n(dc,lc=uc),dc.prototype.start=function(){return this.Hh()},dc.prototype.Yh=function(t){var n=this;return this.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return n.ns.Xr(e,t).next(function(t){return t?n.Sh.us(e,t):Wu.resolve(null)})})},dc.prototype.Jh=function(t){this.ns.io(t)},dc.prototype.ur=function(t){this.persistence.ur(t)},dc.prototype.Sr=function(){return this.persistence.Sr()},dc.prototype.Xh=function(e){var n=this,t=this.yh.get(e);return t?Promise.resolve(t.target):this.persistence.runTransaction("Get target data","readonly",function(t){return n.Ji.Me(t,e).next(function(t){return t?t.target:null})})},dc.prototype.si=function(){var r=this;return this.persistence.runTransaction("Get new document changes","readonly",function(t){return r.vh.si(t,r.bh)}).then(function(t){var e=t.ii,n=t.readTime;return r.bh=n,e})},dc.prototype.Hh=function(){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:return[4,(e=this).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return n.vh.ri(t)})];case 1:return e.bh=t.sent(),[2]}})})},dc);function dc(t,e,n){var r=this;return(r=lc.call(this,t,e,n)||this).persistence=t,r.ns=t.Dr(n),r.vh=t.Nr(),r.Ji=t.Fr(),r}function yc(e){return y(this,void 0,void 0,function(){return v(this,function(t){if(e.code!==Wr.FAILED_PRECONDITION||e.message!==Ku)throw e;return Ar("LocalStore","Unexpectedly lost primary lease"),[2]})})}var vc=(wc.prototype._=function(){return this.Zh._()},wc.prototype.Fi=function(t,e){var n=new gc(t,e);this.Zh=this.Zh.add(n),this.ea=this.ea.add(n)},wc.prototype.sa=function(t,e){var n=this;t.forEach(function(t){return n.Fi(t,e)})},wc.prototype.$i=function(t,e){this.ia(new gc(t,e))},wc.prototype.ra=function(t,e){var n=this;t.forEach(function(t){return n.$i(t,e)})},wc.prototype.oa=function(t){var e=this,n=new ei(new Jr([])),r=new gc(n,t),i=new gc(n,t+1),o=[];return this.ea.vt([r,i],function(t){e.ia(t),o.push(t.key)}),o},wc.prototype.ha=function(){var e=this;this.Zh.forEach(function(t){return e.ia(t)})},wc.prototype.ia=function(t){this.Zh=this.Zh.delete(t),this.ea=this.ea.delete(t)},wc.prototype.aa=function(t){var e=new ei(new Jr([])),n=new gc(e,t),r=new gc(e,t+1),i=Qi();return this.ea.vt([n,r],function(t){i=i.add(t.key)}),i},wc.prototype.Mi=function(t){var e=new gc(t,0),n=this.Zh.Dt(e);return null!==n&&t.isEqual(n.key)},wc),gc=(mc.ta=function(t,e){return ei.P(t.key,e.key)||Rr(t.ua,e.ua)},mc.na=function(t,e){return Rr(t.ua,e.ua)||ei.P(t.key,e.key)},mc);function mc(t,e){this.key=t,this.ua=e}function wc(){this.Zh=new Ri(gc.ta),this.ea=new Ri(gc.na)}function bc(t,e){if(0!==e.length)throw new $r(Wr.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+Mc(e.length,"argument")+".")}function Ic(t,e,n){if(e.length!==n)throw new $r(Wr.INVALID_ARGUMENT,"Function "+t+"() requires "+Mc(n,"argument")+", but was called with "+Mc(e.length,"argument")+".")}function Ec(t,e,n){if(e.length<n)throw new $r(Wr.INVALID_ARGUMENT,"Function "+t+"() requires at least "+Mc(n,"argument")+", but was called with "+Mc(e.length,"argument")+".")}function Tc(t,e,n,r){if(e.length<n||e.length>r)throw new $r(Wr.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+Mc(e.length,"argument")+".")}function _c(t,e,n,r){Pc(t,e,Uc(n)+" argument",r)}function Ac(t,e,n,r){void 0!==r&&_c(t,e,n,r)}function Nc(t,e,n,r){Pc(t,e,n+" option",r)}function Sc(t,e,n,r){void 0!==r&&Nc(t,e,n,r)}function Dc(t,e,n,r,a){void 0!==r&&function(t,e,n){for(var r=[],i=0,o=a;i<o.length;i++){var s=o[i];if(s===n)return;r.push(kc(s))}var u=kc(n);throw new $r(Wr.INVALID_ARGUMENT,"Invalid value "+u+" provided to function "+t+'() for option "'+e+'". Acceptable values: '+r.join(", "))}(t,n,r)}function xc(t,e,n,r){if(!e.some(function(t){return t===r}))throw new $r(Wr.INVALID_ARGUMENT,"Invalid value "+kc(r)+" provided to function "+t+"() for its "+Uc(n)+" argument. Acceptable values: "+e.join(", "));return r}function Pc(t,e,n,r){if(!("object"===e?Oc(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=kc(r);throw new $r(Wr.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function Oc(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function kc(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":Dr();if(e instanceof Array)return"an array";var t=function(){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(t&&1<t.length)return t[1]}return null}();return t?"a custom "+t+" object":"an object"}function Lc(t,e,n){if(void 0===n)throw new $r(Wr.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+Uc(e)+" argument, but it was undefined.")}function Rc(n,t,r){qr(t,function(t,e){if(r.indexOf(t)<0)throw new $r(Wr.INVALID_ARGUMENT,"Unknown option '"+t+"' passed to function "+n+"(). Available options: "+r.join(", "))})}function Cc(t,e,n,r){var i=kc(r);return new $r(Wr.INVALID_ARGUMENT,"Function "+t+"() requires its "+Uc(n)+" argument to be a "+e+", but it was: "+i)}function Vc(t,e,n){if(n<=0)throw new $r(Wr.INVALID_ARGUMENT,"Function "+t+"() requires its "+Uc(e)+" argument to be a positive number, but it was: "+n+".")}function Uc(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function Mc(t,e){return t+" "+e+(1===t?"":"s")}function jc(){if("undefined"==typeof Uint8Array)throw new $r(Wr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Fc(){if("undefined"==typeof atob)throw new $r(Wr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var qc,Bc,zc=(Yc.fromBase64String=function(t){Ic("Blob.fromBase64String",arguments,1),_c("Blob.fromBase64String","string",1,t),Fc();try{return new Yc(mi.fromBase64String(t))}catch(t){throw new $r(Wr.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},Yc.fromUint8Array=function(t){if(Ic("Blob.fromUint8Array",arguments,1),jc(),!(t instanceof Uint8Array))throw Cc("Blob.fromUint8Array","Uint8Array",1,t);return new Yc(mi.fromUint8Array(t))},Yc.prototype.toBase64=function(){return Ic("Blob.toBase64",arguments,0),Fc(),this.ca.toBase64()},Yc.prototype.toUint8Array=function(){return Ic("Blob.toUint8Array",arguments,0),jc(),this.ca.toUint8Array()},Yc.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},Yc.prototype.isEqual=function(t){return this.ca.isEqual(t.ca)},Yc),Gc=function(t){!function(){if(!(t instanceof Array)||t.length<1)throw new $r(Wr.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least 1 element.")}();for(var e=0;e<t.length;++e)if(_c("FieldPath","string",e,t[e]),0===t[e].length)throw new $r(Wr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.la=new ti(t)},Qc=(n(Xc,Bc=Gc),Xc.documentId=function(){return new Xc(ti.L().N())},Xc.prototype.isEqual=function(t){if(!(t instanceof Xc))throw Cc("isEqual","FieldPath",1,t);return this.la.isEqual(t.la)},Xc),Hc=new RegExp("[~\\*/\\[\\]]"),Wc=function(){this._a=this},$c=(n(Kc,qc=Wc),Kc.prototype.da=function(t){if(2!==t.wa)throw 1===t.wa?t.Ta(this.fa+"() can only appear at the top level of your update data"):t.Ta(this.fa+"() cannot be used with set() unless you pass {merge:true}");return t.Le.push(t.path),null},Kc.prototype.isEqual=function(t){return t instanceof Kc},Kc);function Kc(t){var e=this;return(e=qc.call(this)||this).fa=t,e}function Xc(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Bc.call(this,t)||this}function Yc(t){Fc(),this.ca=t}function Jc(t,e,n){return new Df({wa:3,Ea:e.settings.Ea,methodName:t.fa,Ia:n},e.s,e.serializer,e.ignoreUndefinedProperties)}var Zc,tf,ef,nf,rf,of,sf=(n(wf,of=Wc),wf.prototype.da=function(t){return new _s(t.path,new hs)},wf.prototype.isEqual=function(t){return t instanceof wf},wf),uf=(n(mf,rf=Wc),mf.prototype.da=function(t){var e=Jc(this,t,!0),n=this.ma.map(function(t){return Vf(t,e)}),r=new cs(n);return new _s(t.path,r)},mf.prototype.isEqual=function(t){return this===t},mf),af=(n(gf,nf=Wc),gf.prototype.da=function(t){var e=Jc(this,t,!0),n=this.ma.map(function(t){return Vf(t,e)}),r=new ys(n);return new _s(t.path,r)},gf.prototype.isEqual=function(t){return this===t},gf),hf=(n(vf,ef=Wc),vf.prototype.da=function(t){var e=new ws(t.serializer,Uo(t.serializer,this.Aa));return new _s(t.path,e)},vf.prototype.isEqual=function(t){return this===t},vf),cf=(n(yf,tf=Wc),yf.delete=function(){return bc("FieldValue.delete",arguments),new ff(new $c("FieldValue.delete"))},yf.serverTimestamp=function(){return bc("FieldValue.serverTimestamp",arguments),new ff(new sf("FieldValue.serverTimestamp"))},yf.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Ec("FieldValue.arrayUnion",arguments,1),new ff(new uf("FieldValue.arrayUnion",t))},yf.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Ec("FieldValue.arrayRemove",arguments,1),new ff(new af("FieldValue.arrayRemove",t))},yf.increment=function(t){return _c("FieldValue.increment","number",1,t),Ic("FieldValue.increment",arguments,1),new ff(new hf("FieldValue.increment",t))},yf),ff=(n(df,Zc=cf),df.prototype.da=function(t){return this._a.da(t)},df.prototype.isEqual=function(t){return t instanceof df&&this._a.isEqual(t._a)},df),lf=(Object.defineProperty(pf.prototype,"latitude",{get:function(){return this.Ra},enumerable:!1,configurable:!0}),Object.defineProperty(pf.prototype,"longitude",{get:function(){return this.Pa},enumerable:!1,configurable:!0}),pf.prototype.isEqual=function(t){return this.Ra===t.Ra&&this.Pa===t.Pa},pf.prototype.T=function(t){return Rr(this.Ra,t.Ra)||Rr(this.Pa,t.Pa)},pf);function pf(t,e){if(Ic("GeoPoint",arguments,2),_c("GeoPoint","number",1,t),_c("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new $r(Wr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new $r(Wr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.Ra=t,this.Pa=e}function df(t){var e=this;return(e=Zc.call(this)||this)._a=t,e.fa=t.fa,e}function yf(){return tf.call(this)||this}function vf(t,e){var n=this;return(n=ef.call(this)||this).fa=t,n.Aa=e,n}function gf(t,e){var n=this;return(n=nf.call(this)||this).fa=t,n.ma=e,n}function mf(t,e){var n=this;return(n=rf.call(this)||this).fa=t,n.ma=e,n}function wf(t){var e=this;return(e=of.call(this)||this).fa=t,e}function bf(t){return new Ro(t,!0)}var If=/^__.*__$/,Ef=function(t,e,n){this.Va=t,this.ga=e,this.ya=n},Tf=(Nf.prototype.pa=function(t,e){var n=[];return null!==this.Le?n.push(new Ms(t,this.data,this.Le,e)):n.push(new Us(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new zs(t,this.fieldTransforms)),n},Nf),_f=(Af.prototype.pa=function(t,e){var n=[new Ms(t,this.data,this.Le,e)];return 0<this.fieldTransforms.length&&n.push(new zs(t,this.fieldTransforms)),n},Af);function Af(t,e,n){this.data=t,this.Le=e,this.fieldTransforms=n}function Nf(t,e,n){this.data=t,this.Le=e,this.fieldTransforms=n}function Sf(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw Dr()}}var Df=(Object.defineProperty(Of.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(Of.prototype,"wa",{get:function(){return this.settings.wa},enumerable:!1,configurable:!0}),Of.prototype.va=function(t){return new Of(Object.assign(Object.assign({},this.settings),t),this.s,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.Le)},Of.prototype.Sa=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.va({path:n,Ia:!1});return r.Da(t),r},Of.prototype.Ca=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.va({path:n,Ia:!1});return r.ba(),r},Of.prototype.Fa=function(t){return this.va({path:void 0,Ia:!0})},Of.prototype.Ta=function(t){return Bf(t,this.settings.methodName,this.settings.Na||!1,this.path,this.settings.Ea)},Of.prototype.contains=function(e){return void 0!==this.Le.find(function(t){return e.D(t)})||void 0!==this.fieldTransforms.find(function(t){return e.D(t.field)})},Of.prototype.ba=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.Da(this.path.get(t))},Of.prototype.Da=function(t){if(0===t.length)throw this.Ta("Document fields must not be empty");if(Sf(this.wa)&&If.test(t))throw this.Ta('Document fields cannot begin and end with "__"')},Of),xf=(Pf.prototype.$a=function(t,e,n,r){return void 0===r&&(r=!1),new Df({wa:t,methodName:e,Ea:n,path:ti.k(),Ia:!1,Na:r},this.s,this.serializer,this.ignoreUndefinedProperties)},Pf);function Pf(t,e,n){this.s=t,this.ignoreUndefinedProperties=e,this.serializer=n||bf(t)}function Of(t,e,n,r,i,o){this.settings=t,this.s=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.ba(),this.fieldTransforms=i||[],this.Le=o||[]}function kf(t,e,n,r,i,o){void 0===o&&(o={});var s=t.$a(o.merge||o.mergeFields?2:0,e,n,i);jf("Data must be an object, but it was:",s,r);var u,a,h=Uf(r,s);if(o.merge)u=new Ts(s.Le),a=s.fieldTransforms;else if(o.mergeFields){for(var c=[],f=0,l=o.mergeFields;f<l.length;f++){var p=l[f],d=void 0;if(p instanceof Gc)d=p.la;else{if("string"!=typeof p)throw Dr();d=qf(e,p,n)}if(!s.contains(d))throw new $r(Wr.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");zf(c,d)||c.push(d)}u=new Ts(c),a=s.fieldTransforms.filter(function(t){return u.Ke(t.field)})}else u=null,a=s.fieldTransforms;return new Tf(new Ys(h),u,a)}function Lf(t,o,s,e){var u=t.$a(1,o,s);jf("Data must be an object, but it was:",u,e);var a=[],h=new Js;qr(e,function(t,e){var n=qf(o,t,s),r=u.Ca(n);if(e instanceof Wc&&e._a instanceof $c)a.push(n);else{var i=Vf(e,r);null!=i&&(a.push(n),h.set(n,i))}});var n=new Ts(a);return new _f(h.ze(),n,u.fieldTransforms)}function Rf(t,e,n,r,i,o){var s=t.$a(1,e,n),u=[Ff(e,r,n)],a=[i];if(o.length%2!=0)throw new $r(Wr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var h=0;h<o.length;h+=2)u.push(Ff(e,o[h])),a.push(o[h+1]);for(var c=[],f=new Js,l=u.length-1;0<=l;--l)if(!zf(c,u[l])){var p=u[l],d=a[l],y=s.Ca(p);if(d instanceof Wc&&d._a instanceof $c)c.push(p);else{var v=Vf(d,y);null!=v&&(c.push(p),f.set(p,v))}}var g=new Ts(c);return new _f(f.ze(),g,s.fieldTransforms)}function Cf(t,e,n,r){return void 0===r&&(r=!1),Vf(n,t.$a(r?4:3,e))}function Vf(s,t){if(Mf(s))return jf("Unsupported field value:",t,s),Uf(s,t);if(s instanceof Wc)return function(t,e){if(!Sf(e.wa))throw e.Ta(t.fa+"() can only be used with update() and set()");if(!e.path)throw e.Ta(t.fa+"() is not currently supported inside arrays");var n=t.da(e);n&&e.fieldTransforms.push(n)}(s,t),null;if(t.path&&t.Le.push(t.path),s instanceof Array){if(t.settings.Ia&&4!==t.wa)throw t.Ta("Nested arrays are not supported");return function(t){for(var e=[],n=0,r=0,i=s;r<i.length;r++){var o=Vf(i[r],t.Fa(n));null==o&&(o={nullValue:"NULL_VALUE"}),e.push(o),n++}return{arrayValue:{values:e}}}(t)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Uo(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Kr.fromDate(t);return{timestampValue:Mo(e.serializer,n)}}if(t instanceof Kr){var r=new Kr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Mo(e.serializer,r)}}if(t instanceof lf)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof zc)return{bytesValue:jo(e.serializer,t)};if(t instanceof Ef){var i=e.s,o=t.Va;if(!o.isEqual(i))throw e.Ta("Document reference is for database "+o.projectId+"/"+o.database+" but should be for database "+i.projectId+"/"+i.database);return{referenceValue:qo(t.Va||e.s,t.ga.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.Ta("Unsupported field value: "+kc(t))}(s,t)}function Uf(t,r){var i={};return Br(t)?r.path&&0<r.path.length&&r.Le.push(r.path):qr(t,function(t,e){var n=Vf(e,r.Sa(t));null!=n&&(i[t]=n)}),{mapValue:{fields:i}}}function Mf(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Kr||t instanceof lf||t instanceof zc||t instanceof Ef||t instanceof Wc)}function jf(t,e,n){if(!Mf(n)||!Oc(n)){var r=kc(n);throw"an object"===r?e.Ta(t+" a custom object"):e.Ta(t+" "+r)}}function Ff(t,e,n){if(e instanceof Gc)return e.la;if("string"==typeof e)return qf(t,e);throw Bf("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}function qf(t,e,n){try{return function(e){if(0<=e.search(Hc))throw new $r(Wr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(Qc.bind.apply(Qc,d([void 0],e.split("."))))}catch(t){throw new $r(Wr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e).la}catch(e){throw Bf(e instanceof Error?e.message:e.toString(),t,!1,void 0,n)}}function Bf(t,e,n,r,i){var o=r&&!r._(),s=void 0!==i,u="Function "+e+"() called with invalid data";n&&(u+=" (via `toFirestore()`)");var a="";return(o||s)&&(a+=" (found",o&&(a+=" in field "+r),s&&(a+=" in document "+i),a+=")"),new $r(Wr.INVALID_ARGUMENT,(u+=". ")+t+a)}function zf(t,e){return t.some(function(t){return t.isEqual(e)})}var Gf=(Qf.prototype.zr=function(){return null!=this.uid},Qf.prototype.ka=function(){return this.zr()?"uid:"+this.uid:"anonymous-user"},Qf.prototype.isEqual=function(t){return t.uid===this.uid},Qf);function Qf(t){this.uid=t}Gf.UNAUTHENTICATED=new Gf(null),Gf.xa=new Gf("google-credentials-uid"),Gf.Ma=new Gf("first-party-uid");function Hf(t,e){this.user=e,this.type="OAuth",this.Oa={},this.Oa.Authorization="Bearer "+t}var Wf,$f,Kf,Xf=(gl.prototype.getToken=function(){return Promise.resolve(null)},gl.prototype.Ba=function(){},gl.prototype.qa=function(t){(this.La=t)(Gf.UNAUTHENTICATED)},gl.prototype.Ua=function(){this.La=null},gl),Yf=(vl.prototype.getToken=function(){var e=this,n=this.ja,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){return e.ja!==n?(Ar("FirebaseCredentialsProvider","getToken aborted due to token change."),e.getToken()):t?(xr("string"==typeof t.accessToken),new Hf(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},vl.prototype.Ba=function(){this.forceRefresh=!0},vl.prototype.qa=function(t){this.La=t,this.Wa&&t(this.currentUser)},vl.prototype.Ua=function(){this.auth&&this.auth.removeAuthTokenListener(this.Qa),this.Qa=null,this.La=null},vl.prototype.Ka=function(){var t=this.auth&&this.auth.getUid();return xr(null===t||"string"==typeof t),new Gf(t)},vl),Jf=(Object.defineProperty(yl.prototype,"Oa",{get:function(){var t={"X-Goog-AuthUser":this.za},e=this.Ga.auth.Ha([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),yl),Zf=(dl.prototype.getToken=function(){return Promise.resolve(new Jf(this.Ga,this.za))},dl.prototype.qa=function(t){t(Gf.Ma)},dl.prototype.Ua=function(){},dl.prototype.Ba=function(){},dl),tl=(pl.prototype.eu=function(){return 1===this.state||2===this.state||4===this.state},pl.prototype.nu=function(){return 2===this.state},pl.prototype.start=function(){3!==this.state?this.auth():this.su()},pl.prototype.stop=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.eu()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},pl.prototype.iu=function(){this.state=0,this.$o.reset()},pl.prototype.ru=function(){var t=this;this.nu()&&null===this.tu&&(this.tu=this.bs.Os(this.Ya,6e4,function(){return t.ou()}))},pl.prototype.hu=function(t){this.au(),this.stream.send(t)},pl.prototype.ou=function(){return y(this,void 0,void 0,function(){return v(this,function(t){return this.nu()?[2,this.close(0)]:[2]})})},pl.prototype.au=function(){this.tu&&(this.tu.cancel(),this.tu=null)},pl.prototype.close=function(e,n){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.au(),this.$o.cancel(),this.Za++,3!==e?this.$o.reset():n&&n.code===Wr.RESOURCE_EXHAUSTED?(Nr(n.toString()),Nr("Using maximum backoff delay to prevent overloading the backend."),this.$o.ks()):n&&n.code===Wr.UNAUTHENTICATED&&this.Xa.Ba(),null!==this.stream&&(this.uu(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.cu(n)];case 1:return t.sent(),[2]}})})},pl.prototype.uu=function(){},pl.prototype.auth=function(){var n=this;this.state=1;var t=this.lu(this.Za),e=this.Za;this.Xa.getToken().then(function(t){n.Za===e&&n._u(t)},function(e){t(function(){var t=new $r(Wr.UNKNOWN,"Fetching auth token failed: "+e.message);return n.fu(t)})})},pl.prototype._u=function(t){var e=this,n=this.lu(this.Za);this.stream=this.du(t),this.stream.wu(function(){n(function(){return e.state=2,e.listener.wu()})}),this.stream.cu(function(t){n(function(){return e.fu(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},pl.prototype.su=function(){var t=this;this.state=4,this.$o.xs(function(){return y(t,void 0,void 0,function(){return v(this,function(t){return this.state=0,this.start(),[2]})})})},pl.prototype.fu=function(t){return Ar("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},pl.prototype.lu=function(e){var n=this;return function(t){n.bs.cr(function(){return n.Za===e?t():(Ar("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},pl),el=(n(ll,Kf=tl),ll.prototype.du=function(t){return this.Ja.Tu("Listen",t)},ll.prototype.onMessage=function(t){this.$o.reset();var e=function(t,e){var n,r,i,o,s,u;if("targetChange"in e){e.targetChange;var a="NO_CHANGE"===(u=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===u?1:"REMOVE"===u?2:"CURRENT"===u?3:"RESET"===u?4:Dr(),h=e.targetChange.targetIds||[],c=(o=t,s=e.targetChange.resumeToken,o.Oe?(xr(void 0===s||"string"==typeof s),mi.fromBase64String(s||"")):(xr(void 0===s||s instanceof Uint8Array),mi.fromUint8Array(s||new Uint8Array))),f=e.targetChange.cause,l=f&&(i=void 0===(r=f).code?Wr.UNKNOWN:Ni(r.code),new $r(i,r.message||""));n=new Xi(a,h,c,l||null)}else if("documentChange"in e){e.documentChange;var p=e.documentChange;p.document,p.document.name,p.document.updateTime;var d=Go(t,p.document.name),y=Fo(p.document.updateTime),v=new Ys({mapValue:{fields:p.document.fields}}),g=new au(d,y,v,{}),m=p.targetIds||[],w=p.removedTargetIds||[];n=new $i(m,w,g.key,g)}else if("documentDelete"in e){e.documentDelete;var b=e.documentDelete;b.document;var I=Go(t,b.document),E=b.readTime?Fo(b.readTime):Xr.min(),T=new hu(I,E),_=b.removedTargetIds||[];n=new $i([],_,T.key,T)}else if("documentRemove"in e){e.documentRemove;var A=e.documentRemove;A.document;var N=Go(t,A.document),S=A.removedTargetIds||[];n=new $i([],S,N,null)}else{if(!("filter"in e))return Dr();e.filter;var D=e.filter;D.targetId;var x=D.count||0,P=new bi(x),O=D.targetId;n=new Ki(O,P)}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return Xr.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?Xr.min():Fo(e.readTime)}(t);return this.listener.Eu(e,n)},ll.prototype.Iu=function(t){var e,n,r,i,o={};o.database=Wo(this.serializer),o.addTarget=(e=this.serializer,i=(n=t).target,(r=gi(i)?{documents:Jo(e,i)}:{query:Zo(e,i)}).targetId=n.targetId,0<n.resumeToken.H()&&(r.resumeToken=jo(e,n.resumeToken)),r);var s,u,a=(this.serializer,s=t,null==(u=function(){switch(s.J){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Dr()}}())?null:{"goog-listen-tags":u});a&&(o.labels=a),this.hu(o)},ll.prototype.mu=function(t){var e={};e.database=Wo(this.serializer),e.removeTarget=t,this.hu(e)},ll),nl=(n(fl,$f=tl),Object.defineProperty(fl.prototype,"Ru",{get:function(){return this.Au},enumerable:!1,configurable:!0}),fl.prototype.start=function(){this.Au=!1,this.lastStreamToken=void 0,$f.prototype.start.call(this)},fl.prototype.uu=function(){this.Au&&this.Pu([])},fl.prototype.du=function(t){return this.Ja.Tu("Write",t)},fl.prototype.onMessage=function(t){if(xr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Au){this.$o.reset();var e=(r=t.writeResults,i=t.commitTime,r&&0<r.length?(xr(void 0!==i),r.map(function(t){return function(t,e){var n=t.updateTime?Fo(t.updateTime):Fo(e);n.isEqual(Xr.min())&&(n=Fo(e));var r=null;return t.transformResults&&0<t.transformResults.length&&(r=t.transformResults),new Ns(n,r)}(t,i)})):[]),n=Fo(t.commitTime);return this.listener.Vu(n,e)}var r,i;return xr(!t.writeResults||0===t.writeResults.length),this.Au=!0,this.listener.gu()},fl.prototype.yu=function(){var t={};t.database=Wo(this.serializer),this.hu(t)},fl.prototype.Pu=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map(function(t){return Xo(e.serializer,t)})};this.hu(n)},fl),rl=(n(cl,Wf=function(){this.je=void 0}),cl.prototype.bu=function(){if(this.pu)throw new $r(Wr.FAILED_PRECONDITION,"The client has already been terminated.")},cl.prototype.vu=function(e,n){var r=this;return this.bu(),this.credentials.getToken().then(function(t){return r.Ja.vu(e,n,t)}).catch(function(t){throw t.code===Wr.UNAUTHENTICATED&&r.credentials.Ba(),t})},cl.prototype.Su=function(e,n){var r=this;return this.bu(),this.credentials.getToken().then(function(t){return r.Ja.Su(e,n,t)}).catch(function(t){throw t.code===Wr.UNAUTHENTICATED&&r.credentials.Ba(),t})},cl),il=(hl.prototype.ku=function(r){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this.xu(),0<this.mutations.length)throw new $r(Wr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(s,u){return y(this,void 0,void 0,function(){var i,e,n,o,r;return v(this,function(t){switch(t.label){case 0:return i=Pr(s),e={database:Wo(i.serializer),documents:u.map(function(t){return zo(i.serializer,t)})},[4,i.Su("BatchGetDocuments",e)];case 1:return n=t.sent(),o=new Map,n.forEach(function(t){var e,n,r=(e=i.serializer,"found"in(n=t)?function(t,e){xr(!!e.found),e.found.name,e.found.updateTime;var n=Go(t,e.found.name),r=Fo(e.found.updateTime),i=new Ys({mapValue:{fields:e.found.fields}});return new au(n,r,i,{})}(e,n):"missing"in n?function(t,e){xr(!!e.missing),xr(!!e.readTime);var n=Go(t,e.missing),r=Fo(e.readTime);return new hu(n,r)}(e,n):Dr());o.set(r.key.toString(),r)}),r=[],[2,(u.forEach(function(t){var e=o.get(t.toString());xr(!!e),r.push(e)}),r)]}})})}(this.Du,r)];case 1:return[2,((e=t.sent()).forEach(function(t){t instanceof hu||t instanceof au?n.Mu(t):Dr()}),e)]}})})},hl.prototype.set=function(t,e){this.write(e.pa(t,this.Ue(t))),this.$u.add(t)},hl.prototype.update=function(t,e){try{this.write(e.pa(t,this.Ou(t)))}catch(t){this.Nu=t}this.$u.add(t)},hl.prototype.delete=function(t){this.write([new Ks(t,this.Ue(t))]),this.$u.add(t)},hl.prototype.commit=function(){return y(this,void 0,void 0,function(){var e,r=this;return v(this,function(t){switch(t.label){case 0:if(this.xu(),this.Nu)throw this.Nu;return e=this.Cu,this.mutations.forEach(function(t){e.delete(t.key.toString())}),e.forEach(function(t,e){var n=new ei(Jr.$(e));r.mutations.push(new Xs(n,r.Ue(n)))}),[4,function(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return e=Pr(r),n={database:Wo(e.serializer),writes:i.map(function(t){return Xo(e.serializer,t)})},[4,e.vu("Commit",n)];case 1:return t.sent(),[2]}})})}(this.Du,this.mutations)];case 1:return t.sent(),this.Fu=!0,[2]}})})},hl.prototype.Mu=function(t){var e;if(t instanceof au)e=t.version;else{if(!(t instanceof hu))throw Dr();e=Xr.min()}var n=this.Cu.get(t.key.toString());if(n){if(!e.isEqual(n))throw new $r(Wr.ABORTED,"Document version changed between two reads.")}else this.Cu.set(t.key.toString(),e)},hl.prototype.Ue=function(t){var e=this.Cu.get(t.toString());return!this.$u.has(t)&&e?Ss.updateTime(e):Ss.Qe()},hl.prototype.Ou=function(t){var e=this.Cu.get(t.toString());if(this.$u.has(t)||!e)return Ss.exists(!0);if(e.isEqual(Xr.min()))throw new $r(Wr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ss.updateTime(e)},hl.prototype.write=function(t){this.xu(),this.mutations=this.mutations.concat(t)},hl.prototype.xu=function(){},hl),ol=(al.prototype.Qu=function(){var t=this;0===this.Bu&&(this.Wu("Unknown"),this.qu=this.mo.Os("online_state_timeout",1e4,function(){return t.qu=null,t.ju("Backend didn't respond within 10 seconds."),t.Wu("Offline"),Promise.resolve()}))},al.prototype.Ku=function(t){"Online"===this.state?this.Wu("Unknown"):(this.Bu++,1<=this.Bu&&(this.Gu(),this.ju("Connection failed 1 times. Most recent error: "+t.toString()),this.Wu("Offline")))},al.prototype.set=function(t){this.Gu(),this.Bu=0,"Online"===t&&(this.Uu=!1),this.Wu(t)},al.prototype.Wu=function(t){t!==this.state&&(this.state=t,this.Lu(t))},al.prototype.ju=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Uu?(Nr(e),this.Uu=!1):Ar("OnlineStateTracker",e)},al.prototype.Gu=function(){null!==this.qu&&(this.qu.cancel(),this.qu=null)},al),sl=(ul.prototype.start=function(){return this.enableNetwork()},ul.prototype.enableNetwork=function(){return this.Xu.delete(0),this._c()},ul.prototype._c=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.ec()?(this.fc()?this.dc():this.sc.set("Unknown"),[4,this.wc()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},ul.prototype.disableNetwork=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Xu.add(0),[4,this.Tc()];case 1:return t.sent(),this.sc.set("Offline"),[2]}})})},ul.prototype.Tc=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.ac.stop()];case 1:return t.sent(),[4,this.ic.stop()];case 2:return t.sent(),0<this.Hu.length&&(Ar("RemoteStore","Stopping write stream with "+this.Hu.length+" pending writes"),this.Hu=[]),this.Ec(),[2]}})})},ul.prototype.gr=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return Ar("RemoteStore","RemoteStore shutting down."),this.Xu.add(5),[4,this.Tc()];case 1:return t.sent(),this.Zu.gr(),this.sc.set("Unknown"),[2]}})})},ul.prototype.listen=function(t){this.Yu.has(t.targetId)||(this.Yu.set(t.targetId,t),this.fc()?this.dc():this.ic.nu()&&this.Ic(t))},ul.prototype.mc=function(t){this.Yu.delete(t),this.ic.nu()&&this.Ac(t),0===this.Yu.size&&(this.ic.nu()?this.ic.ru():this.ec()&&this.sc.set("Unknown"))},ul.prototype.Me=function(t){return this.Yu.get(t)||null},ul.prototype.xe=function(t){return this.Rc.xe(t)},ul.prototype.Ic=function(t){this.Ju.de(t.targetId),this.ic.Iu(t)},ul.prototype.Ac=function(t){this.Ju.de(t),this.ic.mu(t)},ul.prototype.dc=function(){this.Ju=new ro(this),this.ic.start(),this.sc.Qu()},ul.prototype.fc=function(){return this.ec()&&!this.ic.eu()&&0<this.Yu.size},ul.prototype.ec=function(){return 0===this.Xu.size},ul.prototype.Ec=function(){this.Ju=null},ul.prototype.rc=function(){return y(this,void 0,void 0,function(){var n=this;return v(this,function(t){return this.Yu.forEach(function(t,e){n.Ic(t)}),[2]})})},ul.prototype.oc=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return this.Ec(),this.fc()?(this.sc.Ku(e),this.dc()):this.sc.set("Unknown"),[2]})})},ul.prototype.hc=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:if(this.sc.set("Online"),!(i instanceof Xi&&2===i.state&&i.cause))return[3,6];t.label=1;case 1:return t.trys.push([1,3,,5]),[4,this.Pc(i)];case 2:return t.sent(),[3,5];case 3:return e=t.sent(),Ar("RemoteStore","Failed to remove targets %s: %s ",i.targetIds.join(","),e),[4,this.Vc(e)];case 4:return t.sent(),[3,5];case 5:return[3,13];case 6:if(i instanceof $i?this.Ju.Pe(i):i instanceof Ki?this.Ju.De(i):this.Ju.ye(i),o.isEqual(Xr.min()))return[3,13];t.label=7;case 7:return t.trys.push([7,11,,13]),[4,this.zu.mi()];case 8:return n=t.sent(),0<=o.o(n)?[4,this.gc(o)]:[3,10];case 9:t.sent(),t.label=10;case 10:return[3,13];case 11:return Ar("RemoteStore","Failed to raise snapshot:",r=t.sent()),[4,this.Vc(r)];case 12:return t.sent(),[3,13];case 13:return[2]}})})},ul.prototype.Vc=function(n,r){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:if(!jh(n))throw n;return this.Xu.add(1),[4,this.Tc()];case 1:return t.sent(),this.sc.set("Offline"),r=r||function(){return e.zu.mi()},this.mo._r(function(){return y(e,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return Ar("RemoteStore","Retrying IndexedDB access"),[4,r()];case 1:return t.sent(),this.Xu.delete(1),[4,this._c()];case 2:return t.sent(),[2]}})})}),[2]}})})},ul.prototype.yc=function(e){var n=this;return e().catch(function(t){return n.Vc(t,e)})},ul.prototype.gc=function(r){var i=this,t=this.Ju.Ne(r);return t.Qt.forEach(function(t,e){if(0<t.resumeToken.H()){var n=i.Yu.get(e);n&&i.Yu.set(e,n.tt(t.resumeToken,r))}}),t.Wt.forEach(function(t){var e=i.Yu.get(t);if(e){i.Yu.set(t,e.tt(mi.Y,e.X)),i.Ac(t);var n=new Ti(e.target,t,1,e.sequenceNumber);i.Ic(n)}}),this.Rc.Lh(t)},ul.prototype.Pc=function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){switch(t.label){case 0:e=o.cause,n=0,r=o.targetIds,t.label=1;case 1:return n<r.length?(i=r[n],this.Yu.has(i)?[4,this.Rc.pc(i,e)]:[3,3]):[3,5];case 2:t.sent(),this.Yu.delete(i),this.Ju.removeTarget(i),t.label=3;case 3:t.label=4;case 4:return n++,[3,1];case 5:return[2]}})})},ul.prototype.wc=function(){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:e=0<this.Hu.length?this.Hu[this.Hu.length-1].batchId:-1,t.label=1;case 1:if(!this.bc())return[3,7];t.label=2;case 2:return t.trys.push([2,4,,6]),[4,this.zu.Qh(e)];case 3:return null===(n=t.sent())?(0===this.Hu.length&&this.ac.ru(),[3,7]):(e=n.batchId,this.vc(n),[3,6]);case 4:return r=t.sent(),[4,this.Vc(r)];case 5:return t.sent(),[3,6];case 6:return[3,1];case 7:return this.Sc()&&this.Dc(),[2]}})})},ul.prototype.bc=function(){return this.ec()&&this.Hu.length<10},ul.prototype.Cc=function(){return this.Hu.length},ul.prototype.vc=function(t){this.Hu.push(t),this.ac.nu()&&this.ac.Ru&&this.ac.Pu(t.mutations)},ul.prototype.Sc=function(){return this.ec()&&!this.ac.eu()&&0<this.Hu.length},ul.prototype.Dc=function(){this.ac.start()},ul.prototype.uc=function(){return y(this,void 0,void 0,function(){return v(this,function(t){return this.ac.yu(),[2]})})},ul.prototype.lc=function(){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){for(e=0,n=this.Hu;e<n.length;e++)r=n[e],this.ac.Pu(r.mutations);return[2]})})},ul.prototype.Vu=function(i,o){return y(this,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){switch(t.label){case 0:return e=this.Hu.shift(),n=Hu.from(e,i,o),[4,this.yc(function(){return r.Rc.Fc(n)})];case 1:return t.sent(),[4,this.wc()];case 2:return t.sent(),[2]}})})},ul.prototype.cc=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e&&this.ac.Ru?[4,this.Nc(e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return this.Sc()&&this.Dc(),[2]}})})},ul.prototype.Nc=function(i){return y(this,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){switch(t.label){case 0:return Ai(n=i.code)&&n!==Wr.ABORTED?(e=this.Hu.shift(),this.ac.iu(),[4,this.yc(function(){return r.Rc.$c(e.batchId,i)})]):[3,3];case 1:return t.sent(),[4,this.wc()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},ul.prototype.kc=function(){return new il(this.Du)},ul.prototype.nc=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Xu.add(4),[4,this.Tc()];case 1:return t.sent(),this.sc.set("Unknown"),this.ac.iu(),this.ic.iu(),this.Xu.delete(4),[4,this._c()];case 2:return t.sent(),[2]}})})},ul.prototype.xc=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.mo.Wo(),Ar("RemoteStore","RemoteStore received new credentials"),this.Xu.add(3),[4,this.Tc()];case 1:return t.sent(),this.sc.set("Unknown"),[4,this.Rc.xc(e)];case 2:return t.sent(),this.Xu.delete(3),[4,this._c()];case 3:return t.sent(),[2]}})})},ul.prototype.Mc=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e?(this.Xu.delete(2),[4,this._c()]):[3,2];case 1:return t.sent(),[3,5];case 2:return e?[3,4]:(this.Xu.add(2),[4,this.Tc()]);case 3:t.sent(),this.sc.set("Unknown"),t.label=4;case 4:t.label=5;case 5:return[2]}})})},ul);function ul(t,e,n,r,i){var o,s,u,a,h,c,f,l,p=this;this.zu=t,this.Du=e,this.mo=n,this.Hu=[],this.Yu=new Map,this.Ju=null,this.Xu=new Set,this.Zu=i,this.Zu.tc(function(t){n.cr(function(){return y(p,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.ec()?(Ar("RemoteStore","Restarting streams for network reachability change."),[4,this.nc()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.sc=new ol(n,r),this.ic=(h=this.Du,c=n,f={wu:this.rc.bind(this),cu:this.oc.bind(this),Eu:this.hc.bind(this)},l=Pr(h),new el(c,l.Ja,l.credentials,l.serializer,f)),this.ac=(o=this.Du,s=n,u={wu:this.uc.bind(this),cu:this.cc.bind(this),gu:this.lc.bind(this),Vu:this.Vu.bind(this)},a=Pr(o),new nl(s,a.Ja,a.credentials,a.serializer,u))}function al(t,e){this.mo=t,this.Lu=e,this.state="Unknown",this.Bu=0,this.qu=null,this.Uu=!0}function hl(t){this.Du=t,this.Cu=new Map,this.mutations=[],this.Fu=!1,this.Nu=null,this.$u=new Set}function cl(t,e,n){var r=this;return(r=Wf.call(this)||this).Ja=t,r.credentials=e,r.serializer=n,r.pu=!1,r}function fl(t,e,n,r,i){var o=this;return(o=$f.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).serializer=r,o.Au=!1,o}function ll(t,e,n,r,i){var o=this;return(o=Kf.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).serializer=r,o}function pl(t,e,n,r,i,o){this.bs=t,this.Ya=n,this.Ja=r,this.Xa=i,this.listener=o,this.state=0,this.Za=0,this.tu=null,this.stream=null,this.$o=new ha(t,e)}function dl(t,e){this.Ga=t,this.za=e}function yl(t,e){this.Ga=t,this.za=e,this.type="FirstParty",this.user=Gf.Ma}function vl(t){var e=this;this.Qa=null,this.currentUser=Gf.UNAUTHENTICATED,this.Wa=!1,this.ja=0,this.La=null,this.forceRefresh=!1,this.Qa=function(){e.ja++,e.currentUser=e.Ka(),e.Wa=!0,e.La&&e.La(e.currentUser)},this.ja=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.Qa):(this.Qa(null),t.get().then(function(t){e.auth=t,e.Qa&&e.auth.addAuthTokenListener(e.Qa)},function(){}))}function gl(){this.La=null}function ml(t,e){return"firestore_clients_"+t+"_"+e}function wl(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.zr()&&(r+="_"+e.uid),r}function bl(t,e){return"firestore_targets_"+t+"_"+e}function Il(t){this.key=t}function El(t){this.key=t}function Tl(t,e,n){this.query=t,this.targetId=e,this.view=n}function _l(t){this.key=t,this.Xl=!1}var Al=(Gl.Oc=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new $r(r.error.code,r.error.message)),i?new Gl(t,e,r.state,o):(Nr("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+n),null)},Gl.prototype.Lc=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Gl),Nl=(zl.Oc=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new $r(n.error.code,n.error.message)),r?new zl(t,n.state,i):(Nr("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},zl.prototype.Lc=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},zl),Sl=(Bl.Oc=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=Wi(),o=0;r&&o<n.activeTargetIds.length;++o)r=li(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new Bl(t,i):(Nr("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},Bl),Dl=(ql.Oc=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new ql(e.clientId,e.onlineState):(Nr("SharedClientState","Failed to parse online state: "+t),null)},ql),xl=(Fl.prototype.Bc=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},Fl.prototype.qc=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},Fl.prototype.Lc=function(){var t={activeTargetIds:this.activeTargetIds.F(),updateTimeMs:Date.now()};return JSON.stringify(t)},Fl),Pl=(jl.Hi=function(t){return!(!t||!t.localStorage)},jl.prototype.start=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h,c,f,l=this;return v(this,function(t){switch(t.label){case 0:return[4,this.Rc.Sr()];case 1:for(e=t.sent(),n=0,r=e;n<r.length;n++)(i=r[n])!==this.Uc&&(o=this.getItem(ml(this.persistenceKey,i)))&&(s=Sl.Oc(i,o))&&(this.jc=this.jc.nt(s.clientId,s));for(this.Zc(),(u=this.storage.getItem(this.Xc))&&(a=this.tl(u))&&this.el(a),h=0,c=this.Kc;h<c.length;h++)f=c[h],this.Wc(f);return this.Kc=[],this.window.addEventListener("unload",function(){return l.gr()}),this.or=!0,[2]}})})},jl.prototype.ys=function(t){this.setItem(this.zc,JSON.stringify(t))},jl.prototype.nl=function(){return this.sl(this.jc)},jl.prototype.il=function(n){var r=!1;return this.jc.forEach(function(t,e){e.activeTargetIds.has(n)&&(r=!0)}),r},jl.prototype.rl=function(t){this.ol(t,"pending")},jl.prototype.hl=function(t,e,n){this.ol(t,e,n),this.al(t)},jl.prototype.ul=function(t){var e="not-current";if(this.il(t)){var n=this.storage.getItem(bl(this.persistenceKey,t));if(n){var r=Nl.Oc(t,n);r&&(e=r.state)}}return this.cl.Bc(t),this.Zc(),e},jl.prototype.ll=function(t){this.cl.qc(t),this.Zc()},jl.prototype._l=function(t){return this.cl.activeTargetIds.has(t)},jl.prototype.fl=function(t){this.removeItem(bl(this.persistenceKey,t))},jl.prototype.dl=function(t,e,n){this.wl(t,e,n)},jl.prototype.Ch=function(t,e,n){var r=this;e.forEach(function(t){r.al(t)}),this.currentUser=t,n.forEach(function(t){r.rl(t)})},jl.prototype.Tl=function(t){this.El(t)},jl.prototype.gr=function(){this.or&&(this.window.removeEventListener("storage",this.Qc),this.removeItem(this.Gc),this.or=!1)},jl.prototype.getItem=function(t){var e=this.storage.getItem(t);return Ar("SharedClientState","READ",t,e),e},jl.prototype.setItem=function(t,e){Ar("SharedClientState","SET",t,e),this.storage.setItem(t,e)},jl.prototype.removeItem=function(t){Ar("SharedClientState","REMOVE",t),this.storage.removeItem(t)},jl.prototype.Wc=function(t){var e=this,u=t;if(u.storageArea===this.storage){if(Ar("SharedClientState","EVENT",u.key,u.newValue),u.key===this.Gc)return void Nr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.bs._r(function(){return y(e,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){if(this.or){if(null!==u.key)if(this.Hc.test(u.key)){if(null==u.newValue)return e=this.Il(u.key),[2,this.ml(e,null)];if(n=this.Al(u.key,u.newValue))return[2,this.ml(n.clientId,n)]}else if(this.Yc.test(u.key)){if(null!==u.newValue&&(r=this.Rl(u.key,u.newValue)))return[2,this.Pl(r)]}else if(this.Jc.test(u.key)){if(null!==u.newValue&&(i=this.Vl(u.key,u.newValue)))return[2,this.gl(i)]}else if(u.key===this.Xc){if(null!==u.newValue&&(o=this.tl(u.newValue)))return[2,this.el(o)]}else u.key===this.zc&&(s=function(t){var e=Zu.ps;if(null!=t)try{var n=JSON.parse(t);xr("number"==typeof n),e=n}catch(t){Nr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(u.newValue))!==Zu.ps&&this.Ps(s)}else this.Kc.push(u);return[2]})})})}},Object.defineProperty(jl.prototype,"cl",{get:function(){return this.jc.get(this.Uc)},enumerable:!1,configurable:!0}),jl.prototype.Zc=function(){this.setItem(this.Gc,this.cl.Lc())},jl.prototype.ol=function(t,e,n){var r=new Al(this.currentUser,t,e,n),i=wl(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Lc())},jl.prototype.al=function(t){var e=wl(this.persistenceKey,this.currentUser,t);this.removeItem(e)},jl.prototype.El=function(t){var e={clientId:this.Uc,onlineState:t};this.storage.setItem(this.Xc,JSON.stringify(e))},jl.prototype.wl=function(t,e,n){var r=bl(this.persistenceKey,t),i=new Nl(t,e,n);this.setItem(r,i.Lc())},jl.prototype.Il=function(t){var e=this.Hc.exec(t);return e?e[1]:null},jl.prototype.Al=function(t,e){var n=this.Il(t);return Sl.Oc(n,e)},jl.prototype.Rl=function(t,e){var n=this.Yc.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Al.Oc(new Gf(i),r,e)},jl.prototype.Vl=function(t,e){var n=this.Jc.exec(t),r=Number(n[1]);return Nl.Oc(r,e)},jl.prototype.tl=function(t){return Dl.Oc(t)},jl.prototype.Pl=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return e.user.uid===this.currentUser.uid?[2,this.Rc.yl(e.batchId,e.state,e.error)]:(Ar("SharedClientState","Ignoring mutation for non-active user "+e.user.uid),[2])})})},jl.prototype.gl=function(t){return this.Rc.pl(t.targetId,t.state,t.error)},jl.prototype.ml=function(t,e){var n=this,r=e?this.jc.nt(t,e):this.jc.remove(t),i=this.sl(this.jc),o=this.sl(r),s=[],u=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||u.push(t)}),this.Rc.bl(s,u).then(function(){n.jc=r})},jl.prototype.el=function(t){this.jc.get(t.clientId)&&this.Lu(t.onlineState)},jl.prototype.sl=function(t){var n=Wi();return t.forEach(function(t,e){n=n.Ct(e.activeTargetIds)}),n},jl),Ol=(Ml.prototype.rl=function(t){},Ml.prototype.hl=function(t,e,n){},Ml.prototype.ul=function(t){return this.vl.Bc(t),this.Sl[t]||"not-current"},Ml.prototype.dl=function(t,e,n){this.Sl[t]=e},Ml.prototype.ll=function(t){this.vl.qc(t)},Ml.prototype._l=function(t){return this.vl.activeTargetIds.has(t)},Ml.prototype.fl=function(t){delete this.Sl[t]},Ml.prototype.nl=function(){return this.vl.activeTargetIds},Ml.prototype.il=function(t){return this.vl.activeTargetIds.has(t)},Ml.prototype.start=function(){return this.vl=new xl,Promise.resolve()},Ml.prototype.Ch=function(t,e,n){},Ml.prototype.Tl=function(t){},Ml.prototype.gr=function(){},Ml.prototype.ys=function(t){},Ml),kl=(Object.defineProperty(Ul.prototype,"kl",{get:function(){return this.Dl},enumerable:!1,configurable:!0}),Ul.prototype.xl=function(t,e){var u=this,a=e?e.Ml:new Ji,h=e?e.$l:this.$l,c=e?e.Lt:this.Lt,f=h,l=!1,p=this.query.In()&&h.size===this.query.limit?h.last():null,d=this.query.mn()&&h.size===this.query.limit?h.first():null;if(t.ot(function(t,e){var n=h.get(t),r=e instanceof au?e:null;r=r&&(wu(u.query,r)?r:null);var i=!!n&&u.Lt.has(n.key),o=!!r&&(r.Ge||u.Lt.has(r.key)&&r.hasCommittedMutations),s=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(a.track({type:3,doc:r}),s=!0):u.Ol(n,r)||(a.track({type:2,doc:r}),s=!0,(p&&0<u.Nl(r,p)||d&&u.Nl(r,d)<0)&&(l=!0)):!n&&r?(a.track({type:0,doc:r}),s=!0):n&&!r&&(a.track({type:1,doc:n}),s=!0,(p||d)&&(l=!0)),s&&(c=r?(f=f.add(r),o?c.add(t):c.delete(t)):(f=f.delete(t),c.delete(t)))}),this.query.In()||this.query.mn())for(;f.size>this.query.limit;){var n=this.query.In()?f.last():f.first();f=f.delete(n.key),c=c.delete(n.key),a.track({type:1,doc:n})}return{$l:f,Ml:a,Ll:l,Lt:c}},Ul.prototype.Ol=function(t,e){return t.Ge&&e.hasCommittedMutations&&!e.Ge},Ul.prototype.Jn=function(t,e,n){var o=this,r=this.$l;this.$l=t.$l,this.Lt=t.Lt;var i=t.Ml.Mt();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o.Nl(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Dr()}}var r,i}),this.Bl(n);var s=e?this.ql():[],u=0===this.Fl.size&&this.Ht?1:0,a=u!==this.Cl;return this.Cl=u,0!==i.length||a?{snapshot:new Zi(this.query,t.$l,r,i,t.Lt,0==u,a,!1),Ul:s}:{Ul:s}},Ul.prototype.Ql=function(t){return this.Ht&&"Offline"===t?(this.Ht=!1,this.Jn({$l:this.$l,Ml:new Ji,Lt:this.Lt,Ll:!1},!1)):{Ul:[]}},Ul.prototype.Wl=function(t){return!this.Dl.has(t)&&!!this.$l.has(t)&&!this.$l.get(t).Ge},Ul.prototype.Bl=function(t){var e=this;t&&(t.Yt.forEach(function(t){return e.Dl=e.Dl.add(t)}),t.Jt.forEach(function(t){}),t.Xt.forEach(function(t){return e.Dl=e.Dl.delete(t)}),this.Ht=t.Ht)},Ul.prototype.ql=function(){var e=this;if(!this.Ht)return[];var n=this.Fl;this.Fl=Qi(),this.$l.forEach(function(t){e.Wl(t.key)&&(e.Fl=e.Fl.add(t.key))});var r=[];return n.forEach(function(t){e.Fl.has(t)||r.push(new El(t))}),this.Fl.forEach(function(t){n.has(t)||r.push(new Il(t))}),r},Ul.prototype.jl=function(t){this.Dl=t.zh,this.Fl=Qi();var e=this.xl(t.documents);return this.Jn(e,!0)},Ul.prototype.Kl=function(){return Zi.Ut(this.query,this.$l,this.Lt,0===this.Cl)},Ul),Ll=(Vl.prototype.run=function(){this.zl()},Vl.prototype.zl=function(){var t=this;this.$o.xs(function(){return y(t,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){return e=new il(this.Du),(n=this.Hl(e))&&n.then(function(t){r.mo.cr(function(){return e.commit().then(function(){r.Po.resolve(t)}).catch(function(t){r.Yl(t)})})}).catch(function(t){r.Yl(t)}),[2]})})})},Vl.prototype.Hl=function(t){try{var e=this.updateFunction(t);return!ci(e)&&e.catch&&e.then?e:(this.Po.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.Po.reject(t),null}},Vl.prototype.Yl=function(t){var e=this;0<this.Gl&&this.Jl(t)?(--this.Gl,this.mo.cr(function(){return e.zl(),Promise.resolve()})):this.Po.reject(t)},Vl.prototype.Jl=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!Ai(e)},Vl),Rl=(Object.defineProperty(Cl.prototype,"__",{get:function(){return!0},enumerable:!1,configurable:!0}),Cl.prototype.subscribe=function(t){this.n_=t},Cl.prototype.listen=function(s){return y(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:return this.f_("listen()"),(r=this.s_.get(s))?(e=r.targetId,this.t_.ul(e),n=r.view.Kl(),[3,4]):[3,1];case 1:return[4,this.zu.jh(s.We())];case 2:return i=t.sent(),o=this.t_.ul(i.targetId),e=i.targetId,[4,this.d_(s,e,"current"===o)];case 3:n=t.sent(),this.__&&this.Zl.listen(i),t.label=4;case 4:return[2,n]}})})},Cl.prototype.d_=function(u,a,h){return y(this,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){switch(t.label){case 0:return[4,this.zu.Gh(u,!0)];case 1:return e=t.sent(),n=new kl(u,e.zh),r=n.xl(e.documents),i=eo.zt(a,h&&"Offline"!==this.onlineState),o=n.Jn(r,this.__,i),this.w_(a,o.Ul),s=new Tl(u,a,n),[2,(this.s_.set(u,s),this.i_.has(a)?this.i_.get(a).push(u):this.i_.set(a,[u]),o.snapshot)]}})})},Cl.prototype.mc=function(i){return y(this,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){switch(t.label){case 0:return this.f_("unlisten()"),e=this.s_.get(i),1<(n=this.i_.get(e.targetId)).length?[2,(this.i_.set(e.targetId,n.filter(function(t){return!vu(t,i)})),void this.s_.delete(i))]:this.__?(this.t_.ll(e.targetId),this.t_.il(e.targetId)?[3,2]:[4,this.zu.Kh(e.targetId,!1).then(function(){r.t_.fl(e.targetId),r.Zl.mc(e.targetId),r.T_(e.targetId)}).catch(yc)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return this.T_(e.targetId),[4,this.zu.Kh(e.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})},Cl.prototype.write=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:this.f_("write()"),t.label=1;case 1:return t.trys.push([1,5,,6]),[4,this.zu.kh(i)];case 2:return e=t.sent(),this.t_.rl(e.batchId),this.E_(e.batchId,o),[4,this.I_(e.Un)];case 3:return t.sent(),[4,this.Zl.wc()];case 4:return t.sent(),[3,6];case 5:return n=t.sent(),r=Jh(n,"Failed to persist write"),o.reject(r),[3,6];case 6:return[2]}})})},Cl.prototype.runTransaction=function(t,e,n){new Ll(t,this.Du,e,n).run()},Cl.prototype.Lh=function(n){return y(this,void 0,void 0,function(){var e,r=this;return v(this,function(t){switch(t.label){case 0:this.f_("applyRemoteEvent()"),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.zu.Lh(n)];case 2:return e=t.sent(),n.Qt.forEach(function(t,e){var n=r.h_.get(e);n&&(xr(t.Yt.size+t.Jt.size+t.Xt.size<=1),0<t.Yt.size?n.Xl=!0:0<t.Jt.size?xr(n.Xl):0<t.Xt.size&&(xr(n.Xl),n.Xl=!1))}),[4,this.I_(e,n)];case 3:return t.sent(),[3,6];case 4:return[4,yc(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},Cl.prototype.Ql=function(r,t){this.f_("applyOnlineStateChange()");var i=[];this.s_.forEach(function(t,e){var n=e.view.Ql(r);n.snapshot&&i.push(n.snapshot)}),this.n_.m_(r),this.n_.Eu(i),this.onlineState=r},Cl.prototype.pc=function(u,a){return y(this,void 0,void 0,function(){var e,n,r,i,o,s=this;return v(this,function(t){switch(t.label){case 0:return this.f_("rejectListens()"),this.t_.dl(u,"rejected",a),e=this.h_.get(u),(n=e&&e.key)?(r=(r=new Si(ei.P)).nt(n,new hu(n,Xr.min())),i=Qi().add(n),o=new to(Xr.min(),new Map,new Ri(Rr),r,i),[4,this.Lh(o)]):[3,2];case 1:return t.sent(),this.o_=this.o_.remove(n),this.h_.delete(u),this.A_(),[3,4];case 2:return[4,this.zu.Kh(u,!1).then(function(){return s.T_(u,a)}).catch(yc)];case 3:t.sent(),t.label=4;case 4:return[2]}})})},Cl.prototype.Fc=function(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:this.f_("applySuccessfulWrite()"),e=r.batch.batchId,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.zu.xh(r)];case 2:return n=t.sent(),this.R_(e,null),this.P_(e),this.t_.hl(e,"acknowledged"),[4,this.I_(n)];case 3:return t.sent(),[3,6];case 4:return[4,yc(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},Cl.prototype.$c=function(n,r){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:this.f_("rejectFailedWrite()"),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.zu.Oh(n)];case 2:return e=t.sent(),this.R_(n,r),this.P_(n),this.t_.hl(n,"rejected",r),[4,this.I_(e)];case 3:return t.sent(),[3,6];case 4:return[4,yc(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},Cl.prototype.V_=function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){switch(t.label){case 0:this.Zl.ec()||Ar("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.zu.to()];case 2:return-1===(e=t.sent())?[2,void o.resolve()]:((n=this.c_.get(e)||[]).push(o),this.c_.set(e,n),[3,4]);case 3:return r=t.sent(),i=Jh(r,"Initialization of waitForPendingWrites() operation failed"),o.reject(i),[3,4];case 4:return[2]}})})},Cl.prototype.P_=function(t){(this.c_.get(t)||[]).forEach(function(t){t.resolve()}),this.c_.delete(t)},Cl.prototype.g_=function(e){this.c_.forEach(function(t){t.forEach(function(t){t.reject(new $r(Wr.CANCELLED,e))})}),this.c_.clear()},Cl.prototype.E_=function(t,e){var n=this.u_[this.currentUser.ka()];n=(n=n||new Si(Rr)).nt(t,e),this.u_[this.currentUser.ka()]=n},Cl.prototype.R_=function(t,e){var n=this.u_[this.currentUser.ka()];if(n){var r=n.get(t);r&&(e?r.reject(e):r.resolve(),n=n.remove(t)),this.u_[this.currentUser.ka()]=n}},Cl.prototype.T_=function(t,e){var n=this;void 0===e&&(e=null),this.t_.ll(t);for(var r=0,i=this.i_.get(t);r<i.length;r++){var o=i[r];this.s_.delete(o),e&&this.n_.y_(o,e)}this.i_.delete(t),this.__&&this.a_.oa(t).forEach(function(t){n.a_.Mi(t)||n.p_(t)})},Cl.prototype.p_=function(t){var e=this.o_.get(t);null!==e&&(this.Zl.mc(e),this.o_=this.o_.remove(t),this.h_.delete(e),this.A_())},Cl.prototype.w_=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof Il?(this.a_.Fi(i.key,t),this.b_(i)):i instanceof El?(Ar("SyncEngine","Document no longer in limbo: "+i.key),this.a_.$i(i.key,t),this.a_.Mi(i.key)||this.p_(i.key)):Dr()}},Cl.prototype.b_=function(t){var e=t.key;this.o_.get(e)||(Ar("SyncEngine","New document in limbo: "+e),this.r_.push(e),this.A_())},Cl.prototype.A_=function(){for(;0<this.r_.length&&this.o_.size<this.e_;){var t=this.r_.shift(),e=this.l_.next();this.h_.set(e,new _l(t)),this.o_=this.o_.nt(t,e),this.Zl.listen(new Ti(fu.hn(t.path).We(),e,2,Zu.ps))}},Cl.prototype.v_=function(){return this.o_},Cl.prototype.S_=function(){return this.r_},Cl.prototype.I_=function(r,a){return y(this,void 0,void 0,function(){var o,s,e,u=this;return v(this,function(t){switch(t.label){case 0:return o=[],s=[],e=[],this.s_.forEach(function(t,i){e.push(Promise.resolve().then(function(){var n=i.view.xl(r);return n.Ll?u.zu.Gh(i.query,!1).then(function(t){var e=t.documents;return i.view.xl(e,n)}):n}).then(function(t){var e=a&&a.Qt.get(i.targetId),n=i.view.Jn(t,u.__,e);if(u.w_(i.targetId,n.Ul),n.snapshot){u.__&&u.t_.dl(i.targetId,n.snapshot.fromCache?"not-current":"current"),o.push(n.snapshot);var r=Ju.Rs(i.targetId,n.snapshot);s.push(r)}}))}),[4,Promise.all(e)];case 1:return t.sent(),this.n_.Eu(o),[4,this.zu.Uh(s)];case 2:return t.sent(),[2]}})})},Cl.prototype.f_=function(t){},Cl.prototype.xc=function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.currentUser.isEqual(n)?[3,3]:(Ar("SyncEngine","User change. New user:",n.ka()),[4,this.zu.Ch(n)]);case 1:return e=t.sent(),this.currentUser=n,this.g_("'waitForPendingWrites' promise is rejected due to a user change."),this.t_.Ch(n,e.Nh,e.$h),[4,this.I_(e.Fh)];case 2:t.sent(),t.label=3;case 3:return[2]}})})},Cl.prototype.enableNetwork=function(){return this.Zl.enableNetwork()},Cl.prototype.disableNetwork=function(){return this.Zl.disableNetwork()},Cl.prototype.xe=function(t){var e=this.h_.get(t);if(e&&e.Xl)return Qi().add(e.key);var n=Qi(),r=this.i_.get(t);if(!r)return n;for(var i=0,o=r;i<o.length;i++){var s=o[i],u=this.s_.get(s);n=n.Ct(u.view.kl)}return n},Cl);function Cl(t,e,n,r,i,o){this.zu=t,this.Zl=e,this.Du=n,this.t_=r,this.currentUser=i,this.e_=o,this.n_=null,this.s_=new Hr(function(t){return gu(t)},vu),this.i_=new Map,this.r_=[],this.o_=new Si(ei.P),this.h_=new Map,this.a_=new vc,this.u_={},this.c_=new Map,this.l_=Fa.di(),this.onlineState="Unknown"}function Vl(t,e,n,r){this.mo=t,this.Du=e,this.updateFunction=n,this.Po=r,this.Gl=5,this.$o=new ha(this.mo,"transaction_retry")}function Ul(t,e){this.query=t,this.Dl=e,this.Cl=null,this.Ht=!1,this.Fl=Qi(),this.Lt=Qi(),this.Nl=bu(t),this.$l=new Yi(this.Nl)}function Ml(){this.vl=new xl,this.Sl={},this.Rc=null,this.Lu=null,this.Ps=null}function jl(t,e,n,r,i){this.window=t,this.bs=e,this.persistenceKey=n,this.Uc=r,this.Rc=null,this.Lu=null,this.Ps=null,this.Qc=this.Wc.bind(this),this.jc=new Si(Rr),this.or=!1,this.Kc=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Gc=ml(this.persistenceKey,this.Uc),this.zc="firestore_sequence_number_"+this.persistenceKey,this.jc=this.jc.nt(this.Uc,new xl),this.Hc=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Yc=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.Jc=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Xc="firestore_online_state_"+this.persistenceKey,this.window.addEventListener("storage",this.Qc)}function Fl(){this.activeTargetIds=Wi()}function ql(t,e){this.clientId=t,this.onlineState=e}function Bl(t,e){this.clientId=t,this.activeTargetIds=e}function zl(t,e,n){this.targetId=t,this.state=e,this.error=n}function Gl(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}function Ql(t,e,n,r,i,o){return new Rl(t,e,n,r,i,o)}function Hl(){this.x_=void 0,this.listeners=[]}var Wl,$l,Kl=(n(sp,Wl=Rl),Object.defineProperty(sp.prototype,"__",{get:function(){return!0===this.D_},enumerable:!1,configurable:!0}),sp.prototype.enableNetwork=function(){return this.zu.ur(!0),Wl.prototype.enableNetwork.call(this)},sp.prototype.disableNetwork=function(){return this.zu.ur(!1),Wl.prototype.disableNetwork.call(this)},sp.prototype.C_=function(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,this.zu.Gh(r.query,!0)];case 1:return e=t.sent(),n=r.view.jl(e),[2,(this.D_&&this.w_(r.targetId,n.Ul),n)]}})})},sp.prototype.Ql=function(t,e){this.__&&0===e&&(Wl.prototype.Ql.call(this,t,e),this.t_.Tl(t)),this.__||1!==e||Wl.prototype.Ql.call(this,t,e)},sp.prototype.yl=function(n,r,i){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.f_("applyBatchState()"),[4,this.zu.Yh(n)];case 1:return null===(e=t.sent())?[3,6]:"pending"!==r?[3,3]:[4,this.Zl.wc()];case 2:return t.sent(),[3,4];case 3:"acknowledged"===r||"rejected"===r?(this.R_(n,i||null),this.zu.Jh(n)):Dr(),t.label=4;case 4:return[4,this.I_(e)];case 5:return t.sent(),[3,7];case 6:Ar("SyncEngine","Cannot apply mutation batch with id: "+n),t.label=7;case 7:return[2]}})})},sp.prototype.Mc=function(h){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a=this;return v(this,function(t){switch(t.label){case 0:return!0!==h||!0===this.D_?[3,3]:(e=this.t_.nl(),[4,this.F_(e.F(),!0)]);case 1:return n=t.sent(),this.D_=!0,[4,this.Zl.Mc(!0)];case 2:for(t.sent(),r=0,i=n;r<i.length;r++)o=i[r],this.Zl.listen(o);return[3,7];case 3:return!1!==h||!1===this.D_?[3,7]:(s=[],u=Promise.resolve(),this.i_.forEach(function(t,e){a.t_._l(e)?s.push(e):u=u.then(function(){return a.T_(e),a.zu.Kh(e,!0)}),a.Zl.mc(e)}),[4,u]);case 4:return t.sent(),[4,this.F_(s,!1)];case 5:return t.sent(),this.N_(),this.D_=!1,[4,this.Zl.Mc(!1)];case 6:t.sent(),t.label=7;case 7:return[2]}})})},sp.prototype.N_=function(){var n=this;this.h_.forEach(function(t,e){n.Zl.mc(e)}),this.a_.ha(),this.h_=new Map,this.o_=new Si(ei.P)},sp.prototype.F_=function(d,t){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h,c,f,l,p;return v(this,function(t){switch(t.label){case 0:e=[],n=[],r=0,i=d,t.label=1;case 1:return r<i.length?(o=i[r],s=void 0,(u=this.i_.get(o))&&0!==u.length?[4,this.zu.jh(u[0].We())]:[3,7]):[3,13];case 2:s=t.sent(),a=0,h=u,t.label=3;case 3:return a<h.length?(c=h[a],f=this.s_.get(c),[4,this.C_(f)]):[3,6];case 4:(l=t.sent()).snapshot&&n.push(l.snapshot),t.label=5;case 5:return a++,[3,3];case 6:return[3,11];case 7:return[4,this.zu.Xh(o)];case 8:return p=t.sent(),[4,this.zu.jh(p)];case 9:return s=t.sent(),[4,this.d_(this.k_(p),o,!1)];case 10:t.sent(),t.label=11;case 11:e.push(s),t.label=12;case 12:return r++,[3,1];case 13:return[2,(this.n_.Eu(n),e)]}})})},sp.prototype.k_=function(t){return new fu(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)},sp.prototype.Sr=function(){return this.zu.Sr()},sp.prototype.pl=function(r,i,o){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return this.D_?(Ar("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!this.i_.has(r))return[3,8];switch(i){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,this.zu.si()];case 3:return e=t.sent(),n=to.Gt(r,"current"===i),[4,this.I_(e,n)];case 4:return t.sent(),[3,8];case 5:return[4,this.zu.Kh(r,!0)];case 6:return t.sent(),this.T_(r,o),[3,8];case 7:Dr(),t.label=8;case 8:return[2]}})})},sp.prototype.bl=function(l,p){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h,c,f=this;return v(this,function(t){switch(t.label){case 0:if(!this.D_)return[3,10];e=0,n=l,t.label=1;case 1:return e<n.length?(r=n[e],this.i_.has(r)?(Ar("SyncEngine","Adding an already active target "+r),[3,5]):[4,this.zu.Xh(r)]):[3,6];case 2:return i=t.sent(),[4,this.zu.jh(i)];case 3:return o=t.sent(),[4,this.d_(this.k_(i),o.targetId,!1)];case 4:t.sent(),this.Zl.listen(o),t.label=5;case 5:return e++,[3,1];case 6:s=function(e){return v(this,function(t){switch(t.label){case 0:return u.i_.has(e)?[4,u.zu.Kh(e,!1).then(function(){f.Zl.mc(e),f.T_(e)}).catch(yc)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})},u=this,a=0,h=p,t.label=7;case 7:return a<h.length?(c=h[a],[5,s(c)]):[3,10];case 8:t.sent(),t.label=9;case 9:return a++,[3,7];case 10:return[2]}})})},sp),Xl=(op.prototype.listen=function(u){return y(this,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){switch(t.label){case 0:if(e=u.query,n=!1,(r=this.M_.get(e))||(n=!0,r=new Hl),!n)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),i=r,[4,this.Rc.listen(e)];case 2:return i.x_=t.sent(),[3,4];case 3:return o=t.sent(),s=Jh(o,"Initialization of query '"+mu(u.query)+"' failed"),[2,void u.onError(s)];case 4:return this.M_.set(e,r),r.listeners.push(u),u.Ql(this.onlineState),r.x_&&u.L_(r.x_)&&this.B_(),[2]}})})},op.prototype.mc=function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){return e=o.query,n=!1,(r=this.M_.get(e))&&0<=(i=r.listeners.indexOf(o))&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?[2,(this.M_.delete(e),this.Rc.mc(e))]:[2]})})},op.prototype.Eu=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,s=this.M_.get(o);if(s){for(var u=0,a=s.listeners;u<a.length;u++)a[u].L_(i)&&(e=!0);s.x_=i}}e&&this.B_()},op.prototype.y_=function(t,e){var n=this.M_.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++)i[r].onError(e);this.M_.delete(t)},op.prototype.m_=function(i){this.onlineState=i;var o=!1;this.M_.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].Ql(i)&&(o=!0)}),o&&this.B_()},op.prototype.q_=function(t){this.O_.add(t),t.next()},op.prototype.U_=function(t){this.O_.delete(t)},op.prototype.B_=function(){this.O_.forEach(function(t){t.next()})},op),Yl=(ip.prototype.L_=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new Zi(t.query,t.docs,t.Ot,e,t.Lt,t.fromCache,t.Bt,!0)}var o=!1;return this.W_?this.K_(t)&&(this.Q_.next(t),o=!0):this.G_(t,this.onlineState)&&(this.z_(t),o=!0),this.j_=t,o},ip.prototype.onError=function(t){this.Q_.error(t)},ip.prototype.Ql=function(t){this.onlineState=t;var e=!1;return this.j_&&!this.W_&&this.G_(this.j_,t)&&(this.z_(this.j_),e=!0),e},ip.prototype.G_=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.H_&&n||t.docs._()&&"Offline"!==e)},ip.prototype.K_=function(t){if(0<t.docChanges.length)return!0;var e=this.j_&&this.j_.hasPendingWrites!==t.hasPendingWrites;return!(!t.Bt&&!e)&&!0===this.options.includeMetadataChanges},ip.prototype.z_=function(t){t=Zi.Ut(t.query,t.docs,t.Lt,t.fromCache),this.W_=!0,this.Q_.next(t)},ip),Jl=(rp.prototype.Dh=function(t){this.Y_=t},rp.prototype._s=function(e,r,i,o){var s=this;return r.En()||i.isEqual(Xr.min())?this.J_(e,r):this.Y_.us(e,o).next(function(t){var n=s.X_(r,t);return(r.In()||r.mn())&&s.Ll(r.nn,n,o,i)?s.J_(e,r):(_r()<=p.DEBUG&&Ar("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),mu(r)),s.Y_._s(e,r,i).next(function(e){return n.forEach(function(t){e=e.nt(t.key,t)}),e}))})},rp.prototype.X_=function(n,t){var r=new Ri(bu(n));return t.forEach(function(t,e){e instanceof au&&wu(n,e)&&(r=r.add(e))}),r},rp.prototype.Ll=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||0<i.version.o(r))},rp.prototype.J_=function(t,e){return _r()<=p.DEBUG&&Ar("IndexFreeQueryEngine","Using full collection scan to execute query:",mu(e)),this.Y_._s(t,e,Xr.min())},rp),Zl=(np.prototype.Hr=function(t){return Wu.resolve(0===this.ns.length)},np.prototype.Yr=function(t,e,n,r){var i=this.Z_;this.Z_++,0<this.ns.length&&this.ns[this.ns.length-1];var o=new Qu(i,e,n,r);this.ns.push(o);for(var s=0,u=r;s<u.length;s++){var a=u[s];this.tf=this.tf.add(new gc(a.key,i)),this.ss.Us(t,a.key.path.p())}return Wu.resolve(o)},np.prototype.Jr=function(t,e){return Wu.resolve(this.ef(e))},np.prototype.Zr=function(t,e){var n=e+1,r=this.nf(n),i=r<0?0:r;return Wu.resolve(this.ns.length>i?this.ns[i]:null)},np.prototype.to=function(){return Wu.resolve(0===this.ns.length?-1:this.Z_-1)},np.prototype.eo=function(t){return Wu.resolve(this.ns.slice())},np.prototype.os=function(t,e){var n=this,r=new gc(e,0),i=new gc(e,Number.POSITIVE_INFINITY),o=[];return this.tf.vt([r,i],function(t){var e=n.ef(t.ua);o.push(e)}),Wu.resolve(o)},np.prototype.ls=function(t,e){var r=this,i=new Ri(Rr);return e.forEach(function(t){var e=new gc(t,0),n=new gc(t,Number.POSITIVE_INFINITY);r.tf.vt([e,n],function(t){i=i.add(t.ua)})}),Wu.resolve(this.sf(i))},np.prototype.Es=function(t,e){var n=e.path,r=n.length+1,i=n;ei.W(i)||(i=i.child(""));var o=new gc(new ei(i),0),s=new Ri(Rr);return this.tf.St(function(t){var e=t.key.path;return!!n.D(e)&&(e.length===r&&(s=s.add(t.ua)),!0)},o),Wu.resolve(this.sf(s))},np.prototype.sf=function(t){var n=this,r=[];return t.forEach(function(t){var e=n.ef(t);null!==e&&r.push(e)}),r},np.prototype.so=function(n,r){var i=this;xr(0===this.if(r.batchId,"removed")),this.ns.shift();var o=this.tf;return Wu.forEach(r.mutations,function(t){var e=new gc(t.key,r.batchId);return o=o.delete(e),i.wi.qr(n,t.key)}).next(function(){i.tf=o})},np.prototype.io=function(t){},np.prototype.Mi=function(t,e){var n=new gc(e,0),r=this.tf.Dt(n);return Wu.resolve(e.isEqual(r&&r.key))},np.prototype.ro=function(t){return this.ns.length,Wu.resolve()},np.prototype.if=function(t,e){return this.nf(t)},np.prototype.nf=function(t){return 0===this.ns.length?0:t-this.ns[0].batchId},np.prototype.ef=function(t){var e=this.nf(t);return e<0||e>=this.ns.length?null:this.ns[e]},np),tp=(ep.prototype.jn=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.rf(e);return this.docs=this.docs.nt(r,{Ys:e,size:s,readTime:n}),this.size+=s-o,this.ss.Us(t,r.path.p())},ep.prototype.Gn=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},ep.prototype.zn=function(t,e){var n=this.docs.get(e);return Wu.resolve(n?n.Ys:null)},ep.prototype.getEntries=function(t,e){var n=this,r=Fi();return e.forEach(function(t){var e=n.docs.get(t);r=r.nt(t,e?e.Ys:null)}),Wu.resolve(r)},ep.prototype._s=function(t,e,n){for(var r=Bi(),i=new ei(e.path.child("")),o=this.docs.ut(i);o.wt();){var s=o.dt(),u=s.key,a=s.value,h=a.Ys,c=a.readTime;if(!e.path.D(u.path))break;c.o(n)<=0||h instanceof au&&wu(e,h)&&(r=r.nt(h.key,h))}return Wu.resolve(r)},ep.prototype.hf=function(t,e){return Wu.forEach(this.docs,function(t){return e(t)})},ep.prototype.oi=function(t){return new ep.hi(this)},ep.prototype.ui=function(t){return Wu.resolve(this.size)},ep);function ep(t,e){this.ss=t,this.rf=e,this.docs=new Si(ei.P),this.size=0}function np(t,e){this.ss=t,this.wi=e,this.ns=[],this.Z_=1,this.tf=new Ri(gc.ta)}function rp(){}function ip(t,e,n){this.query=t,this.Q_=e,this.W_=!1,this.j_=null,this.onlineState="Unknown",this.options=n||{}}function op(t){this.Rc=t,this.M_=new Hr(function(t){return gu(t)},vu),this.onlineState="Unknown",this.O_=new Set,this.Rc.subscribe(this)}function sp(t,e,n,r,i,o){var s=this;return(s=Wl.call(this,t,e,n,r,i,o)||this).zu=t,s.D_=void 0,s}function up(t){var e=this;return(e=$l.call(this)||this).ci=t,e}tp.hi=(n(up,$l=$u),up.prototype.Jn=function(n){var r=this,i=[];return this.Un.forEach(function(t,e){e?i.push(r.ci.jn(n,e,r.readTime)):r.ci.Gn(t)}),Wu.Bn(i)},up.prototype.Hn=function(t,e){return this.ci.zn(t,e)},up.prototype.Yn=function(t,e){return this.ci.getEntries(t,e)},up);var ap,hp,cp,fp=(Mp.prototype.pe=function(t,n){return this.af.forEach(function(t,e){return n(e)}),Wu.resolve()},Mp.prototype.mi=function(t){return Wu.resolve(this.lastRemoteSnapshotVersion)},Mp.prototype.Ai=function(t){return Wu.resolve(this.uf)},Mp.prototype.Ti=function(t){return this.highestTargetId=this.lf.next(),Wu.resolve(this.highestTargetId)},Mp.prototype.Ri=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.uf&&(this.uf=e),Wu.resolve()},Mp.prototype.Vi=function(t){this.af.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.lf=new Fa(e),this.highestTargetId=e),t.sequenceNumber>this.uf&&(this.uf=t.sequenceNumber)},Mp.prototype.Pi=function(t,e){return this.Vi(e),this.targetCount+=1,Wu.resolve()},Mp.prototype.yi=function(t,e){return this.Vi(e),Wu.resolve()},Mp.prototype.pi=function(t,e){return this.af.delete(e.target),this.cf.oa(e.targetId),--this.targetCount,Wu.resolve()},Mp.prototype.vi=function(n,r,i){var o=this,s=0,u=[];return this.af.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.af.delete(t),u.push(o.bi(n,e.targetId)),s++)}),Wu.Bn(u).next(function(){return s})},Mp.prototype.Si=function(t){return Wu.resolve(this.targetCount)},Mp.prototype.Di=function(t,e){var n=this.af.get(e)||null;return Wu.resolve(n)},Mp.prototype.Ci=function(t,e,n){return this.cf.sa(e,n),Wu.resolve()},Mp.prototype.Ni=function(e,t,n){this.cf.ra(t,n);var r=this.persistence.wi,i=[];return r&&t.forEach(function(t){i.push(r.qr(e,t))}),Wu.Bn(i)},Mp.prototype.bi=function(t,e){return this.cf.oa(e),Wu.resolve()},Mp.prototype.ki=function(t,e){var n=this.cf.aa(e);return Wu.resolve(n)},Mp.prototype.Mi=function(t,e){return Wu.resolve(this.cf.Mi(e))},Mp),lp=(Up.prototype.start=function(){return Promise.resolve()},Up.prototype.gr=function(){return this.Qi=!1,Promise.resolve()},Object.defineProperty(Up.prototype,"or",{get:function(){return this.Qi},enumerable:!1,configurable:!0}),Up.prototype.hr=function(){},Up.prototype.$r=function(){return this.ss},Up.prototype.Dr=function(t){var e=this._f[t.ka()];return e||(e=new Zl(this.ss,this.wi),this._f[t.ka()]=e),e},Up.prototype.Fr=function(){return this.Ji},Up.prototype.Nr=function(){return this.es},Up.prototype.runTransaction=function(t,e,n){var r=this;Ar("MemoryPersistence","Starting transaction:",t);var i=new pp(this.Ui.next());return this.wi.df(),n(i).next(function(t){return r.wi.wf(i).next(function(){return t})}).On().then(function(t){return i.ts(),t})},Up.prototype.Tf=function(e,n){return Wu.qn(Object.values(this._f).map(function(t){return function(){return t.Mi(e,n)}}))},Up),pp=(n(Vp,cp=Xu),Vp),dp=(Cp.mf=function(t){return new Cp(t)},Object.defineProperty(Cp.prototype,"Af",{get:function(){if(this.If)return this.If;throw Dr()},enumerable:!1,configurable:!0}),Cp.prototype.Fi=function(t,e,n){return this.Ef.Fi(n,e),this.Af.delete(n),Wu.resolve()},Cp.prototype.$i=function(t,e,n){return this.Ef.$i(n,e),this.Af.add(n),Wu.resolve()},Cp.prototype.qr=function(t,e){return this.Af.add(e),Wu.resolve()},Cp.prototype.removeTarget=function(t,e){var n=this;this.Ef.oa(e.targetId).forEach(function(t){return n.Af.add(t)});var r=this.persistence.Fr();return r.ki(t,e.targetId).next(function(t){t.forEach(function(t){return n.Af.add(t)})}).next(function(){return r.pi(t,e)})},Cp.prototype.df=function(){this.If=new Set},Cp.prototype.wf=function(t){var n=this,r=this.persistence.Nr().oi();return Wu.forEach(this.Af,function(e){return n.Rf(t,e).next(function(t){t||r.Gn(e)})}).next(function(){return n.If=null,r.apply(t)})},Cp.prototype.jr=function(t,e){var n=this;return this.Rf(t,e).next(function(t){t?n.Af.delete(e):n.Af.add(e)})},Cp.prototype.ff=function(t){return 0},Cp.prototype.Rf=function(t,e){var n=this;return Wu.qn([function(){return Wu.resolve(n.Ef.Mi(e))},function(){return n.persistence.Fr().Mi(t,e)},function(){return n.persistence.Tf(t,e)}])},Cp),yp=(Rp.prototype.wu=function(t){this.gf=t},Rp.prototype.cu=function(t){this.yf=t},Rp.prototype.onMessage=function(t){this.pf=t},Rp.prototype.close=function(){this.Vf()},Rp.prototype.send=function(t){this.Pf(t)},Rp.prototype.bf=function(){this.gf()},Rp.prototype.vf=function(t){this.yf(t)},Rp.prototype.Sf=function(t){this.pf(t)},Rp),vp={BatchGetDocuments:"batchGet",Commit:"commit"},gp="gl-js/ fire/"+Er,mp=(Lp.prototype.Cf=function(t,e){if(e)for(var n in e.Oa)e.Oa.hasOwnProperty(n)&&(t[n]=e.Oa[n]);t["X-Goog-Api-Client"]=gp},Lp.prototype.vu=function(a,r,i){var h=this,c=this.Ff(a);return new Promise(function(o,s){var u=new wr;u.listenOnce(gr.COMPLETE,function(){try{switch(u.getLastErrorCode()){case vr.NO_ERROR:var t=u.getResponseJson();Ar("Connection","XHR received:",JSON.stringify(t)),o(t);break;case vr.TIMEOUT:Ar("Connection",'RPC "'+a+'" timed out'),s(new $r(Wr.DEADLINE_EXCEEDED,"Request time out"));break;case vr.HTTP_ERROR:var e=u.getStatus();if(Ar("Connection",'RPC "'+a+'" failed with status:',e,"response text:",u.getResponseText()),0<e){var n=u.getResponseJson().error;if(n&&n.status&&n.message){var r=(i=n.status.toLowerCase().replace("_","-"),0<=Object.values(Wr).indexOf(i)?i:Wr.UNKNOWN);s(new $r(r,n.message))}else s(new $r(Wr.UNKNOWN,"Server responded with status "+u.getStatus()))}else Ar("Connection",'RPC "'+a+'" failed'),s(new $r(Wr.UNAVAILABLE,"Connection failed."));break;default:Dr()}}finally{Ar("Connection",'RPC "'+a+'" completed.')}var i});var t=Object.assign({},r);delete t.database;var e=JSON.stringify(t);Ar("Connection","XHR sending: ",c+" "+e);var n={"Content-Type":"text/plain"};h.Cf(n,i),u.send(c,"POST",e,n,15)})},Lp.prototype.Su=function(t,e,n){return this.vu(t,e,n)},Lp.prototype.Tu=function(t,e){var n,r,i=[this.Df,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=yr(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.s.projectId+"/databases/"+this.s.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.Cf(s.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(g())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=g().indexOf("Electron/")||0<=(r=g()).indexOf("MSIE ")||0<=r.indexOf("Trident/")||0<=g().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(s.httpHeadersOverwriteParam="$httpHeaders");var u=i.join("");function a(t,e){h.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})}Ar("Connection","Creating WebChannel: "+u+" "+s);var h=o.createWebChannel(u,s),c=!1,f=!1,l=new yp({Pf:function(t){f?Ar("Connection","Not sending because WebChannel is closed:",t):(c||(Ar("Connection","Opening WebChannel transport."),h.open(),c=!0),Ar("Connection","WebChannel sending:",t),h.send(t))},Vf:function(){return h.close()}});return a(mr.EventType.OPEN,function(){f||Ar("Connection","WebChannel transport opened.")}),a(mr.EventType.CLOSE,function(){f||(f=!0,Ar("Connection","WebChannel transport closed"),l.vf())}),a(mr.EventType.ERROR,function(t){f||(f=!0,function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Tr.logLevel<=p.WARN){var r=e.map(Sr);Tr.warn.apply(Tr,d(["Firestore ("+Er+"): Connection"],r))}}("Connection","WebChannel transport errored:",t),l.vf(new $r(Wr.UNAVAILABLE,"The operation could not be completed")))}),a(mr.EventType.MESSAGE,function(t){var e;if(!f){var n=t.data[0];xr(!!n);var r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error);if(r){Ar("Connection","WebChannel received error:",r);var i=r.status,o=function(){var t=Ii[i];if(void 0!==t)return Ni(t)}(),s=r.message;void 0===o&&(o=Wr.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),f=!0,l.vf(new $r(o,s)),h.close()}else Ar("Connection","WebChannel received:",n),l.Sf(n)}}),setTimeout(function(){l.bf()},0),l},Lp.prototype.Ff=function(t){var e=vp[t];return this.Df+"/v1/projects/"+this.s.projectId+"/databases/"+this.s.database+"/documents:"+e},Lp),wp=(kp.prototype.tc=function(t){this.Mf.push(t)},kp.prototype.gr=function(){window.removeEventListener("online",this.Nf),window.removeEventListener("offline",this.kf)},kp.prototype.Of=function(){window.addEventListener("online",this.Nf),window.addEventListener("offline",this.kf)},kp.prototype.$f=function(){Ar("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.Mf;t<e.length;t++)(0,e[t])(0)},kp.prototype.xf=function(){Ar("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.Mf;t<e.length;t++)(0,e[t])(1)},kp.Hi=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},kp),bp=(Op.prototype.tc=function(t){},Op.prototype.gr=function(){},Op),Ip="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.",Ep=(Pp.prototype.initialize=function(n){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:return this.t_=this.Lf(n),this.persistence=this.Bf(n),[4,this.persistence.start()];case 1:return t.sent(),this.qf=this.Uf(n),this.zu=this.Qf(n),this.Zl=this.Wf(n),this.Rc=this.jf(n),this.Kf=this.Gf(n),this.t_.Lu=function(t){return e.Rc.Ql(t,1)},this.Zl.Rc=this.Rc,[4,this.zu.start()];case 2:return t.sent(),[4,this.t_.start()];case 3:return t.sent(),[4,this.Zl.start()];case 4:return t.sent(),[4,this.Zl.Mc(this.Rc.__)];case 5:return t.sent(),[2]}})})},Pp.prototype.Gf=function(t){return new Xl(this.Rc)},Pp.prototype.Uf=function(t){return null},Pp.prototype.Qf=function(t){return fc(this.persistence,new Jl,t.zf)},Pp.prototype.Bf=function(t){if(t.Yf.Hf)throw new $r(Wr.FAILED_PRECONDITION,Ip);return new lp(dp.mf)},Pp.prototype.Wf=function(t){var e=this;return new sl(this.zu,t.Du,t.mo,function(t){return e.Rc.Ql(t,0)},new(wp.Hi()?wp:bp))},Pp.prototype.Lf=function(t){return new Ol},Pp.prototype.jf=function(t){return Ql(this.zu,this.Zl,t.Du,this.t_,t.zf,t.e_)},Pp.prototype.clearPersistence=function(t,e){throw new $r(Wr.FAILED_PRECONDITION,Ip)},Pp),Tp=(n(xp,hp=Ep),xp.prototype.Qf=function(t){return fc(this.persistence,new Jl,t.zf)},xp.prototype.jf=function(t){return Ql(this.zu,this.Zl,t.Du,this.t_,t.zf,t.e_)},xp.prototype.Uf=function(t){var e=this.persistence.wi.xr;return new oc(e,t.mo)},xp.prototype.Bf=function(t){var e=ih(t.Jf.s,t.Jf.persistenceKey),n=bf(t.Jf.s);return new Xa(t.Yf.synchronizeTabs,e,t.clientId,nc.oh(t.Yf.cacheSizeBytes),t.mo,Wh(),"undefined"!=typeof document?document:null,n,this.t_,t.Yf.qi)},xp.prototype.Lf=function(t){return new Ol},xp.prototype.clearPersistence=function(t,e){return function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return Lh.Hi()?(e=n+"main",[4,Lh.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})}(ih(t,e))},n(Dp,ap=xp),Dp.prototype.initialize=function(e){return y(this,void 0,void 0,function(){var n=this;return v(this,function(t){switch(t.label){case 0:return[4,ap.prototype.initialize.call(this,e)];case 1:return t.sent(),[4,this.persistence.rr(function(e){return y(n,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.Rc.Mc(e)];case 1:return t.sent(),this.qf&&(e&&!this.qf.or?this.qf.start(this.zu):e||this.qf.stop()),[2]}})})})];case 2:return t.sent(),[2]}})})},Dp.prototype.Qf=function(t){return e=this.persistence,n=new Jl,r=t.zf,new pc(e,n,r);var e,n,r},Dp.prototype.jf=function(t){var e,n,r,i,o,s,u=(e=this.zu,n=this.Zl,r=t.Du,i=this.t_,o=t.zf,s=t.e_,new Kl(e,n,r,i,o,s));return this.t_ instanceof Pl&&(this.t_.Rc=u),u},Dp.prototype.Lf=function(t){if(t.Yf.Hf&&t.Yf.synchronizeTabs){var e=Wh();if(!Pl.Hi(e))throw new $r(Wr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=ih(t.Jf.s,t.Jf.persistenceKey);return new Pl(e,t.mo,n,t.clientId,t.zf)}return new Ol},Dp),_p=(Sp.prototype.start=function(t,e,n){var r=this;this.bu(),this.Jf=t;var i=new aa,o=new aa,s=!1;return this.credentials.qa(function(t){if(!s)return s=!0,Ar("FirestoreClient","Initializing. user=",t.uid),r.Xf(e,n,t,o).then(i.resolve,i.reject);r.mo._r(function(){return r.Zl.xc(t)})}),this.mo.cr(function(){return i.promise}),o.promise},Sp.prototype.enableNetwork=function(){var t=this;return this.bu(),this.mo.enqueue(function(){return t.Rc.enableNetwork()})},Sp.prototype.Xf=function(h,c,f,l){return y(this,void 0,void 0,function(){var r,i,o,s,u,a=this;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,(u=this.Jf,Promise.resolve(new mp(u)))];case 1:return r=t.sent(),i=bf(this.Jf.s),e=r,n=this.credentials,o=new rl(e,n,i),[4,h.initialize({mo:this.mo,Jf:this.Jf,Du:o,clientId:this.clientId,zf:f,e_:100,Yf:c})];case 2:return t.sent(),this.persistence=h.persistence,this.t_=h.t_,this.zu=h.zu,this.Zl=h.Zl,this.Rc=h.Rc,this.qf=h.qf,this.Zf=h.Kf,this.persistence.hr(function(){return y(a,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}})})}),l.resolve(),[3,4];case 3:if(s=t.sent(),l.reject(s),!this.td(s))throw s;return[2,(console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+s),this.Xf(new Ep,{Hf:!1},f,l))];case 4:return[2]}var e,n})})},Sp.prototype.td=function(t){return"FirebaseError"===t.name?t.code===Wr.FAILED_PRECONDITION||t.code===Wr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},Sp.prototype.bu=function(){if(this.mo.xo)throw new $r(Wr.FAILED_PRECONDITION,"The client has already been terminated.")},Sp.prototype.disableNetwork=function(){var t=this;return this.bu(),this.mo.enqueue(function(){return t.Rc.disableNetwork()})},Sp.prototype.terminate=function(){var t=this;return this.mo.qo(function(){return y(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.qf&&this.qf.stop(),[4,this.Zl.gr()];case 1:return t.sent(),[4,this.t_.gr()];case 2:return t.sent(),[4,this.persistence.gr()];case 3:return t.sent(),this.credentials.Ua(),[2]}})})})},Sp.prototype.waitForPendingWrites=function(){var t=this;this.bu();var e=new aa;return this.mo.cr(function(){return t.Rc.V_(e)}),e.promise},Sp.prototype.listen=function(t,e,n){var r=this;this.bu();var i=new Yl(t,e,n);return this.mo.cr(function(){return r.Zf.listen(i)}),i},Sp.prototype.mc=function(t){var e=this;this.ed||this.mo.cr(function(){return e.Zf.mc(t)})},Sp.prototype.nd=function(o){return y(this,void 0,void 0,function(){var i,e=this;return v(this,function(t){switch(t.label){case 0:return this.bu(),i=new aa,[4,this.mo.enqueue(function(){return y(e,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.zu.Wh(o)];case 1:return(e=t.sent())instanceof au?i.resolve(e):e instanceof hu?i.resolve(null):i.reject(new $r(Wr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return n=t.sent(),r=Jh(n,"Failed to get document '"+o+" from cache"),i.reject(r),[3,3];case 3:return[2]}})})})];case 1:return[2,(t.sent(),i.promise)]}})})},Sp.prototype.sd=function(a){return y(this,void 0,void 0,function(){var u,e=this;return v(this,function(t){switch(t.label){case 0:return this.bu(),u=new aa,[4,this.mo.enqueue(function(){return y(e,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.zu.Gh(a,!0)];case 1:return e=t.sent(),n=new kl(a,e.zh),r=n.xl(e.documents),i=n.Jn(r,!1),u.resolve(i.snapshot),[3,3];case 2:return o=t.sent(),s=Jh(o,"Failed to execute query '"+a+" against cache"),u.reject(s),[3,3];case 3:return[2]}})})})];case 1:return[2,(t.sent(),u.promise)]}})})},Sp.prototype.write=function(t){var e=this;this.bu();var n=new aa;return this.mo.cr(function(){return e.Rc.write(t,n)}),n.promise},Sp.prototype.s=function(){return this.Jf.s},Sp.prototype.q_=function(t){var e=this;this.bu(),this.mo.cr(function(){return e.Zf.q_(t),Promise.resolve()})},Sp.prototype.U_=function(t){var e=this;this.ed||this.mo.cr(function(){return e.Zf.U_(t),Promise.resolve()})},Object.defineProperty(Sp.prototype,"ed",{get:function(){return this.mo.xo},enumerable:!1,configurable:!0}),Sp.prototype.transaction=function(t){var e=this;this.bu();var n=new aa;return this.mo.cr(function(){return e.Rc.runTransaction(e.mo,t,n),Promise.resolve()}),n.promise},Sp),Ap=(Np.prototype.next=function(t){this.rd(this.observer.next,t)},Np.prototype.error=function(t){this.rd(this.observer.error,t)},Np.prototype.od=function(){this.muted=!0},Np.prototype.rd=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},Np);function Np(t){this.observer=t,this.muted=!1}function Sp(t,e){this.credentials=t,this.mo=e,this.clientId=kr.t()}function Dp(){return null!==ap&&ap.apply(this,arguments)||this}function xp(){return null!==hp&&hp.apply(this,arguments)||this}function Pp(){}function Op(){}function kp(){var t=this;this.Nf=function(){return t.$f()},this.kf=function(){return t.xf()},this.Mf=[],this.Of()}function Lp(t){this.s=t.s;var e=t.ssl?"https":"http";this.Df=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}function Rp(t){this.Pf=t.Pf,this.Vf=t.Vf}function Cp(t){this.persistence=t,this.Ef=new vc,this.If=null}function Vp(t){var e=this;return(e=cp.call(this)||this).Li=t,e}function Up(t){var e=this;this._f={},this.Ui=new Zu(0),this.Qi=!1,this.Qi=!0,this.wi=t(this),this.Ji=new fp(this),this.ss=new ya,this.es=new tp(this.ss,function(t){return e.wi.ff(t)})}function Mp(t){this.persistence=t,this.af=new Hr(function(t){return yi(t)},vi),this.lastRemoteSnapshotVersion=Xr.min(),this.highestTargetId=0,this.uf=0,this.cf=new vc,this.targetCount=0,this.lf=Fa.fi()}function jp(i){return function(){if("object"==typeof i&&null!==i)for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return 1}}()}var Fp=(Hp.prototype.ud=function(t){switch(go(t)){case 0:return null;case 1:return t.booleanValue;case 2:return _o(t.integerValue||t.doubleValue);case 3:return this.ld(t.timestampValue);case 4:return this._d(t);case 5:return t.stringValue;case 6:return new zc(Ao(t.bytesValue));case 7:return this.fd(t.referenceValue);case 8:return this.dd(t.geoPointValue);case 9:return this.wd(t.arrayValue);case 10:return this.Td(t.mapValue);default:throw Dr()}},Hp.prototype.Td=function(t){var n=this,r={};return qr(t.fields||{},function(t,e){r[t]=n.ud(e)}),r},Hp.prototype.dd=function(t){return new lf(_o(t.latitude),_o(t.longitude))},Hp.prototype.wd=function(t){var e=this;return(t.values||[]).map(function(t){return e.ud(t)})},Hp.prototype._d=function(t){switch(this.hd){case"previous":var e=function t(e){var n=e.mapValue.fields.__previous_value__;return po(n)?t(n):n}(t);return null==e?null:this.ud(e);case"estimate":return this.ld(yo(t));default:return null}},Hp.prototype.ld=function(t){var e=To(t),n=new Kr(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate()},Hp.prototype.fd=function(t){var e=Jr.$(t);xr(is(e));var n=new Mr(e.get(1),e.get(3)),r=new ei(e.g(5));return n.isEqual(this.s)||Nr("Document "+r+" contains a document reference within a different database ("+n.projectId+"/"+n.database+") which is not supported. It will be treated as a reference in the current database ("+this.s.projectId+"/"+this.s.database+") instead."),this.ad(r)},Hp),qp=nc.uh,Bp=(Qp.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},Qp),zp=(Object.defineProperty(Gp.prototype,"pd",{get:function(){return this.bd||(this.bd=new xf(this.Va,this.yd.ignoreUndefinedProperties)),this.bd},enumerable:!1,configurable:!0}),Gp.prototype.settings=function(t){Ic("Firestore.settings",arguments,1),_c("Firestore.settings","object",1,t);var e=new Bp(t);if(this.Ad&&!this.yd.isEqual(e))throw new $r(Wr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this.yd=e).credentials&&(this.Vd=function(t){if(!t)return new Xf;switch(t.type){case"gapi":var e=t.vd;return xr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Zf(e,t.za||"0");case"provider":return t.vd;default:throw new $r(Wr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},Gp.prototype.enableNetwork=function(){return this.md(),this.Ad.enableNetwork()},Gp.prototype.disableNetwork=function(){return this.md(),this.Ad.disableNetwork()},Gp.prototype.enablePersistence=function(t){var e,n;if(this.Ad)throw new $r(Wr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var r=!1,i=!1;if(t&&(void 0!==t.experimentalTabSynchronization&&Nr("The 'experimentalTabSynchronization' setting will be removed. Use 'synchronizeTabs' instead."),r=null!==(n=null!==(e=t.synchronizeTabs)&&void 0!==e?e:t.experimentalTabSynchronization)&&void 0!==n&&n,i=!!t.experimentalForceOwningTab&&t.experimentalForceOwningTab,r&&i))throw new $r(Wr.INVALID_ARGUMENT,"The 'experimentalForceOwningTab' setting cannot be used with 'synchronizeTabs'.");return this.Sd(this.gd,{Hf:!0,cacheSizeBytes:this.yd.cacheSizeBytes,synchronizeTabs:r,qi:i})},Gp.prototype.clearPersistence=function(){return y(this,void 0,void 0,function(){var n,e=this;return v(this,function(t){if(void 0!==this.Ad&&!this.Ad.ed)throw new $r(Wr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");return n=new aa,[2,(this.Id.Mo(function(){return y(e,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.gd.clearPersistence(this.Va,this.Pd)];case 1:return t.sent(),n.resolve(),[3,3];case 2:return e=t.sent(),n.reject(e),[3,3];case 3:return[2]}})})}),n.promise)]})})},Gp.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(Gp.prototype,"Dd",{get:function(){return this.md(),this.Ad.ed},enumerable:!1,configurable:!0}),Gp.prototype.waitForPendingWrites=function(){return this.md(),this.Ad.waitForPendingWrites()},Gp.prototype.onSnapshotsInSync=function(t){if(this.md(),jp(t))return Wp(this.Ad,t);_c("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return Wp(this.Ad,e)},Gp.prototype.md=function(){return this.Ad||this.Sd(new Ep,{Hf:!1}),this.Ad},Gp.prototype.Cd=function(){return new Ur(this.Va,this.Pd,this.yd.host,this.yd.ssl,this.yd.forceLongPolling)},Gp.prototype.Sd=function(t,e){var n=this.Cd();return this.Ad=new _p(this.Vd,this.Id),this.Ad.start(n,t,e)},Gp.Rd=function(t){if(e=t.options,!Object.prototype.hasOwnProperty.call(e,"projectId"))throw new $r(Wr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var e,n=t.options.projectId;if(!n||"string"!=typeof n)throw new $r(Wr.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new Mr(n)},Object.defineProperty(Gp.prototype,"app",{get:function(){if(!this.Ed)throw new $r(Wr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Ed},enumerable:!1,configurable:!0}),Gp.prototype.collection=function(t){return Ic("Firestore.collection",arguments,1),_c("Firestore.collection","non-empty string",1,t),this.md(),new gd(Jr.$(t),this,null)},Gp.prototype.doc=function(t){return Ic("Firestore.doc",arguments,1),_c("Firestore.doc","non-empty string",1,t),this.md(),Yp.Fd(Jr.$(t),this,null)},Gp.prototype.collectionGroup=function(t){if(Ic("Firestore.collectionGroup",arguments,1),_c("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new $r(Wr.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.md(),new fd(new fu(Jr.k(),t),this,null)},Gp.prototype.runTransaction=function(e){var n=this;return Ic("Firestore.runTransaction",arguments,1),_c("Firestore.runTransaction","function",1,e),this.md().transaction(function(t){return e(new Kp(n,t))})},Gp.prototype.batch=function(){return this.md(),new Xp(this)},Object.defineProperty(Gp,"logLevel",{get:function(){switch(_r()){case p.DEBUG:return"debug";case p.ERROR:return"error";case p.SILENT:return"silent";case p.WARN:return"warn";case p.INFO:return"info";case p.VERBOSE:return"verbose";default:return"error"}},enumerable:!1,configurable:!0}),Gp.setLogLevel=function(t){Ic("Firestore.setLogLevel",arguments,1),xc("setLogLevel",["debug","error","silent","warn","info","verbose"],1,t),Tr.setLogLevel(t)},Gp.prototype.Nd=function(){return this.yd.timestampsInSnapshots},Gp);function Gp(t,e,n){var r=this;if(void 0===n&&(n=new Ep),this.Ed=null,this.Id=new Kh,this.INTERNAL={delete:function(){return y(r,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.md(),[4,this.Ad.terminate()];case 1:return t.sent(),[2]}})})}},"object"==typeof t.options){var i=t;this.Ed=i,this.Va=Gp.Rd(i),this.Pd=i.name,this.Vd=new Yf(e)}else{var o=t;if(!o.projectId)throw new $r(Wr.INVALID_ARGUMENT,"Must provide projectId");this.Va=new Mr(o.projectId,o.database),this.Pd="[DEFAULT]",this.Vd=new Xf}this.gd=n,this.yd=new Bp({})}function Qp(t){var e,n,r,i;if(void 0===t.host){if(void 0!==t.ssl)throw new $r(Wr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else Nc("settings","non-empty string","host",t.host),this.host=t.host,Sc("settings","boolean","ssl",t.ssl),this.ssl=null===(e=t.ssl)||void 0===e||e;if(Rc("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling","ignoreUndefinedProperties"]),Sc("settings","object","credentials",t.credentials),this.credentials=t.credentials,Sc("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),Sc("settings","boolean","ignoreUndefinedProperties",t.ignoreUndefinedProperties),!0===t.timestampsInSnapshots?Nr("The setting 'timestampsInSnapshots: true' is no longer required and should be removed."):!1===t.timestampsInSnapshots&&Nr("Support for 'timestampsInSnapshots: false' will be removed soon. You must update your code to handle Timestamp objects."),this.timestampsInSnapshots=null===(n=t.timestampsInSnapshots)||void 0===n||n,this.ignoreUndefinedProperties=null!==(r=t.ignoreUndefinedProperties)&&void 0!==r&&r,Sc("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=nc._h;else{if(t.cacheSizeBytes!==qp&&t.cacheSizeBytes<nc.lh)throw new $r(Wr.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+nc.lh);this.cacheSizeBytes=t.cacheSizeBytes}Sc("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=null!==(i=t.experimentalForceLongPolling)&&void 0!==i&&i}function Hp(t,e,n,r){this.s=t,this.timestampsInSnapshots=e,this.hd=n,this.ad=r}function Wp(t,e){var n=new Ap({next:function(){e.next&&e.next()},error:function(t){throw Dr()}});return t.q_(n),function(){n.od(),t.U_(n)}}var $p,Kp=(td.prototype.get=function(t){var n=this;Ic("Transaction.get",arguments,1);var r=Td("Transaction.get",t,this.$d);return this.kd.ku([r.ga]).then(function(t){if(!t||1!==t.length)return Dr();var e=t[0];if(e instanceof hu)return new id(n.$d,r.ga,null,!1,!1,r.ya);if(e instanceof au)return new id(n.$d,r.ga,e,!1,!1,r.ya);throw Dr()})},td.prototype.set=function(t,e,n){Tc("Transaction.set",arguments,2,3);var r=Td("Transaction.set",t,this.$d);n=bd("Transaction.set",n);var i=_d(r.ya,e,n),o=kf(this.$d.pd,"Transaction.set",r.ga,i,null!==r.ya,n);return this.kd.set(r.ga,o),this},td.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return i="string"==typeof e||e instanceof Qc?(Ec("Transaction.update",arguments,3),r=Td("Transaction.update",t,this.$d),Rf(this.$d.pd,"Transaction.update",r.ga,e,n,o)):(Ic("Transaction.update",arguments,2),r=Td("Transaction.update",t,this.$d),Lf(this.$d.pd,"Transaction.update",r.ga,e)),this.kd.update(r.ga,i),this},td.prototype.delete=function(t){Ic("Transaction.delete",arguments,1);var e=Td("Transaction.delete",t,this.$d);return this.kd.delete(e.ga),this},td),Xp=(Zp.prototype.set=function(t,e,n){Tc("WriteBatch.set",arguments,2,3),this.Od();var r=Td("WriteBatch.set",t,this.$d);n=bd("WriteBatch.set",n);var i=_d(r.ya,e,n),o=kf(this.$d.pd,"WriteBatch.set",r.ga,i,null!==r.ya,n);return this.xd=this.xd.concat(o.pa(r.ga,Ss.Qe())),this},Zp.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.Od(),i="string"==typeof e||e instanceof Qc?(Ec("WriteBatch.update",arguments,3),r=Td("WriteBatch.update",t,this.$d),Rf(this.$d.pd,"WriteBatch.update",r.ga,e,n,o)):(Ic("WriteBatch.update",arguments,2),r=Td("WriteBatch.update",t,this.$d),Lf(this.$d.pd,"WriteBatch.update",r.ga,e)),this.xd=this.xd.concat(i.pa(r.ga,Ss.exists(!0))),this},Zp.prototype.delete=function(t){Ic("WriteBatch.delete",arguments,1),this.Od();var e=Td("WriteBatch.delete",t,this.$d);return this.xd=this.xd.concat(new Ks(e.ga,Ss.Qe())),this},Zp.prototype.commit=function(){return this.Od(),this.Md=!0,0<this.xd.length?this.$d.md().write(this.xd):Promise.resolve()},Zp.prototype.Od=function(){if(this.Md)throw new $r(Wr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},Zp),Yp=(n(Jp,$p=Ef),Jp.Fd=function(t,e,n){if(t.length%2!=0)throw new $r(Wr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.N()+" has "+t.length);return new Jp(new ei(t),e,n)},Object.defineProperty(Jp.prototype,"id",{get:function(){return this.ga.path.S()},enumerable:!1,configurable:!0}),Object.defineProperty(Jp.prototype,"parent",{get:function(){return new gd(this.ga.path.p(),this.firestore,this.ya)},enumerable:!1,configurable:!0}),Object.defineProperty(Jp.prototype,"path",{get:function(){return this.ga.path.N()},enumerable:!1,configurable:!0}),Jp.prototype.collection=function(t){if(Ic("DocumentReference.collection",arguments,1),_c("DocumentReference.collection","non-empty string",1,t),!t)throw new $r(Wr.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=Jr.$(t);return new gd(this.ga.path.child(e),this.firestore,null)},Jp.prototype.isEqual=function(t){if(!(t instanceof Jp))throw Cc("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this.ga.isEqual(t.ga)&&this.ya===t.ya},Jp.prototype.set=function(t,e){Tc("DocumentReference.set",arguments,1,2),e=bd("DocumentReference.set",e);var n=_d(this.ya,t,e),r=kf(this.firestore.pd,"DocumentReference.set",this.ga,n,null!==this.ya,e);return this.Ad.write(r.pa(this.ga,Ss.Qe()))},Jp.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof Qc?(Ec("DocumentReference.update",arguments,2),Rf(this.firestore.pd,"DocumentReference.update",this.ga,t,e,r)):(Ic("DocumentReference.update",arguments,1),Lf(this.firestore.pd,"DocumentReference.update",this.ga,t)),this.Ad.write(n.pa(this.ga,Ss.exists(!0)))},Jp.prototype.delete=function(){return Ic("DocumentReference.delete",arguments,0),this.Ad.write([new Ks(this.ga,Ss.Qe())])},Jp.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];Tc("DocumentReference.onSnapshot",arguments,1,4);var s={includeMetadataChanges:!1},u=0;"object"!=typeof i[u]||jp(i[u])||(Rc("DocumentReference.onSnapshot",s=i[u],["includeMetadataChanges"]),Sc("DocumentReference.onSnapshot","boolean","includeMetadataChanges",s.includeMetadataChanges),u++);var a={includeMetadataChanges:s.includeMetadataChanges};if(jp(i[u])){var h=i[u];i[u]=null===(t=h.next)||void 0===t?void 0:t.bind(h),i[u+1]=null===(e=h.error)||void 0===e?void 0:e.bind(h),i[u+2]=null===(n=h.complete)||void 0===n?void 0:n.bind(h)}else _c("DocumentReference.onSnapshot","function",u,i[u]),Ac("DocumentReference.onSnapshot","function",u+1,i[u+1]),Ac("DocumentReference.onSnapshot","function",u+2,i[u+2]);var c={next:function(t){i[u]&&i[u](r.Ld(t))},error:i[u+1],complete:i[u+2]};return ed(this.Ad,this.ga,a,c)},Jp.prototype.get=function(t){var e,n,r,i,o,s=this;return Tc("DocumentReference.get",arguments,0,1),Ed("DocumentReference.get",t),t&&"cache"===t.source?this.firestore.md().nd(this.ga).then(function(t){return new id(s.firestore,s.ga,t,!0,t instanceof au&&t.Ge,s.ya)}):(e=this.Ad,n=this.ga,r=t,i=new aa,o=ed(e,n,{includeMetadataChanges:!0,H_:!0},{next:function(t){o();var e=t.docs.has(n);!e&&t.fromCache?i.reject(new $r(Wr.UNAVAILABLE,"Failed to get document because the client is offline.")):e&&t.fromCache&&r&&"server"===r.source?i.reject(new $r(Wr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(t)},error:function(t){return i.reject(t)}}),i.promise.then(function(t){return s.Ld(t)}))},Jp.prototype.withConverter=function(t){return new Jp(this.ga,this.firestore,t)},Jp.prototype.Ld=function(t){var e=t.docs.get(this.ga);return new id(this.firestore,this.ga,e,t.fromCache,t.hasPendingWrites,this.ya)},Jp);function Jp(t,e,n){var r=this;return(r=$p.call(this,e.Va,t,n)||this).ga=t,r.firestore=e,r.ya=n,r.Ad=r.firestore.md(),r}function Zp(t){this.$d=t,this.xd=[],this.Md=!1}function td(t,e){this.$d=t,this.kd=e}function ed(t,e,n,r){var i=function(t){console.error("Uncaught Error in onSnapshot:",t)};r.error&&(i=r.error.bind(r));var o=new Ap({next:function(t){r.next&&r.next(t)},error:i}),s=t.listen(fu.hn(e.path),o,n);return function(){o.od(),t.mc(s)}}var nd,rd=(ad.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},ad),id=(ud.prototype.data=function(t){var e=this;if(Tc("DocumentSnapshot.data",arguments,0,1),t=Id("DocumentSnapshot.data",t),this.Bd){if(this.ya){var n=new od(this.$d,this.ga,this.Bd,this.qd,this.Ud,null);return this.ya.fromFirestore(n,t)}return new Fp(this.$d.Va,this.$d.Nd(),t.serverTimestamps||"none",function(t){return new Yp(t,e.$d,null)}).ud(this.Bd.tn())}},ud.prototype.get=function(t,e){var n=this;if(Tc("DocumentSnapshot.get",arguments,1,2),e=Id("DocumentSnapshot.get",e),this.Bd){var r=this.Bd.data().field(Ff("DocumentSnapshot.get",t,this.ga));if(null!==r)return new Fp(this.$d.Va,this.$d.Nd(),e.serverTimestamps||"none",function(t){return new Yp(t,n.$d,n.ya)}).ud(r)}},Object.defineProperty(ud.prototype,"id",{get:function(){return this.ga.path.S()},enumerable:!1,configurable:!0}),Object.defineProperty(ud.prototype,"ref",{get:function(){return new Yp(this.ga,this.$d,this.ya)},enumerable:!1,configurable:!0}),Object.defineProperty(ud.prototype,"exists",{get:function(){return null!==this.Bd},enumerable:!1,configurable:!0}),Object.defineProperty(ud.prototype,"metadata",{get:function(){return new rd(this.Ud,this.qd)},enumerable:!1,configurable:!0}),ud.prototype.isEqual=function(t){if(!(t instanceof ud))throw Cc("isEqual","DocumentSnapshot",1,t);return this.$d===t.$d&&this.qd===t.qd&&this.ga.isEqual(t.ga)&&(null===this.Bd?null===t.Bd:this.Bd.isEqual(t.Bd))&&this.ya===t.ya},ud),od=(n(sd,nd=id),sd.prototype.data=function(t){return nd.prototype.data.call(this,t)},sd);function sd(){return null!==nd&&nd.apply(this,arguments)||this}function ud(t,e,n,r,i,o){this.$d=t,this.ga=e,this.Bd=n,this.qd=r,this.Ud=i,this.ya=o}function ad(t,e){this.hasPendingWrites=t,this.fromCache=e}function hd(t){if(t.mn()&&0===t.en.length)throw new $r(Wr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var cd,fd=(pd.prototype.Wd=function(t,e,n){var r;if(t.O()){if("array-contains"===e||"array-contains-any"===e)throw new $r(Wr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+e+"' queries on FieldPath.documentId().");if("in"===e){this.jd(n,e);for(var i=[],o=0,s=n;o<s.length;o++){var u=s[o];i.push(this.Kd(u))}r={arrayValue:{values:i}}}else r=this.Kd(n)}else"in"!==e&&"array-contains-any"!==e||this.jd(n,e),r=Cf(this.pd,"Query.where",n,"in"===e);var a=Eu.create(t,e,r);return this.Gd(a),a},pd.prototype.zd=function(t,e){if(null!==this.Qd.startAt)throw new $r(Wr.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this.Qd.endAt)throw new $r(Wr.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var n=new zu(t,e);return this.Hd(n),n},pd.prototype.Yd=function(t,e,n){if(!e)throw new $r(Wr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");for(var r=[],i=0,o=this.Qd.orderBy;i<o.length;i++){var s=o[i];if(s.field.O())r.push(No(this.Va,e.key));else{var u=e.field(s.field);if(po(u))throw new $r(Wr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+s.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===u){var a=s.field.N();throw new $r(Wr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+a+"' (used as the orderBy) does not exist.")}r.push(u)}}return new Ru(r,n)},pd.prototype.Jd=function(t,e,n){var r=this.Qd.en;if(e.length>r.length)throw new $r(Wr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var s=e[o];if(r[o].field.O()){if("string"!=typeof s)throw new $r(Wr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof s);if(!this.Qd.Vn()&&-1!==s.indexOf("/"))throw new $r(Wr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+s+"' contains a slash.");var u=this.Qd.path.child(Jr.$(s));if(!ei.W(u))throw new $r(Wr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+u+"' is not because it contains an odd number of segments.");var a=new ei(u);i.push(No(this.Va,a))}else{var h=Cf(this.pd,t,s);i.push(h)}}return new Ru(i,n)},pd.prototype.Kd=function(t){if("string"==typeof t){if(""===t)throw new $r(Wr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this.Qd.Vn()&&-1!==t.indexOf("/"))throw new $r(Wr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this.Qd.path.child(Jr.$(t));if(!ei.W(e))throw new $r(Wr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return No(this.Va,new ei(e))}if(t instanceof Ef)return No(this.Va,t.ga);throw new $r(Wr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+kc(t)+".")},pd.prototype.jd=function(t,e){if(!Array.isArray(t)||0===t.length)throw new $r(Wr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new $r(Wr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(0<=t.indexOf(null))throw new $r(Wr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter(function(t){return Number.isNaN(t)}).length)throw new $r(Wr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},pd.prototype.Gd=function(t){if(t instanceof Eu){var e=["array-contains","array-contains-any"],n=["in","array-contains-any"],r=0<=e.indexOf(t.op),i=0<=n.indexOf(t.op);if(t.An()){var o=this.Qd.an();if(null!==o&&!o.isEqual(t.field))throw new $r(Wr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var s=this.Qd.un();null!==s&&this.Xd(t.field,s)}else if(i||r){var u=null;if(i&&(u=this.Qd.Rn(n)),null===u&&r&&(u=this.Qd.Rn(e)),null!==u)throw u===t.op?new $r(Wr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new $r(Wr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+u.toString()+"' filters.")}}},pd.prototype.Hd=function(t){if(null===this.Qd.un()){var e=this.Qd.an();null!==e&&this.Xd(e,t.field)}},pd.prototype.Xd=function(t,e){if(!e.isEqual(t))throw new $r(Wr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},n(ld,cd=pd),ld.prototype.where=function(t,e,n){Ic("Query.where",arguments,3),Lc("Query.where",3,n);var r=xc("Query.where",["<","<=","==",">=",">","array-contains","in","array-contains-any"],2,e),i=Ff("Query.where",t),o=this.Wd(i,r,n);return new ld(this.Qd.cn(o),this.firestore,this.ya)},ld.prototype.orderBy=function(t,e){var n;if(Tc("Query.orderBy",arguments,1,2),Ac("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n="asc";else{if("desc"!==e)throw new $r(Wr.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n="desc"}var r=Ff("Query.orderBy",t),i=this.zd(r,n);return new ld(this.Qd.ln(i),this.firestore,this.ya)},ld.prototype.limit=function(t){return Ic("Query.limit",arguments,1),_c("Query.limit","number",1,t),Vc("Query.limit",1,t),new ld(this.Qd._n(t),this.firestore,this.ya)},ld.prototype.limitToLast=function(t){return Ic("Query.limitToLast",arguments,1),_c("Query.limitToLast","number",1,t),Vc("Query.limitToLast",1,t),new ld(this.Qd.fn(t),this.firestore,this.ya)},ld.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Ec("Query.startAt",arguments,1);var r=this.Zd("Query.startAt",t,e,!0);return new ld(this.Qd.dn(r),this.firestore,this.ya)},ld.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Ec("Query.startAfter",arguments,1);var r=this.Zd("Query.startAfter",t,e,!1);return new ld(this.Qd.dn(r),this.firestore,this.ya)},ld.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Ec("Query.endBefore",arguments,1);var r=this.Zd("Query.endBefore",t,e,!0);return new ld(this.Qd.wn(r),this.firestore,this.ya)},ld.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Ec("Query.endAt",arguments,1);var r=this.Zd("Query.endAt",t,e,!1);return new ld(this.Qd.wn(r),this.firestore,this.ya)},ld.prototype.isEqual=function(t){if(!(t instanceof ld))throw Cc("isEqual","Query",1,t);return this.firestore===t.firestore&&vu(this.Qd,t.Qd)&&this.ya===t.ya},ld.prototype.withConverter=function(t){return new ld(this.Qd,this.firestore,t)},ld.prototype.Zd=function(t,e,n,r){if(Lc(t,1,e),e instanceof id)return Ic(t,d([e],n),1),this.Yd(t,e.Bd,r);var i=[e].concat(n);return this.Jd(t,i,r)},ld.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];Tc("Query.onSnapshot",arguments,1,4);var s={},u=0;if("object"!=typeof i[u]||jp(i[u])||(Rc("Query.onSnapshot",s=i[u],["includeMetadataChanges"]),Sc("Query.onSnapshot","boolean","includeMetadataChanges",s.includeMetadataChanges),u++),jp(i[u])){var a=i[u];i[u]=null===(t=a.next)||void 0===t?void 0:t.bind(a),i[u+1]=null===(e=a.error)||void 0===e?void 0:e.bind(a),i[u+2]=null===(n=a.complete)||void 0===n?void 0:n.bind(a)}else _c("Query.onSnapshot","function",u,i[u]),Ac("Query.onSnapshot","function",u+1,i[u+1]),Ac("Query.onSnapshot","function",u+2,i[u+2]);var h={next:function(t){i[u]&&i[u](new vd(r.firestore,r.Qd,t,r.ya))},error:i[u+1],complete:i[u+2]};return hd(this.Qd),dd(this.firestore.md(),this.Qd,s,h)},ld.prototype.get=function(t){var e=this;Tc("Query.get",arguments,0,1),Ed("Query.get",t),hd(this.Qd);var n,r,i,o,s,u=this.firestore.md();return(t&&"cache"===t.source?u.sd(this.Qd):(n=u,r=this.Qd,i=t,o=new aa,s=dd(n,r,{includeMetadataChanges:!0,H_:!0},{next:function(t){s(),t.fromCache&&i&&"server"===i.source?o.reject(new $r(Wr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):o.resolve(t)},error:function(t){return o.reject(t)}}),o.promise)).then(function(t){return new vd(e.firestore,e.Qd,t,e.ya)})},ld);function ld(t,e,n){var r=this;return(r=cd.call(this,e.Va,e.pd,t)||this).Qd=t,r.firestore=e,r.ya=n,r}function pd(t,e,n){this.Va=t,this.pd=e,this.Qd=n}function dd(t,e,n,r){var i=function(t){console.error("Uncaught Error in onSnapshot:",t)};r.error&&(i=r.error.bind(r));var o=new Ap({next:function(t){r.next&&r.next(t)},error:i}),s=t.listen(e,o,n);return function(){o.od(),t.mc(s)}}var yd,vd=(Object.defineProperty(wd.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(wd.prototype,"empty",{get:function(){return this.ew.docs._()},enumerable:!1,configurable:!0}),Object.defineProperty(wd.prototype,"size",{get:function(){return this.ew.docs.size},enumerable:!1,configurable:!0}),wd.prototype.forEach=function(e,n){var r=this;Tc("QuerySnapshot.forEach",arguments,1,2),_c("QuerySnapshot.forEach","function",1,e),this.ew.docs.forEach(function(t){e.call(n,r.iw(t,r.metadata.fromCache,r.ew.Lt.has(t.key)))})},Object.defineProperty(wd.prototype,"query",{get:function(){return new fd(this.tw,this.$d,this.ya)},enumerable:!1,configurable:!0}),wd.prototype.docChanges=function(t){t&&(Rc("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),Sc("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this.ew.qt)throw new $r(Wr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.nw&&this.sw===e||(this.nw=function(i,e,o){if(i.Ot._()){var n=0;return i.docChanges.map(function(t){var e=o(t.doc,i.fromCache,i.Lt.has(t.doc.key));return t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:n++}})}var s=i.Ot;return i.docChanges.filter(function(t){return e||3!==t.type}).map(function(t){var e=o(t.doc,i.fromCache,i.Lt.has(t.doc.key)),n=-1,r=-1;return 0!==t.type&&(n=s.indexOf(t.doc.key),s=s.delete(t.doc.key)),1!==t.type&&(r=(s=s.add(t.doc)).indexOf(t.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Dr()}}(t.type),doc:e,oldIndex:n,newIndex:r}})}(this.ew,e,this.iw.bind(this)),this.sw=e),this.nw},wd.prototype.isEqual=function(t){if(!(t instanceof wd))throw Cc("isEqual","QuerySnapshot",1,t);return this.$d===t.$d&&vu(this.tw,t.tw)&&this.ew.isEqual(t.ew)&&this.ya===t.ya},wd.prototype.iw=function(t,e,n){return new od(this.$d,t.key,t,e,n,this.ya)},wd),gd=(n(md,yd=fd),Object.defineProperty(md.prototype,"id",{get:function(){return this.Qd.path.S()},enumerable:!1,configurable:!0}),Object.defineProperty(md.prototype,"parent",{get:function(){var t=this.Qd.path.p();return t._()?null:new Yp(new ei(t),this.firestore,null)},enumerable:!1,configurable:!0}),Object.defineProperty(md.prototype,"path",{get:function(){return this.Qd.path.N()},enumerable:!1,configurable:!0}),md.prototype.doc=function(t){Tc("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=kr.t()),_c("CollectionReference.doc","non-empty string",1,t);var e=Jr.$(t);return Yp.Fd(this.Qd.path.child(e),this.firestore,this.ya)},md.prototype.add=function(t){Ic("CollectionReference.add",arguments,1),_c("CollectionReference.add","object",1,this.ya?this.ya.toFirestore(t):t);var e=this.doc();return e.set(t).then(function(){return e})},md.prototype.withConverter=function(t){return new md(this.rw,this.firestore,t)},md);function md(t,e,n){var r=this;if(((r=yd.call(this,fu.hn(t),e,n)||this).rw=t).length%2!=1)throw new $r(Wr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.N()+" has "+t.length);return r}function wd(t,e,n,r){this.$d=t,this.tw=e,this.ew=n,this.ya=r,this.nw=null,this.sw=null,this.metadata=new rd(n.hasPendingWrites,n.fromCache)}function bd(t,e){if(void 0===e)return{merge:!1};if(Rc(t,e,["merge","mergeFields"]),Sc(t,"boolean","merge",e.merge),n=t,void 0!==(r=e.mergeFields)&&function(t,e,n,r){if(!(n instanceof Array))throw new $r(Wr.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+kc(n));for(var i=0;i<n.length;++i)if(!r(n[i]))throw new $r(Wr.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be a string or a FieldPath, but the value at index "+i+" was: "+kc(n[i]))}(n,"mergeFields",r,function(t){return"string"==typeof t||t instanceof Qc}),void 0!==e.mergeFields&&void 0!==e.merge)throw new $r(Wr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');var n,r;return e}function Id(t,e){return void 0===e?{}:(Rc(t,e,["serverTimestamps"]),Dc(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function Ed(t,e){Ac(t,"object",1,e),e&&(Rc(t,e,["source"]),Dc(t,0,"source",e.source,["default","server","cache"]))}function Td(t,e,n){if(e instanceof Ef){if(e.firestore!==n)throw new $r(Wr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw Cc(t,"DocumentReference",1,e)}function _d(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Ad,Nd={Firestore:zp,GeoPoint:lf,Timestamp:Kr,Blob:zc,Transaction:Kp,WriteBatch:Xp,DocumentReference:Yp,DocumentSnapshot:id,Query:fd,QueryDocumentSnapshot:od,QuerySnapshot:vd,CollectionReference:gd,FieldPath:Qc,FieldValue:cf,setLogLevel:zp.setLogLevel,CACHE_SIZE_UNLIMITED:qp};(Ad=Sd).INTERNAL.registerComponent(new br("firestore",function(t){return e=t.getProvider("app").getImmediate(),n=t.getProvider("auth-internal"),new zp(e,n,new Tp);var e,n},"PUBLIC").setServiceProps(Object.assign({},Nd))),Ad.registerVersion("@firebase/firestore","1.16.1")}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});
//# sourceMappingURL=firebase-firestore.js.map
